Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var iterable_1 = require("../iterable");
var isiterable_1 = require("../internal/isiterable");
var FlattenIterable = (function (_super) {
    tslib_1.__extends(FlattenIterable, _super);
    function FlattenIterable(source, depth) {
        var _this = _super.call(this) || this;
        _this._source = source;
        _this._depth = depth;
        return _this;
    }
    FlattenIterable.prototype._flatten = function (source, depth) {
        var source_1, source_1_1, item, e_1_1, source_2, source_2_1, item, _a, _b, innerItem, e_2_1, e_3_1, e_1, _c, e_3, _d, e_2, _e;
        return tslib_1.__generator(this, function (_f) {
            switch (_f.label) {
                case 0:
                    if (!(depth === 0)) return [3 /*break*/, 9];
                    _f.label = 1;
                case 1:
                    _f.trys.push([1, 6, 7, 8]);
                    source_1 = tslib_1.__values(source), source_1_1 = source_1.next();
                    _f.label = 2;
                case 2:
                    if (!!source_1_1.done) return [3 /*break*/, 5];
                    item = source_1_1.value;
                    return [4 /*yield*/, item];
                case 3:
                    _f.sent();
                    _f.label = 4;
                case 4:
                    source_1_1 = source_1.next();
                    return [3 /*break*/, 2];
                case 5: return [3 /*break*/, 8];
                case 6:
                    e_1_1 = _f.sent();
                    e_1 = { error: e_1_1 };
                    return [3 /*break*/, 8];
                case 7:
                    try {
                        if (source_1_1 && !source_1_1.done && (_c = source_1.return)) _c.call(source_1);
                    }
                    finally { if (e_1) throw e_1.error; }
                    return [7 /*endfinally*/];
                case 8: return [2 /*return*/];
                case 9:
                    _f.trys.push([9, 23, 24, 25]);
                    source_2 = tslib_1.__values(source), source_2_1 = source_2.next();
                    _f.label = 10;
                case 10:
                    if (!!source_2_1.done) return [3 /*break*/, 22];
                    item = source_2_1.value;
                    if (!isiterable_1.isIterable(item)) return [3 /*break*/, 19];
                    _f.label = 11;
                case 11:
                    _f.trys.push([11, 16, 17, 18]);
                    _a = tslib_1.__values(this._flatten(item, depth - 1)), _b = _a.next();
                    _f.label = 12;
                case 12:
                    if (!!_b.done) return [3 /*break*/, 15];
                    innerItem = _b.value;
                    return [4 /*yield*/, innerItem];
                case 13:
                    _f.sent();
                    _f.label = 14;
                case 14:
                    _b = _a.next();
                    return [3 /*break*/, 12];
                case 15: return [3 /*break*/, 18];
                case 16:
                    e_2_1 = _f.sent();
                    e_2 = { error: e_2_1 };
                    return [3 /*break*/, 18];
                case 17:
                    try {
                        if (_b && !_b.done && (_e = _a.return)) _e.call(_a);
                    }
                    finally { if (e_2) throw e_2.error; }
                    return [7 /*endfinally*/];
                case 18: return [3 /*break*/, 21];
                case 19: return [4 /*yield*/, item];
                case 20:
                    _f.sent();
                    _f.label = 21;
                case 21:
                    source_2_1 = source_2.next();
                    return [3 /*break*/, 10];
                case 22: return [3 /*break*/, 25];
                case 23:
                    e_3_1 = _f.sent();
                    e_3 = { error: e_3_1 };
                    return [3 /*break*/, 25];
                case 24:
                    try {
                        if (source_2_1 && !source_2_1.done && (_d = source_2.return)) _d.call(source_2);
                    }
                    finally { if (e_3) throw e_3.error; }
                    return [7 /*endfinally*/];
                case 25: return [2 /*return*/];
            }
        });
    };
    FlattenIterable.prototype[Symbol.iterator] = function () {
        return this._flatten(this._source, this._depth)[Symbol.iterator]();
    };
    return FlattenIterable;
}(iterable_1.IterableX));
/**
 * Flattens the source sequence until the specified depth.
 * @param {Iterable<T>} source Source sequence.
 * @param {Number} depth The depth to flatten the source sequence.
 * @returns {Iterable<T>} The flattened sequence, flattened to the specified depth.
 */
function flatten(source, depth) {
    if (depth === void 0) { depth = Infinity; }
    return new FlattenIterable(source, depth);
}
exports.flatten = flatten;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIml0ZXJhYmxlL2ZsYXR0ZW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx3Q0FBd0M7QUFDeEMscURBQW9EO0FBRXBEO0lBQXVDLDJDQUFrQjtJQUl2RCx5QkFBWSxNQUF5QixFQUFFLEtBQWE7UUFBcEQsWUFDRSxpQkFBTyxTQUdSO1FBRkMsS0FBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDdEIsS0FBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7O0lBQ3RCLENBQUM7SUFFUSxrQ0FBUSxHQUFqQixVQUFrQixNQUF5QixFQUFFLEtBQWE7Ozs7O3lCQUNwRCxDQUFBLEtBQUssS0FBSyxDQUFDLENBQUEsRUFBWCx3QkFBVzs7OztvQkFDSSxXQUFBLGlCQUFBLE1BQU0sQ0FBQTs7OztvQkFBZCxJQUFJO29CQUFjLHFCQUFNLElBQUksRUFBQTs7b0JBQVYsU0FBVSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7O3dCQUN0QyxzQkFBTzs7O29CQUVRLFdBQUEsaUJBQUEsTUFBTSxDQUFBOzs7O29CQUFkLElBQUk7eUJBQ1AsdUJBQVUsQ0FBQyxJQUFJLENBQUMsRUFBaEIseUJBQWdCOzs7O29CQUNJLEtBQUEsaUJBQUEsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFBOzs7O29CQUEzQyxTQUFTO29CQUFzQyxxQkFBTSxTQUFTLEVBQUE7O29CQUFmLFNBQWUsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7eUJBRXhFLHFCQUFNLElBQUksRUFBQTs7b0JBQVYsU0FBVSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0tBR2hCO0lBRUQsMEJBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFqQjtRQUNFLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO0lBQ3JFLENBQUM7SUFDSCxzQkFBQztBQUFELENBM0JBLEFBMkJDLENBM0JzQyxvQkFBUyxHQTJCL0M7QUFFRDs7Ozs7R0FLRztBQUNILGlCQUEyQixNQUFtQixFQUFFLEtBQXdCO0lBQXhCLHNCQUFBLEVBQUEsZ0JBQXdCO0lBQ3RFLE1BQU0sQ0FBQyxJQUFJLGVBQWUsQ0FBSSxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDL0MsQ0FBQztBQUZELDBCQUVDIiwiZmlsZSI6Iml0ZXJhYmxlL2ZsYXR0ZW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJdGVyYWJsZVggfSBmcm9tICcuLi9pdGVyYWJsZSc7XG5pbXBvcnQgeyBpc0l0ZXJhYmxlIH0gZnJvbSAnLi4vaW50ZXJuYWwvaXNpdGVyYWJsZSc7XG5cbmNsYXNzIEZsYXR0ZW5JdGVyYWJsZTxUU291cmNlPiBleHRlbmRzIEl0ZXJhYmxlWDxUU291cmNlPiB7XG4gIHByaXZhdGUgX3NvdXJjZTogSXRlcmFibGU8VFNvdXJjZT47XG4gIHByaXZhdGUgX2RlcHRoOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3Ioc291cmNlOiBJdGVyYWJsZTxUU291cmNlPiwgZGVwdGg6IG51bWJlcikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fc291cmNlID0gc291cmNlO1xuICAgIHRoaXMuX2RlcHRoID0gZGVwdGg7XG4gIH1cblxuICBwcml2YXRlICpfZmxhdHRlbihzb3VyY2U6IEl0ZXJhYmxlPFRTb3VyY2U+LCBkZXB0aDogbnVtYmVyKTogSXRlcmFibGU8VFNvdXJjZT4ge1xuICAgIGlmIChkZXB0aCA9PT0gMCkge1xuICAgICAgZm9yIChsZXQgaXRlbSBvZiBzb3VyY2UpIHsgeWllbGQgaXRlbTsgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBmb3IgKGxldCBpdGVtIG9mIHNvdXJjZSkge1xuICAgICAgaWYgKGlzSXRlcmFibGUoaXRlbSkpIHtcbiAgICAgICAgZm9yIChsZXQgaW5uZXJJdGVtIG9mIHRoaXMuX2ZsYXR0ZW4oaXRlbSwgZGVwdGggLSAxKSkgeyB5aWVsZCBpbm5lckl0ZW07IH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHlpZWxkIGl0ZW07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZsYXR0ZW4odGhpcy5fc291cmNlLCB0aGlzLl9kZXB0aClbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICB9XG59XG5cbi8qKlxuICogRmxhdHRlbnMgdGhlIHNvdXJjZSBzZXF1ZW5jZSB1bnRpbCB0aGUgc3BlY2lmaWVkIGRlcHRoLlxuICogQHBhcmFtIHtJdGVyYWJsZTxUPn0gc291cmNlIFNvdXJjZSBzZXF1ZW5jZS5cbiAqIEBwYXJhbSB7TnVtYmVyfSBkZXB0aCBUaGUgZGVwdGggdG8gZmxhdHRlbiB0aGUgc291cmNlIHNlcXVlbmNlLlxuICogQHJldHVybnMge0l0ZXJhYmxlPFQ+fSBUaGUgZmxhdHRlbmVkIHNlcXVlbmNlLCBmbGF0dGVuZWQgdG8gdGhlIHNwZWNpZmllZCBkZXB0aC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZsYXR0ZW48VD4oc291cmNlOiBJdGVyYWJsZTxUPiwgZGVwdGg6IG51bWJlciA9IEluZmluaXR5KTogSXRlcmFibGVYPFQ+IHtcbiAgcmV0dXJuIG5ldyBGbGF0dGVuSXRlcmFibGU8VD4oc291cmNlLCBkZXB0aCk7XG59XG4iXX0=
