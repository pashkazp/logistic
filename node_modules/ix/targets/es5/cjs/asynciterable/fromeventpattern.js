Object.defineProperty(exports, "__esModule", { value: true });
var asyncsink_1 = require("../asyncsink");
var memoize_1 = require("./memoize");
function fromEventPattern(addHandler, removeHandler) {
    var sink = new asyncsink_1.AsyncSink();
    var handler = function (e) { return sink.write(e); };
    addHandler(handler);
    return memoize_1.memoize((_a = {},
        _a[Symbol.asyncIterator] = function () {
            return {
                next: function () {
                    return sink.next();
                },
                return: function () {
                    removeHandler(handler);
                    sink.end();
                    return Promise.resolve({ done: true });
                }
            };
        },
        _a));
    var _a;
}
exports.fromEventPattern = fromEventPattern;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvZnJvbWV2ZW50cGF0dGVybi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsMENBQXlDO0FBQ3pDLHFDQUFvQztBQUVwQywwQkFDSSxVQUF1RCxFQUN2RCxhQUEwRDtJQUM1RCxJQUFNLElBQUksR0FBRyxJQUFJLHFCQUFTLEVBQVcsQ0FBQztJQUN0QyxJQUFNLE9BQU8sR0FBRyxVQUFDLENBQVUsSUFBSyxPQUFBLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQWIsQ0FBYSxDQUFDO0lBRTlDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUVwQixNQUFNLENBQUMsaUJBQU87UUFDWixHQUFDLE1BQU0sQ0FBQyxhQUFhLElBQXJCO1lBQ0UsTUFBTSxDQUFDO2dCQUNMLElBQUk7b0JBQ0YsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDckIsQ0FBQztnQkFFRCxNQUFNO29CQUNKLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFDdkIsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUNYLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBNkIsQ0FBQyxDQUFDO2dCQUNwRSxDQUFDO2FBQ0YsQ0FBQztRQUNKLENBQUM7WUFDRCxDQUFDOztBQUNMLENBQUM7QUF2QkQsNENBdUJDIiwiZmlsZSI6ImFzeW5jaXRlcmFibGUvZnJvbWV2ZW50cGF0dGVybi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jU2luayB9IGZyb20gJy4uL2FzeW5jc2luayc7XG5pbXBvcnQgeyBtZW1vaXplIH0gZnJvbSAnLi9tZW1vaXplJztcblxuZXhwb3J0IGZ1bmN0aW9uIGZyb21FdmVudFBhdHRlcm48VFNvdXJjZT4oXG4gICAgYWRkSGFuZGxlcjogKGhhbmRsZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCkgPT4gdm9pZCxcbiAgICByZW1vdmVIYW5kbGVyOiAoaGFuZGxlcjogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkKSA9PiB2b2lkKTogQXN5bmNJdGVyYWJsZTxUU291cmNlPiB7XG4gIGNvbnN0IHNpbmsgPSBuZXcgQXN5bmNTaW5rPFRTb3VyY2U+KCk7XG4gIGNvbnN0IGhhbmRsZXIgPSAoZTogVFNvdXJjZSkgPT4gc2luay53cml0ZShlKTtcblxuICBhZGRIYW5kbGVyKGhhbmRsZXIpO1xuXG4gIHJldHVybiBtZW1vaXplKHtcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmV4dCgpIHtcbiAgICAgICAgICByZXR1cm4gc2luay5uZXh0KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmV0dXJuKCkge1xuICAgICAgICAgIHJlbW92ZUhhbmRsZXIoaGFuZGxlcik7XG4gICAgICAgICAgc2luay5lbmQoKTtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgZG9uZTogdHJ1ZSB9IGFzIEl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH0pO1xufVxuIl19
