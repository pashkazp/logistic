Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var asynciterable_1 = require("../asynciterable");
var bindcallback_1 = require("../internal/bindcallback");
var FlatMapAsyncIterable = (function (_super) {
    tslib_1.__extends(FlatMapAsyncIterable, _super);
    function FlatMapAsyncIterable(source, selector) {
        var _this = _super.call(this) || this;
        _this._source = source;
        _this._selector = selector;
        return _this;
    }
    FlatMapAsyncIterable.prototype[Symbol.asyncIterator] = function () {
        return tslib_1.__asyncGenerator(this, arguments, function _a() {
            var _a, _b, outer, inners, inners_1, inners_1_1, inner, e_1_1, e_2_1, e_2, _c, e_1, _d;
            return tslib_1.__generator(this, function (_e) {
                switch (_e.label) {
                    case 0:
                        _e.trys.push([0, 20, 21, 26]);
                        _a = tslib_1.__asyncValues(this._source);
                        _e.label = 1;
                    case 1: return [4 /*yield*/, tslib_1.__await(_a.next())];
                    case 2:
                        if (!(_b = _e.sent(), !_b.done)) return [3 /*break*/, 19];
                        return [4 /*yield*/, tslib_1.__await(_b.value)];
                    case 3:
                        outer = _e.sent();
                        return [4 /*yield*/, tslib_1.__await(this._selector(outer))];
                    case 4:
                        inners = _e.sent();
                        _e.label = 5;
                    case 5:
                        _e.trys.push([5, 12, 13, 18]);
                        inners_1 = tslib_1.__asyncValues(inners);
                        _e.label = 6;
                    case 6: return [4 /*yield*/, tslib_1.__await(inners_1.next())];
                    case 7:
                        if (!(inners_1_1 = _e.sent(), !inners_1_1.done)) return [3 /*break*/, 11];
                        return [4 /*yield*/, tslib_1.__await(inners_1_1.value)];
                    case 8:
                        inner = _e.sent();
                        return [4 /*yield*/, inner];
                    case 9:
                        _e.sent();
                        _e.label = 10;
                    case 10: return [3 /*break*/, 6];
                    case 11: return [3 /*break*/, 18];
                    case 12:
                        e_1_1 = _e.sent();
                        e_1 = { error: e_1_1 };
                        return [3 /*break*/, 18];
                    case 13:
                        _e.trys.push([13, , 16, 17]);
                        if (!(inners_1_1 && !inners_1_1.done && (_d = inners_1.return))) return [3 /*break*/, 15];
                        return [4 /*yield*/, tslib_1.__await(_d.call(inners_1))];
                    case 14:
                        _e.sent();
                        _e.label = 15;
                    case 15: return [3 /*break*/, 17];
                    case 16:
                        if (e_1) throw e_1.error;
                        return [7 /*endfinally*/];
                    case 17: return [7 /*endfinally*/];
                    case 18: return [3 /*break*/, 1];
                    case 19: return [3 /*break*/, 26];
                    case 20:
                        e_2_1 = _e.sent();
                        e_2 = { error: e_2_1 };
                        return [3 /*break*/, 26];
                    case 21:
                        _e.trys.push([21, , 24, 25]);
                        if (!(_b && !_b.done && (_c = _a.return))) return [3 /*break*/, 23];
                        return [4 /*yield*/, tslib_1.__await(_c.call(_a))];
                    case 22:
                        _e.sent();
                        _e.label = 23;
                    case 23: return [3 /*break*/, 25];
                    case 24:
                        if (e_2) throw e_2.error;
                        return [7 /*endfinally*/];
                    case 25: return [7 /*endfinally*/];
                    case 26: return [2 /*return*/];
                }
            });
        });
    };
    return FlatMapAsyncIterable;
}(asynciterable_1.AsyncIterableX));
function flatMap(source, selector, thisArg) {
    return new FlatMapAsyncIterable(source, bindcallback_1.bindCallback(selector, thisArg, 1));
}
exports.flatMap = flatMap;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvZmxhdG1hcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGtEQUFrRDtBQUNsRCx5REFBd0Q7QUFFeEQ7SUFBcUQsZ0RBQXVCO0lBSTFFLDhCQUNFLE1BQThCLEVBQzlCLFFBQXNGO1FBRnhGLFlBR0UsaUJBQU8sU0FHUjtRQUZDLEtBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO1FBQ3RCLEtBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDOztJQUM1QixDQUFDO0lBRU0sK0JBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxHQUE3Qjs7Ozs7Ozt3QkFDMEIsS0FBQSxzQkFBQSxJQUFJLENBQUMsT0FBTyxDQUFBOzs7Ozs7O3dCQUFyQixLQUFLLFlBQUE7d0JBQ0gscUNBQU0sSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsR0FBQTs7d0JBQXBDLE1BQU0sR0FBRyxTQUEyQjs7Ozt3QkFDbEIsV0FBQSxzQkFBQSxNQUFNLENBQUE7Ozs7Ozs7d0JBQWYsS0FBSyxZQUFBO3dCQUNsQixxQkFBTSxLQUFLLEVBQUE7O3dCQUFYLFNBQVcsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0tBR2pCO0lBQ0gsMkJBQUM7QUFBRCxDQXBCQSxBQW9CQyxDQXBCb0QsOEJBQWMsR0FvQmxFO0FBRUQsaUJBQ0ksTUFBOEIsRUFDOUIsUUFBc0YsRUFDdEYsT0FBYTtJQUNmLE1BQU0sQ0FBQyxJQUFJLG9CQUFvQixDQUFtQixNQUFNLEVBQUUsMkJBQVksQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEcsQ0FBQztBQUxELDBCQUtDIiwiZmlsZSI6ImFzeW5jaXRlcmFibGUvZmxhdG1hcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jSXRlcmFibGVYIH0gZnJvbSAnLi4vYXN5bmNpdGVyYWJsZSc7XG5pbXBvcnQgeyBiaW5kQ2FsbGJhY2sgfSBmcm9tICcuLi9pbnRlcm5hbC9iaW5kY2FsbGJhY2snO1xuXG5jbGFzcyBGbGF0TWFwQXN5bmNJdGVyYWJsZTxUU291cmNlLCBUUmVzdWx0PiBleHRlbmRzIEFzeW5jSXRlcmFibGVYPFRSZXN1bHQ+IHtcbiAgcHJpdmF0ZSBfc291cmNlOiBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+O1xuICBwcml2YXRlIF9zZWxlY3RvcjogKHZhbHVlOiBUU291cmNlKSA9PiBBc3luY0l0ZXJhYmxlPFRSZXN1bHQ+IHwgUHJvbWlzZTxBc3luY0l0ZXJhYmxlPFRSZXN1bHQ+PjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBzb3VyY2U6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgc2VsZWN0b3I6ICh2YWx1ZTogVFNvdXJjZSkgPT4gQXN5bmNJdGVyYWJsZTxUUmVzdWx0PiB8IFByb21pc2U8QXN5bmNJdGVyYWJsZTxUUmVzdWx0Pj4pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3NvdXJjZSA9IHNvdXJjZTtcbiAgICB0aGlzLl9zZWxlY3RvciA9IHNlbGVjdG9yO1xuICB9XG5cbiAgYXN5bmMgKltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgZm9yIGF3YWl0IChsZXQgb3V0ZXIgb2YgdGhpcy5fc291cmNlKSB7XG4gICAgICBjb25zdCBpbm5lcnMgPSBhd2FpdCB0aGlzLl9zZWxlY3RvcihvdXRlcik7XG4gICAgICBmb3IgYXdhaXQgKGxldCBpbm5lciBvZiBpbm5lcnMpIHtcbiAgICAgICAgeWllbGQgaW5uZXI7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmbGF0TWFwPFRTb3VyY2UsIFRSZXN1bHQ+KFxuICAgIHNvdXJjZTogQXN5bmNJdGVyYWJsZTxUU291cmNlPixcbiAgICBzZWxlY3RvcjogKHZhbHVlOiBUU291cmNlKSA9PiBBc3luY0l0ZXJhYmxlPFRSZXN1bHQ+IHwgUHJvbWlzZTxBc3luY0l0ZXJhYmxlPFRSZXN1bHQ+PixcbiAgICB0aGlzQXJnPzogYW55KTogQXN5bmNJdGVyYWJsZVg8VFJlc3VsdD4ge1xuICByZXR1cm4gbmV3IEZsYXRNYXBBc3luY0l0ZXJhYmxlPFRTb3VyY2UsIFRSZXN1bHQ+KHNvdXJjZSwgYmluZENhbGxiYWNrKHNlbGVjdG9yLCB0aGlzQXJnLCAxKSk7XG59XG4iXX0=
