Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var asynciterable_1 = require("../asynciterable");
/**
 * @ignore
 */
function defaultCompareAsync(key, minValue) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        return tslib_1.__generator(this, function (_a) {
            return [2 /*return*/, key > minValue ? 1 : key < minValue ? -1 : 0];
        });
    });
}
exports.defaultCompareAsync = defaultCompareAsync;
/**
 * @ignore
 */
var ExtremaByAsyncIterator = (function (_super) {
    tslib_1.__extends(ExtremaByAsyncIterator, _super);
    function ExtremaByAsyncIterator(source, keyFn, cmp) {
        var _this = _super.call(this) || this;
        _this._source = source;
        _this._keyFn = keyFn;
        _this._cmp = cmp;
        return _this;
    }
    ExtremaByAsyncIterator.prototype[Symbol.asyncIterator] = function () {
        return tslib_1.__asyncGenerator(this, arguments, function _a() {
            var result, done, next, it, current, resKey, curr, key, c;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        result = [];
                        it = this._source[Symbol.asyncIterator]();
                        return [4 /*yield*/, tslib_1.__await(it.next())];
                    case 1:
                        done = (next = _a.sent()).done;
                        if (done) {
                            throw new Error('Sequence contains no elements');
                        }
                        current = next.value;
                        return [4 /*yield*/, tslib_1.__await(this._keyFn(current))];
                    case 2:
                        resKey = _a.sent();
                        return [4 /*yield*/, tslib_1.__await(it.next())];
                    case 3:
                        done = (next = _a.sent()).done;
                        _a.label = 4;
                    case 4:
                        if (!!done) return [3 /*break*/, 8];
                        curr = next.value;
                        return [4 /*yield*/, tslib_1.__await(this._keyFn(curr))];
                    case 5:
                        key = _a.sent();
                        return [4 /*yield*/, tslib_1.__await(this._cmp(key, resKey))];
                    case 6:
                        c = _a.sent();
                        if (c === 0) {
                            result.push(curr);
                        }
                        else if (c > 0) {
                            result = [curr];
                            resKey = key;
                        }
                        return [4 /*yield*/, tslib_1.__await(it.next())];
                    case 7:
                        done = (next = _a.sent()).done;
                        return [3 /*break*/, 4];
                    case 8: return [5 /*yield**/, tslib_1.__values(tslib_1.__asyncDelegator(tslib_1.__asyncValues(result)))];
                    case 9: return [4 /*yield*/, tslib_1.__await.apply(void 0, [_a.sent()])];
                    case 10:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    return ExtremaByAsyncIterator;
}(asynciterable_1.AsyncIterableX));
/**
 * @ignore
 */
function extremaBy(source, keyFn, cmp) {
    return new ExtremaByAsyncIterator(source, keyFn, cmp);
}
exports.extremaBy = extremaBy;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvX2V4dHJlbWFieS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGtEQUFrRDtBQUVsRDs7R0FFRztBQUNILDZCQUE2QyxHQUFNLEVBQUUsUUFBVzs7O1lBQzlELHNCQUFPLEdBQUcsR0FBRyxRQUFRLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxRQUFRLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFDOzs7Q0FDckQ7QUFGRCxrREFFQztBQUVEOztHQUVHO0FBQ0g7SUFBb0Qsa0RBQXVCO0lBS3pFLGdDQUNJLE1BQThCLEVBQzlCLEtBQTJDLEVBQzNDLEdBQW1EO1FBSHZELFlBSUUsaUJBQU8sU0FJUjtRQUhDLEtBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO1FBQ3RCLEtBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLEtBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDOztJQUNsQixDQUFDO0lBRU0saUNBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxHQUE3Qjs7Ozs7O3dCQUNNLE1BQU0sR0FBYyxFQUFFLENBQWE7d0JBQ2pDLEVBQUUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDO3dCQUNqQyxxQ0FBTSxFQUFFLENBQUMsSUFBSSxFQUFFLEdBQUE7O3dCQUE5QixJQUFJLEdBQUcsQ0FBQyxJQUFJLEdBQUcsU0FBZSxDQUFDLENBQUMsSUFBSSxDQUFDO3dCQUNyQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDOzRCQUNULE1BQU0sSUFBSSxLQUFLLENBQUMsK0JBQStCLENBQUMsQ0FBQzt3QkFDbkQsQ0FBQzt3QkFFRyxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQzt3QkFDWixxQ0FBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFBOzt3QkFBbkMsTUFBTSxHQUFHLFNBQTBCO3dCQUN4QixxQ0FBTSxFQUFFLENBQUMsSUFBSSxFQUFFLEdBQUE7O3dCQUE5QixJQUFJLEdBQUcsQ0FBQyxJQUFJLEdBQUcsU0FBZSxDQUFDLENBQUMsSUFBSSxDQUFDOzs7NkJBQzlCLENBQUMsSUFBSTt3QkFDTixJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQzt3QkFDWixxQ0FBTSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFBOzt3QkFBN0IsR0FBRyxHQUFHLFNBQXVCO3dCQUN2QixxQ0FBTSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsR0FBQTs7d0JBQWhDLENBQUMsR0FBRyxTQUE0Qjt3QkFDdEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7NEJBQ1osTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzt3QkFDcEIsQ0FBQzt3QkFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7NEJBQ2pCLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDOzRCQUNoQixNQUFNLEdBQUcsR0FBRyxDQUFDO3dCQUNmLENBQUM7d0JBQ2MscUNBQU0sRUFBRSxDQUFDLElBQUksRUFBRSxHQUFBOzt3QkFBOUIsSUFBSSxHQUFHLENBQUMsSUFBSSxHQUFHLFNBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQzs7NEJBR3ZDLHNCQUFBLGlCQUFPLHlCQUFBLHNCQUFBLE1BQU0sQ0FBQSxDQUFBLENBQUEsRUFBQTs0QkFBYixvREFBQSxTQUFhLElBQUE7O3dCQUFiLFNBQWEsQ0FBQzs7Ozs7S0FDZjtJQUNILDZCQUFDO0FBQUQsQ0F6Q0EsQUF5Q0MsQ0F6Q21ELDhCQUFjLEdBeUNqRTtBQUVEOztHQUVHO0FBQ0gsbUJBQ0ksTUFBOEIsRUFDOUIsS0FBMkMsRUFDM0MsR0FBbUQ7SUFDckQsTUFBTSxDQUFDLElBQUksc0JBQXNCLENBQWdCLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDdkUsQ0FBQztBQUxELDhCQUtDIiwiZmlsZSI6ImFzeW5jaXRlcmFibGUvX2V4dHJlbWFieS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jSXRlcmFibGVYIH0gZnJvbSAnLi4vYXN5bmNpdGVyYWJsZSc7XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVmYXVsdENvbXBhcmVBc3luYzxUPihrZXk6IFQsIG1pblZhbHVlOiBUKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgcmV0dXJuIGtleSA+IG1pblZhbHVlID8gMSA6IGtleSA8IG1pblZhbHVlID8gLTEgOiAwO1xufVxuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgRXh0cmVtYUJ5QXN5bmNJdGVyYXRvcjxUU291cmNlLCBUS2V5PiBleHRlbmRzIEFzeW5jSXRlcmFibGVYPFRTb3VyY2U+IHtcbiAgcHJpdmF0ZSBfc291cmNlOiBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+O1xuICBwcml2YXRlIF9rZXlGbjogKHg6IFRTb3VyY2UpID0+IFRLZXkgfCBQcm9taXNlPFRLZXk+O1xuICBwcml2YXRlIF9jbXA6ICh4OiBUS2V5LCB5OiBUS2V5KSA9PiBudW1iZXIgfCBQcm9taXNlPG51bWJlcj47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgICBzb3VyY2U6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgICBrZXlGbjogKHg6IFRTb3VyY2UpID0+IFRLZXkgfCBQcm9taXNlPFRLZXk+LFxuICAgICAgY21wOiAoeDogVEtleSwgeTogVEtleSkgPT4gbnVtYmVyIHwgUHJvbWlzZTxudW1iZXI+KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9zb3VyY2UgPSBzb3VyY2U7XG4gICAgdGhpcy5fa2V5Rm4gPSBrZXlGbjtcbiAgICB0aGlzLl9jbXAgPSBjbXA7XG4gIH1cblxuICBhc3luYyAqW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICBsZXQgcmVzdWx0OiBUU291cmNlW10gPSBbXSwgZG9uZSwgbmV4dDtcbiAgICBjb25zdCBpdCA9IHRoaXMuX3NvdXJjZVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKTtcbiAgICBkb25lID0gKG5leHQgPSBhd2FpdCBpdC5uZXh0KCkpLmRvbmU7XG4gICAgaWYgKGRvbmUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU2VxdWVuY2UgY29udGFpbnMgbm8gZWxlbWVudHMnKTtcbiAgICB9XG5cbiAgICBsZXQgY3VycmVudCA9IG5leHQudmFsdWU7XG4gICAgbGV0IHJlc0tleSA9IGF3YWl0IHRoaXMuX2tleUZuKGN1cnJlbnQpO1xuICAgIGRvbmUgPSAobmV4dCA9IGF3YWl0IGl0Lm5leHQoKSkuZG9uZTtcbiAgICB3aGlsZSAoIWRvbmUpIHtcbiAgICAgIGxldCBjdXJyID0gbmV4dC52YWx1ZTtcbiAgICAgIGxldCBrZXkgPSBhd2FpdCB0aGlzLl9rZXlGbihjdXJyKTtcbiAgICAgIGNvbnN0IGMgPSBhd2FpdCB0aGlzLl9jbXAoa2V5LCByZXNLZXkpO1xuICAgICAgaWYgKGMgPT09IDApIHtcbiAgICAgICAgcmVzdWx0LnB1c2goY3Vycik7XG4gICAgICB9IGVsc2UgaWYgKGMgPiAwKSB7XG4gICAgICAgIHJlc3VsdCA9IFtjdXJyXTtcbiAgICAgICAgcmVzS2V5ID0ga2V5O1xuICAgICAgfVxuICAgICAgZG9uZSA9IChuZXh0ID0gYXdhaXQgaXQubmV4dCgpKS5kb25lO1xuICAgIH1cblxuICAgIHlpZWxkKiByZXN1bHQ7XG4gIH1cbn1cblxuLyoqXG4gKiBAaWdub3JlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBleHRyZW1hQnk8VFNvdXJjZSwgVEtleT4oXG4gICAgc291cmNlOiBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+LFxuICAgIGtleUZuOiAoeDogVFNvdXJjZSkgPT4gVEtleSB8IFByb21pc2U8VEtleT4sXG4gICAgY21wOiAoeDogVEtleSwgeTogVEtleSkgPT4gbnVtYmVyIHwgUHJvbWlzZTxudW1iZXI+KTogQXN5bmNJdGVyYWJsZVg8VFNvdXJjZT4ge1xuICByZXR1cm4gbmV3IEV4dHJlbWFCeUFzeW5jSXRlcmF0b3I8VFNvdXJjZSwgVEtleT4oc291cmNlLCBrZXlGbiwgY21wKTtcbn1cbiJdfQ==
