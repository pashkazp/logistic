Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var asynciterable_1 = require("../asynciterable");
var _grouping_1 = require("./_grouping");
var empty_1 = require("./empty");
var from_1 = require("./from");
var identity_1 = require("../internal/identity");
var GroupJoinAsyncIterable = (function (_super) {
    tslib_1.__extends(GroupJoinAsyncIterable, _super);
    function GroupJoinAsyncIterable(outer, inner, outerSelector, innerSelector, resultSelector) {
        var _this = _super.call(this) || this;
        _this._outer = outer;
        _this._inner = inner;
        _this._outerSelector = outerSelector;
        _this._innerSelector = innerSelector;
        _this._resultSelector = resultSelector;
        return _this;
    }
    GroupJoinAsyncIterable.prototype[Symbol.asyncIterator] = function () {
        return tslib_1.__asyncGenerator(this, arguments, function _a() {
            var map, _a, _b, outerElement, outerKey, innerElements, e_1_1, e_1, _c;
            return tslib_1.__generator(this, function (_d) {
                switch (_d.label) {
                    case 0: return [4 /*yield*/, tslib_1.__await(_grouping_1.createGrouping(this._inner, this._innerSelector, identity_1.identity))];
                    case 1:
                        map = _d.sent();
                        _d.label = 2;
                    case 2:
                        _d.trys.push([2, 11, 12, 17]);
                        _a = tslib_1.__asyncValues(this._outer);
                        _d.label = 3;
                    case 3: return [4 /*yield*/, tslib_1.__await(_a.next())];
                    case 4:
                        if (!(_b = _d.sent(), !_b.done)) return [3 /*break*/, 10];
                        return [4 /*yield*/, tslib_1.__await(_b.value)];
                    case 5:
                        outerElement = _d.sent();
                        return [4 /*yield*/, tslib_1.__await(this._outerSelector(outerElement))];
                    case 6:
                        outerKey = _d.sent();
                        innerElements = map.has(outerKey) ? map.get(outerKey) : empty_1.empty();
                        return [4 /*yield*/, tslib_1.__await(this._resultSelector(outerElement, from_1.from(innerElements)))];
                    case 7: return [4 /*yield*/, _d.sent()];
                    case 8:
                        _d.sent();
                        _d.label = 9;
                    case 9: return [3 /*break*/, 3];
                    case 10: return [3 /*break*/, 17];
                    case 11:
                        e_1_1 = _d.sent();
                        e_1 = { error: e_1_1 };
                        return [3 /*break*/, 17];
                    case 12:
                        _d.trys.push([12, , 15, 16]);
                        if (!(_b && !_b.done && (_c = _a.return))) return [3 /*break*/, 14];
                        return [4 /*yield*/, tslib_1.__await(_c.call(_a))];
                    case 13:
                        _d.sent();
                        _d.label = 14;
                    case 14: return [3 /*break*/, 16];
                    case 15:
                        if (e_1) throw e_1.error;
                        return [7 /*endfinally*/];
                    case 16: return [7 /*endfinally*/];
                    case 17: return [2 /*return*/];
                }
            });
        });
    };
    return GroupJoinAsyncIterable;
}(asynciterable_1.AsyncIterableX));
function groupJoin(outer, inner, outerSelector, innerSelector, resultSelector) {
    return new GroupJoinAsyncIterable(outer, inner, outerSelector, innerSelector, resultSelector);
}
exports.groupJoin = groupJoin;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvZ3JvdXBqb2luLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsa0RBQWtEO0FBQ2xELHlDQUE2QztBQUM3QyxpQ0FBZ0M7QUFDaEMsK0JBQThCO0FBQzlCLGlEQUFnRDtBQUVoRDtJQUFvRSxrREFBdUI7SUFPekYsZ0NBQ0ksS0FBNEIsRUFDNUIsS0FBNEIsRUFDNUIsYUFBc0QsRUFDdEQsYUFBc0QsRUFDdEQsY0FBMkY7UUFML0YsWUFNRSxpQkFBTyxTQU1SO1FBTEMsS0FBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDcEIsS0FBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDcEIsS0FBSSxDQUFDLGNBQWMsR0FBRyxhQUFhLENBQUM7UUFDcEMsS0FBSSxDQUFDLGNBQWMsR0FBRyxhQUFhLENBQUM7UUFDcEMsS0FBSSxDQUFDLGVBQWUsR0FBRyxjQUFjLENBQUM7O0lBQ3hDLENBQUM7SUFFTSxpQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEdBQTdCOzs7Ozs0QkFDYyxxQ0FBTSwwQkFBYyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLGNBQWMsRUFBRSxtQkFBUSxDQUFDLEdBQUE7O3dCQUF0RSxHQUFHLEdBQUcsU0FBZ0U7Ozs7d0JBQzdDLEtBQUEsc0JBQUEsSUFBSSxDQUFDLE1BQU0sQ0FBQTs7Ozs7Ozt3QkFBM0IsWUFBWSxZQUFBO3dCQUNSLHFDQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLEdBQUE7O3dCQUFsRCxRQUFRLEdBQUcsU0FBdUM7d0JBQ2xELGFBQWEsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFxQixHQUFHLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLGFBQUssRUFBVSxDQUFDO3dCQUMxRixxQ0FBTSxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksRUFBRSxXQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsR0FBQTs0QkFBbkUscUJBQU0sU0FBNkQsRUFBQTs7d0JBQW5FLFNBQW1FLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztLQUV2RTtJQUNILDZCQUFDO0FBQUQsQ0E3QkEsQUE2QkMsQ0E3Qm1FLDhCQUFjLEdBNkJqRjtBQUVELG1CQUNJLEtBQTRCLEVBQzVCLEtBQTRCLEVBQzVCLGFBQXNELEVBQ3RELGFBQXNELEVBQ3RELGNBQTJGO0lBQzdGLE1BQU0sQ0FBQyxJQUFJLHNCQUFzQixDQUMvQixLQUFLLEVBQ0wsS0FBSyxFQUNMLGFBQWEsRUFDYixhQUFhLEVBQ2IsY0FBYyxDQUFDLENBQUM7QUFDcEIsQ0FBQztBQVpELDhCQVlDIiwiZmlsZSI6ImFzeW5jaXRlcmFibGUvZ3JvdXBqb2luLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXN5bmNJdGVyYWJsZVggfSBmcm9tICcuLi9hc3luY2l0ZXJhYmxlJztcbmltcG9ydCB7IGNyZWF0ZUdyb3VwaW5nIH0gZnJvbSAnLi9fZ3JvdXBpbmcnO1xuaW1wb3J0IHsgZW1wdHkgfSBmcm9tICcuL2VtcHR5JztcbmltcG9ydCB7IGZyb20gfSBmcm9tICcuL2Zyb20nO1xuaW1wb3J0IHsgaWRlbnRpdHkgfSBmcm9tICcuLi9pbnRlcm5hbC9pZGVudGl0eSc7XG5cbmNsYXNzIEdyb3VwSm9pbkFzeW5jSXRlcmFibGU8VE91dGVyLCBUSW5uZXIsIFRLZXksIFRSZXN1bHQ+IGV4dGVuZHMgQXN5bmNJdGVyYWJsZVg8VFJlc3VsdD4ge1xuICBwcml2YXRlIF9vdXRlcjogQXN5bmNJdGVyYWJsZTxUT3V0ZXI+O1xuICBwcml2YXRlIF9pbm5lcjogQXN5bmNJdGVyYWJsZTxUSW5uZXI+O1xuICBwcml2YXRlIF9vdXRlclNlbGVjdG9yOiAodmFsdWU6IFRPdXRlcikgPT4gVEtleSB8IFByb21pc2U8VEtleT47XG4gIHByaXZhdGUgX2lubmVyU2VsZWN0b3I6ICh2YWx1ZTogVElubmVyKSA9PiBUS2V5IHwgUHJvbWlzZTxUS2V5PjtcbiAgcHJpdmF0ZSBfcmVzdWx0U2VsZWN0b3I6IChvdXRlcjogVE91dGVyLCBpbm5lcjogQXN5bmNJdGVyYWJsZTxUSW5uZXI+KSA9PiBUUmVzdWx0IHwgUHJvbWlzZTxUUmVzdWx0PjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICAgIG91dGVyOiBBc3luY0l0ZXJhYmxlPFRPdXRlcj4sXG4gICAgICBpbm5lcjogQXN5bmNJdGVyYWJsZTxUSW5uZXI+LFxuICAgICAgb3V0ZXJTZWxlY3RvcjogKHZhbHVlOiBUT3V0ZXIpID0+IFRLZXkgfCBQcm9taXNlPFRLZXk+LFxuICAgICAgaW5uZXJTZWxlY3RvcjogKHZhbHVlOiBUSW5uZXIpID0+IFRLZXkgfCBQcm9taXNlPFRLZXk+LFxuICAgICAgcmVzdWx0U2VsZWN0b3I6IChvdXRlcjogVE91dGVyLCBpbm5lcjogQXN5bmNJdGVyYWJsZTxUSW5uZXI+KSA9PiBUUmVzdWx0IHwgUHJvbWlzZTxUUmVzdWx0Pikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fb3V0ZXIgPSBvdXRlcjtcbiAgICB0aGlzLl9pbm5lciA9IGlubmVyO1xuICAgIHRoaXMuX291dGVyU2VsZWN0b3IgPSBvdXRlclNlbGVjdG9yO1xuICAgIHRoaXMuX2lubmVyU2VsZWN0b3IgPSBpbm5lclNlbGVjdG9yO1xuICAgIHRoaXMuX3Jlc3VsdFNlbGVjdG9yID0gcmVzdWx0U2VsZWN0b3I7XG4gIH1cblxuICBhc3luYyAqW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICBjb25zdCBtYXAgPSBhd2FpdCBjcmVhdGVHcm91cGluZyh0aGlzLl9pbm5lciwgdGhpcy5faW5uZXJTZWxlY3RvciwgaWRlbnRpdHkpO1xuICAgIGZvciBhd2FpdCAobGV0IG91dGVyRWxlbWVudCBvZiB0aGlzLl9vdXRlcikge1xuICAgICAgY29uc3Qgb3V0ZXJLZXkgPSBhd2FpdCB0aGlzLl9vdXRlclNlbGVjdG9yKG91dGVyRWxlbWVudCk7XG4gICAgICBjb25zdCBpbm5lckVsZW1lbnRzID0gbWFwLmhhcyhvdXRlcktleSkgPyA8SXRlcmFibGU8VElubmVyPj5tYXAuZ2V0KG91dGVyS2V5KSA6IGVtcHR5PFRJbm5lcj4oKTtcbiAgICAgIHlpZWxkIGF3YWl0IHRoaXMuX3Jlc3VsdFNlbGVjdG9yKG91dGVyRWxlbWVudCwgZnJvbShpbm5lckVsZW1lbnRzKSk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBncm91cEpvaW48VE91dGVyLCBUSW5uZXIsIFRLZXksIFRSZXN1bHQ+KFxuICAgIG91dGVyOiBBc3luY0l0ZXJhYmxlPFRPdXRlcj4sXG4gICAgaW5uZXI6IEFzeW5jSXRlcmFibGU8VElubmVyPixcbiAgICBvdXRlclNlbGVjdG9yOiAodmFsdWU6IFRPdXRlcikgPT4gVEtleSB8IFByb21pc2U8VEtleT4sXG4gICAgaW5uZXJTZWxlY3RvcjogKHZhbHVlOiBUSW5uZXIpID0+IFRLZXkgfCBQcm9taXNlPFRLZXk+LFxuICAgIHJlc3VsdFNlbGVjdG9yOiAob3V0ZXI6IFRPdXRlciwgaW5uZXI6IEFzeW5jSXRlcmFibGU8VElubmVyPikgPT4gVFJlc3VsdCB8IFByb21pc2U8VFJlc3VsdD4pOiBBc3luY0l0ZXJhYmxlWDxUUmVzdWx0PiB7XG4gIHJldHVybiBuZXcgR3JvdXBKb2luQXN5bmNJdGVyYWJsZTxUT3V0ZXIsIFRJbm5lciwgVEtleSwgVFJlc3VsdD4oXG4gICAgb3V0ZXIsXG4gICAgaW5uZXIsXG4gICAgb3V0ZXJTZWxlY3RvcixcbiAgICBpbm5lclNlbGVjdG9yLFxuICAgIHJlc3VsdFNlbGVjdG9yKTtcbn1cbiJdfQ==
