Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var asynciterable_1 = require("../asynciterable");
var returniterator_1 = require("../internal/returniterator");
var CatchWithAsyncIterable = (function (_super) {
    tslib_1.__extends(CatchWithAsyncIterable, _super);
    function CatchWithAsyncIterable(source, handler) {
        var _this = _super.call(this) || this;
        _this._source = source;
        _this._handler = handler;
        return _this;
    }
    CatchWithAsyncIterable.prototype[Symbol.asyncIterator] = function () {
        return tslib_1.__asyncGenerator(this, arguments, function _a() {
            var err, hasError, it, c, e_1, _a, _b, item, e_2_1, e_2, _c;
            return tslib_1.__generator(this, function (_d) {
                switch (_d.label) {
                    case 0:
                        hasError = false, it = this._source[Symbol.asyncIterator]();
                        _d.label = 1;
                    case 1:
                        if (!1) return [3 /*break*/, 11];
                        c = {};
                        _d.label = 2;
                    case 2:
                        _d.trys.push([2, 6, , 9]);
                        return [4 /*yield*/, tslib_1.__await(it.next())];
                    case 3:
                        c = _d.sent();
                        if (!c.done) return [3 /*break*/, 5];
                        return [4 /*yield*/, tslib_1.__await(returniterator_1.returnAsyncIterator(it))];
                    case 4:
                        _d.sent();
                        return [3 /*break*/, 11];
                    case 5: return [3 /*break*/, 9];
                    case 6:
                        e_1 = _d.sent();
                        return [4 /*yield*/, tslib_1.__await(this._handler(e_1))];
                    case 7:
                        err = _d.sent();
                        hasError = true;
                        return [4 /*yield*/, tslib_1.__await(returniterator_1.returnAsyncIterator(it))];
                    case 8:
                        _d.sent();
                        return [3 /*break*/, 11];
                    case 9: return [4 /*yield*/, c.value];
                    case 10:
                        _d.sent();
                        return [3 /*break*/, 1];
                    case 11:
                        if (!hasError) return [3 /*break*/, 25];
                        _d.label = 12;
                    case 12:
                        _d.trys.push([12, 19, 20, 25]);
                        _a = tslib_1.__asyncValues(err);
                        _d.label = 13;
                    case 13: return [4 /*yield*/, tslib_1.__await(_a.next())];
                    case 14:
                        if (!(_b = _d.sent(), !_b.done)) return [3 /*break*/, 18];
                        return [4 /*yield*/, tslib_1.__await(_b.value)];
                    case 15:
                        item = _d.sent();
                        return [4 /*yield*/, item];
                    case 16:
                        _d.sent();
                        _d.label = 17;
                    case 17: return [3 /*break*/, 13];
                    case 18: return [3 /*break*/, 25];
                    case 19:
                        e_2_1 = _d.sent();
                        e_2 = { error: e_2_1 };
                        return [3 /*break*/, 25];
                    case 20:
                        _d.trys.push([20, , 23, 24]);
                        if (!(_b && !_b.done && (_c = _a.return))) return [3 /*break*/, 22];
                        return [4 /*yield*/, tslib_1.__await(_c.call(_a))];
                    case 21:
                        _d.sent();
                        _d.label = 22;
                    case 22: return [3 /*break*/, 24];
                    case 23:
                        if (e_2) throw e_2.error;
                        return [7 /*endfinally*/];
                    case 24: return [7 /*endfinally*/];
                    case 25: return [2 /*return*/];
                }
            });
        });
    };
    return CatchWithAsyncIterable;
}(asynciterable_1.AsyncIterableX));
function catchWith(source, handler) {
    return new CatchWithAsyncIterable(source, handler);
}
exports.catchWith = catchWith;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvY2F0Y2h3aXRoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsa0RBQWtEO0FBQ2xELDZEQUFpRTtBQUVqRTtJQUE4QyxrREFBdUI7SUFJbkUsZ0NBQ0ksTUFBOEIsRUFDOUIsT0FBaUY7UUFGckYsWUFHRSxpQkFBTyxTQUdSO1FBRkMsS0FBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDdEIsS0FBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7O0lBQzFCLENBQUM7SUFFTSxpQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEdBQTdCOzs7Ozs7d0JBQytDLFFBQVEsR0FBRyxLQUFLLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUM7Ozs2QkFDbEcsQ0FBQzt3QkFDRixDQUFDLEdBQTRCLEVBQUUsQ0FBQzs7Ozt3QkFHOUIscUNBQU0sRUFBRSxDQUFDLElBQUksRUFBRSxHQUFBOzt3QkFBbkIsQ0FBQyxHQUFHLFNBQWUsQ0FBQzs2QkFDaEIsQ0FBQyxDQUFDLElBQUksRUFBTix3QkFBTTt3QkFDUixxQ0FBTSxvQ0FBbUIsQ0FBQyxFQUFFLENBQUMsR0FBQTs7d0JBQTdCLFNBQTZCLENBQUM7d0JBQzlCLHlCQUFNOzs7O3dCQUdGLHFDQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBQyxDQUFDLEdBQUE7O3dCQUE1QixHQUFHLEdBQUcsU0FBc0IsQ0FBQzt3QkFDN0IsUUFBUSxHQUFHLElBQUksQ0FBQzt3QkFDaEIscUNBQU0sb0NBQW1CLENBQUMsRUFBRSxDQUFDLEdBQUE7O3dCQUE3QixTQUE2QixDQUFDO3dCQUM5Qix5QkFBTTs0QkFHUixxQkFBTSxDQUFDLENBQUMsS0FBSyxFQUFBOzt3QkFBYixTQUFhLENBQUM7Ozs2QkFHWixRQUFRLEVBQVIseUJBQVE7Ozs7d0JBQ2EsS0FBQSxzQkFBQSxHQUFJLENBQUE7Ozs7Ozs7d0JBQVosSUFBSSxZQUFBO3dCQUNqQixxQkFBTSxJQUFJLEVBQUE7O3dCQUFWLFNBQVUsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0tBR2hCO0lBQ0gsNkJBQUM7QUFBRCxDQXZDQSxBQXVDQyxDQXZDNkMsOEJBQWMsR0F1QzNEO0FBRUQsbUJBQ0ksTUFBOEIsRUFDOUIsT0FBaUY7SUFDbkYsTUFBTSxDQUFDLElBQUksc0JBQXNCLENBQVUsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQzlELENBQUM7QUFKRCw4QkFJQyIsImZpbGUiOiJhc3luY2l0ZXJhYmxlL2NhdGNod2l0aC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jSXRlcmFibGVYIH0gZnJvbSAnLi4vYXN5bmNpdGVyYWJsZSc7XG5pbXBvcnQgeyByZXR1cm5Bc3luY0l0ZXJhdG9yIH0gZnJvbSAnLi4vaW50ZXJuYWwvcmV0dXJuaXRlcmF0b3InO1xuXG5jbGFzcyBDYXRjaFdpdGhBc3luY0l0ZXJhYmxlPFRTb3VyY2U+IGV4dGVuZHMgQXN5bmNJdGVyYWJsZVg8VFNvdXJjZT4ge1xuICBwcml2YXRlIF9zb3VyY2U6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT47XG4gIHByaXZhdGUgX2hhbmRsZXI6IChlcnJvcjogYW55KSA9PiBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+IHwgUHJvbWlzZTxBc3luY0l0ZXJhYmxlPFRTb3VyY2U+PjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICAgIHNvdXJjZTogQXN5bmNJdGVyYWJsZTxUU291cmNlPixcbiAgICAgIGhhbmRsZXI6IChlcnJvcjogYW55KSA9PiBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+IHwgUHJvbWlzZTxBc3luY0l0ZXJhYmxlPFRTb3VyY2U+Pikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fc291cmNlID0gc291cmNlO1xuICAgIHRoaXMuX2hhbmRsZXIgPSBoYW5kbGVyO1xuICB9XG5cbiAgYXN5bmMgKltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgbGV0IGVycjogQXN5bmNJdGVyYWJsZTxUU291cmNlPiB8IHVuZGVmaW5lZCwgaGFzRXJyb3IgPSBmYWxzZSwgaXQgPSB0aGlzLl9zb3VyY2VbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCk7XG4gICAgd2hpbGUgKDEpIHtcbiAgICAgIGxldCBjID0gPEl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+Pnt9O1xuXG4gICAgICB0cnkge1xuICAgICAgICBjID0gYXdhaXQgaXQubmV4dCgpO1xuICAgICAgICBpZiAoYy5kb25lKSB7XG4gICAgICAgICAgYXdhaXQgcmV0dXJuQXN5bmNJdGVyYXRvcihpdCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgZXJyID0gYXdhaXQgdGhpcy5faGFuZGxlcihlKTtcbiAgICAgICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgICAgICBhd2FpdCByZXR1cm5Bc3luY0l0ZXJhdG9yKGl0KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIHlpZWxkIGMudmFsdWU7XG4gICAgfVxuXG4gICAgaWYgKGhhc0Vycm9yKSB7XG4gICAgICBmb3IgYXdhaXQgKGxldCBpdGVtIG9mIGVyciEpIHtcbiAgICAgICAgeWllbGQgaXRlbTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhdGNoV2l0aDxUU291cmNlPihcbiAgICBzb3VyY2U6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgaGFuZGxlcjogKGVycm9yOiBhbnkpID0+IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4gfCBQcm9taXNlPEFzeW5jSXRlcmFibGU8VFNvdXJjZT4+KTogQXN5bmNJdGVyYWJsZVg8VFNvdXJjZT4ge1xuICByZXR1cm4gbmV3IENhdGNoV2l0aEFzeW5jSXRlcmFibGU8VFNvdXJjZT4oc291cmNlLCBoYW5kbGVyKTtcbn1cbiJdfQ==
