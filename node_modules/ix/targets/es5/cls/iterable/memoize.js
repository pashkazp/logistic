goog.module('targets.es5.cls.iterable.memoize'); exports = {}; var module = {id: 'targets/es5/cls/iterable/memoize.js'};/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

var iterable_1 = goog.require('targets.es5.cls.iterable');
var tsickle_forward_declare_1 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.iterable");
var _refcountlist_1 = goog.require('targets.es5.cls.iterable._refcountlist');
var tsickle_forward_declare_2 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.iterable._refcountlist");
var create_1 = goog.require('targets.es5.cls.iterable.create');
var tsickle_forward_declare_3 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.iterable.create");
/**
 * @template T
 */
var MemoizeBuffer = (function (_super) {
    __extends(MemoizeBuffer, _super);
    /**
     * @param {!Iterator<T>} source
     * @param {!tsickle_forward_declare_2.IRefCountList<T>} buffer
     */
    function MemoizeBuffer(source, buffer) {
        var _this = _super.call(this) || this;
        _this._stopped = false;
        _this._source = source;
        _this._buffer = buffer;
        return _this;
    }
    /**
     * @return {!IterableIterator<T>}
     */
    MemoizeBuffer.prototype[Symbol.iterator] = function () {
        var i, hasValue, current, next;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    i = 0;
                    _a.label = 1;
                case 1:
                    _a.trys.push([1, , 7, 8]);
                    _a.label = 2;
                case 2:
                    if (!1) return [3 /*break*/, 6];
                    hasValue = false, current = ({});
                    if (i >= this._buffer.count) {
                        if (!this._stopped) {
                            try {
                                next = this._source.next();
                                hasValue = !next.done;
                                if (hasValue) {
                                    current = next.value;
                                }
                            }
                            catch (e) {
                                this._error = e;
                                this._stopped = true;
                            }
                        }
                        if (this._stopped) {
                            throw this._error;
                        }
                        if (hasValue) {
                            this._buffer.push(current);
                        }
                    }
                    else {
                        hasValue = true;
                    }
                    if (!hasValue) return [3 /*break*/, 4];
                    return [4 /*yield*/, this._buffer.get(i)];
                case 3:
                    _a.sent();
                    return [3 /*break*/, 5];
                case 4: return [3 /*break*/, 6];
                case 5:
                    i++;
                    return [3 /*break*/, 2];
                case 6: return [3 /*break*/, 8];
                case 7:
                    this._buffer.done();
                    return [7 /*endfinally*/];
                case 8: return [2 /*return*/];
            }
        });
    };
    return MemoizeBuffer;
}(iterable_1.IterableX));
function MemoizeBuffer_tsickle_Closure_declarations() {
    /** @type {!Iterator<T>} */
    MemoizeBuffer.prototype._source;
    /** @type {!tsickle_forward_declare_2.IRefCountList<T>} */
    MemoizeBuffer.prototype._buffer;
    /** @type {?} */
    MemoizeBuffer.prototype._error;
    /** @type {boolean} */
    MemoizeBuffer.prototype._stopped;
}
/**
 * @template TSource, TResult
 * @param {!Iterable<TSource>} source
 * @param {number=} readerCount
 * @param {function(!Iterable<TSource>): !Iterable<TResult>=} selector
 * @return {!tsickle_forward_declare_1.IterableX<(TSource|TResult)>}
 */
function memoize(source, readerCount, selector) {
    if (readerCount === void 0) { readerCount = -1; }
    if (readerCount === -1 && !selector) {
        return new MemoizeBuffer(source[Symbol.iterator](), new _refcountlist_1.MaxRefCountList());
    }
    if (readerCount !== -1 && !selector) {
        return new MemoizeBuffer(source[Symbol.iterator](), new _refcountlist_1.RefCountList(readerCount));
    }
    return create_1.create(function () { /** @type {function(!Iterable<TSource>): !Iterable<TResult>} */ return ((selector))(memoize(source, readerCount))[Symbol.iterator](); });
}
exports.memoize = memoize;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9pdGVyYWJsZS9tZW1vaXplLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRzs7QUFFSCx3Q0FMa0I7QUFNbEIsSUFBTSx5QkFBeUIsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLHNDQUFzQyxDQUFDLENBTnJEO0FBT3hDLGlEQU5xRDtBQU9yRCxJQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsb0RBQW9ELENBQUMsQ0FQNUI7QUFRL0UsbUNBUGU7QUFRZixJQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsNkNBQTZDLENBQUMsQ0FBQztBQUNyRzs7R0FFRztBQVRIO0lBQThCLGlDQUFhO0lBZTNDOzs7T0FHRztJQVpELHVCQUFZLE1BQW1CLEVBQUMsTUFBeUI7UUFBekQsWUFjRSxpQkFiTyxTQWdCUjtRQW5CTSxjQUFTLEdBQVcsS0FBTSxDQUFBO1FBaUIvQixLQWJJLENBQUMsT0FBTyxHQUFFLE1BQU8sQ0FBQztRQWN0QixLQWJJLENBQUMsT0FBTyxHQUFFLE1BQU8sQ0FBQzs7SUFjeEIsQ0FBQztJQUNIOztPQUVHO0lBZEEsd0JBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFsQjs7Ozs7b0JBQ0ssQ0FBRSxHQUFFLENBQUUsQ0FBQzs7Ozs7O3lCQUVELENBQUM7b0JBQ0gsUUFBUyxHQUFFLEtBQU0sRUFBQyxPQUFRLEdBQUEsQ0FBTSxFQUFBLENBQUUsQ0FBQztvQkFnQnRDLEVBQUUsQ0FBQyxDQWZDLENBQUMsSUFBRyxJQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFBLENBQUU7d0JBZ0I1QixFQUFFLENBQUMsQ0FmQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFFOzRCQWdCbkIsSUFmRyxDQUFFO2dDQUNBLElBQUssR0FBRSxJQUFLLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO2dDQWdCL0IsUUFmUSxHQUFFLENBQUUsSUFBSSxDQUFDLElBQUksQ0FBQztnQ0FnQnRCLEVBQUUsQ0FBQyxDQWZDLFFBQVEsQ0FBQyxDQUFBLENBQUU7b0NBQUEsT0FBUSxHQUFFLElBQUssQ0FBQyxLQUFLLENBQUM7Z0NBQUEsQ0FBRTs0QkFnQnpDLENBZkM7NEJBQUEsS0FBQSxDQUFBLENBQVEsQ0FBQyxDQUFDLENBQUEsQ0FBRTtnQ0FnQlgsSUFmSSxDQUFDLE1BQU0sR0FBRSxDQUFFLENBQUM7Z0NBZ0JoQixJQWZJLENBQUMsUUFBUSxHQUFFLElBQUssQ0FBQzs0QkFnQnZCLENBZkM7d0JBZ0JILENBZkM7d0JBaUJELEVBQUUsQ0FBQyxDQWZDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFFOzRCQWdCbEIsTUFmSyxJQUFLLENBQUMsTUFBTSxDQUFDO3dCQWdCcEIsQ0FmQzt3QkFpQkQsRUFBRSxDQUFDLENBZkMsUUFBUSxDQUFDLENBQUEsQ0FBRTs0QkFBQSxJQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFBQSxDQUFFO29CQWdCL0MsQ0FmQztvQkFBQSxJQUFLLENBQUEsQ0FBRTt3QkFnQk4sUUFmUSxHQUFFLElBQUssQ0FBQztvQkFnQmxCLENBZkM7eUJBRUcsUUFBUSxFQUFSLHdCQUFRO29CQWdCVixxQkFmSyxJQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBQTs7b0JBZXpCLFNBZnlCLENBQUM7O3dCQWlCMUIsd0JBZk07O29CQWtCUixDQWZDLEVBQUUsQ0FBQzs7OztvQkFrQk4sSUFmSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQzs7Ozs7S0FFdkI7SUFDSCxvQkFBQTtBQUFBLENBbERBLEFBa0RBLENBbEQ4QixvQkFBVSxHQWtEeEM7QUFpQkE7SUFDQSwyQkFBMkI7SUFDM0IsYUFBYSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUM7SUFDaEMsMERBQTBEO0lBQzFELGFBQWEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDO0lBQ2hDLGdCQUFnQjtJQUNoQixhQUFhLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQztJQUMvQixzQkFBc0I7SUFDdEIsYUFBYSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUM7QUFDakMsQ0FBQztBQVNEOzs7Ozs7R0FNRztBQWpDSCxpQkFtQ0ksTUFsQ3lCLEVBbUN6QixXQWxDd0IsRUFtQ3hCLFFBbEMwRDtJQWlDMUQsNEJBQUEsRUFBQSxlQWxDdUIsQ0FBQztJQW9DMUIsRUFBRSxDQUFDLENBbENDLFdBQVcsS0FBSSxDQUFFLENBQUMsSUFBRyxDQUFFLFFBQVEsQ0FBQyxDQUFBLENBQUU7UUFtQ3BDLE1BbENNLENBQUEsSUFBSSxhQUFjLENBQVUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFDLElBQUksK0JBQWdCLEVBQVcsQ0FBQyxDQUFDO0lBbUMvRixDQWxDQztJQW9DRCxFQUFFLENBQUMsQ0FsQ0MsV0FBVyxLQUFJLENBQUUsQ0FBQyxJQUFHLENBQUUsUUFBUSxDQUFDLENBQUEsQ0FBRTtRQW1DcEMsTUFsQ00sQ0FBQSxJQUFJLGFBQWMsQ0FBVSxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUMsSUFBSSw0QkFBYSxDQUFVLFdBQVcsQ0FBQyxDQUFDLENBQUM7SUFtQ3ZHLENBbENDO0lBb0NELE1BbENNLENBQUEsZUFBTyxDQUFvQixjQUFFLCtEQUFBLENBQUEsT0FBQSxDQUFBLENBQUcsUUFBQSxDQUFBLENBQVUsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFDLFdBQVksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQTlELENBQThELENBQUMsQ0FBQztBQW1DckcsQ0FsQ0M7QUFiRCwwQkFhQyIsImZpbGUiOiJtZW1vaXplLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGVvdmVydmlldyBhZGRlZCBieSB0c2lja2xlXG4gKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9IGNoZWNrZWQgYnkgdHNjXG4gKi9cblxuaW1wb3J0IHsgSXRlcmFibGVYIH0gZnJvbSAnLi4vaXRlcmFibGUnO1xuY29uc3QgdHNpY2tsZV9mb3J3YXJkX2RlY2xhcmVfMSA9IGdvb2cuZm9yd2FyZERlY2xhcmUoXCJfVXNlcnMucHRheWxvci5kZXYuaXhqcy5zcmMuaXRlcmFibGVcIik7XG5pbXBvcnQgeyBJUmVmQ291bnRMaXN0LCBNYXhSZWZDb3VudExpc3QsIFJlZkNvdW50TGlzdCB9IGZyb20gJy4vX3JlZmNvdW50bGlzdCc7XG5jb25zdCB0c2lja2xlX2ZvcndhcmRfZGVjbGFyZV8yID0gZ29vZy5mb3J3YXJkRGVjbGFyZShcIl9Vc2Vycy5wdGF5bG9yLmRldi5peGpzLnNyYy5pdGVyYWJsZS5fcmVmY291bnRsaXN0XCIpO1xuaW1wb3J0IHsgY3JlYXRlIH0gZnJvbSAnLi9jcmVhdGUnO1xuY29uc3QgdHNpY2tsZV9mb3J3YXJkX2RlY2xhcmVfMyA9IGdvb2cuZm9yd2FyZERlY2xhcmUoXCJfVXNlcnMucHRheWxvci5kZXYuaXhqcy5zcmMuaXRlcmFibGUuY3JlYXRlXCIpO1xuLyoqXG4gKiBAdGVtcGxhdGUgVFxuICovXG5jbGFzcyBNZW1vaXplQnVmZmVyPFQ+IGV4dGVuZHMgSXRlcmFibGVYPFQ+IHtcbnByaXZhdGUgX3NvdXJjZTogSXRlcmF0b3I8VD47XG5wcml2YXRlIF9idWZmZXI6IElSZWZDb3VudExpc3Q8VD47XG5wcml2YXRlIF9lcnJvcjogYW55O1xucHJpdmF0ZSBfc3RvcHBlZDogYm9vbGVhbiA9IGZhbHNlO1xuLyoqXG4gKiBAcGFyYW0geyFJdGVyYXRvcjxUPn0gc291cmNlXG4gKiBAcGFyYW0geyF0c2lja2xlX2ZvcndhcmRfZGVjbGFyZV8yLklSZWZDb3VudExpc3Q8VD59IGJ1ZmZlclxuICovXG5jb25zdHJ1Y3Rvcihzb3VyY2U6IEl0ZXJhdG9yPFQ+LCBidWZmZXI6IElSZWZDb3VudExpc3Q8VD4pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3NvdXJjZSA9IHNvdXJjZTtcbiAgICB0aGlzLl9idWZmZXIgPSBidWZmZXI7XG4gIH1cbi8qKlxuICogQHJldHVybiB7IUl0ZXJhYmxlSXRlcmF0b3I8VD59XG4gKi9cbipbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICBsZXQgLyoqIEB0eXBlIHtudW1iZXJ9ICovIGkgPSAwO1xuICAgIHRyeSB7XG4gICAgICB3aGlsZSAoMSkge1xuICAgICAgICBsZXQgLyoqIEB0eXBlIHtib29sZWFufSAqLyBoYXNWYWx1ZSA9IGZhbHNlLCAvKiogQHR5cGUge1R9ICovIGN1cnJlbnQgPSAvKiogQHR5cGUge1R9ICovKCggPFQ+e30pKTtcbiAgICAgICAgaWYgKGkgPj0gdGhpcy5fYnVmZmVyLmNvdW50KSB7XG4gICAgICAgICAgaWYgKCF0aGlzLl9zdG9wcGVkKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBsZXQgLyoqIEB0eXBlIHshSXRlcmF0b3JSZXN1bHQ8VD59ICovIG5leHQgPSB0aGlzLl9zb3VyY2UubmV4dCgpO1xuICAgICAgICAgICAgICBoYXNWYWx1ZSA9ICFuZXh0LmRvbmU7XG4gICAgICAgICAgICAgIGlmIChoYXNWYWx1ZSkgeyBjdXJyZW50ID0gbmV4dC52YWx1ZTsgfVxuICAgICAgICAgICAgfSBjYXRjaCAoIC8qKiBAdHlwZSB7P30gKi9lKSB7XG4gICAgICAgICAgICAgIHRoaXMuX2Vycm9yID0gZTtcbiAgICAgICAgICAgICAgdGhpcy5fc3RvcHBlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHRoaXMuX3N0b3BwZWQpIHtcbiAgICAgICAgICAgIHRocm93IHRoaXMuX2Vycm9yO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChoYXNWYWx1ZSkgeyB0aGlzLl9idWZmZXIucHVzaChjdXJyZW50KTsgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGhhc1ZhbHVlID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChoYXNWYWx1ZSkge1xuICAgICAgICAgIHlpZWxkIHRoaXMuX2J1ZmZlci5nZXQoaSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpKys7XG4gICAgICB9XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuX2J1ZmZlci5kb25lKCk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIE1lbW9pemVCdWZmZXJfdHNpY2tsZV9DbG9zdXJlX2RlY2xhcmF0aW9ucygpIHtcbi8qKiBAdHlwZSB7IUl0ZXJhdG9yPFQ+fSAqL1xuTWVtb2l6ZUJ1ZmZlci5wcm90b3R5cGUuX3NvdXJjZTtcbi8qKiBAdHlwZSB7IXRzaWNrbGVfZm9yd2FyZF9kZWNsYXJlXzIuSVJlZkNvdW50TGlzdDxUPn0gKi9cbk1lbW9pemVCdWZmZXIucHJvdG90eXBlLl9idWZmZXI7XG4vKiogQHR5cGUgez99ICovXG5NZW1vaXplQnVmZmVyLnByb3RvdHlwZS5fZXJyb3I7XG4vKiogQHR5cGUge2Jvb2xlYW59ICovXG5NZW1vaXplQnVmZmVyLnByb3RvdHlwZS5fc3RvcHBlZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1lbW9pemU8VFNvdXJjZT4oXG4gIHNvdXJjZTogSXRlcmFibGU8VFNvdXJjZT4sXG4gIHJlYWRlckNvdW50PzogbnVtYmVyKTogSXRlcmFibGVYPFRTb3VyY2U+O1xuZXhwb3J0IGZ1bmN0aW9uIG1lbW9pemU8VFNvdXJjZSwgVFJlc3VsdD4oXG4gIHNvdXJjZTogSXRlcmFibGU8VFNvdXJjZT4sXG4gIHJlYWRlckNvdW50PzogbnVtYmVyLFxuICBzZWxlY3Rvcj86ICh2YWx1ZTogSXRlcmFibGU8VFNvdXJjZT4pID0+IEl0ZXJhYmxlPFRSZXN1bHQ+KTogSXRlcmFibGVYPFRSZXN1bHQ+O1xuLyoqXG4gKiBAdGVtcGxhdGUgVFNvdXJjZSwgVFJlc3VsdFxuICogQHBhcmFtIHshSXRlcmFibGU8VFNvdXJjZT59IHNvdXJjZVxuICogQHBhcmFtIHtudW1iZXI9fSByZWFkZXJDb3VudFxuICogQHBhcmFtIHtmdW5jdGlvbighSXRlcmFibGU8VFNvdXJjZT4pOiAhSXRlcmFibGU8VFJlc3VsdD49fSBzZWxlY3RvclxuICogQHJldHVybiB7IXRzaWNrbGVfZm9yd2FyZF9kZWNsYXJlXzEuSXRlcmFibGVYPChUU291cmNlfFRSZXN1bHQpPn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1lbW9pemU8VFNvdXJjZSwgVFJlc3VsdCA9IFRTb3VyY2U+KFxuICAgIHNvdXJjZTogSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgcmVhZGVyQ291bnQ6IG51bWJlciA9IC0xLFxuICAgIHNlbGVjdG9yPzogKHZhbHVlOiBJdGVyYWJsZTxUU291cmNlPikgPT4gSXRlcmFibGU8VFJlc3VsdD4pOiBJdGVyYWJsZVg8VFNvdXJjZSB8IFRSZXN1bHQ+IHtcbiAgaWYgKHJlYWRlckNvdW50ID09PSAtMSAmJiAhc2VsZWN0b3IpIHtcbiAgICByZXR1cm4gbmV3IE1lbW9pemVCdWZmZXI8VFNvdXJjZT4oc291cmNlW1N5bWJvbC5pdGVyYXRvcl0oKSwgbmV3IE1heFJlZkNvdW50TGlzdDxUU291cmNlPigpKTtcbiAgfVxuXG4gIGlmIChyZWFkZXJDb3VudCAhPT0gLTEgJiYgIXNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIG5ldyBNZW1vaXplQnVmZmVyPFRTb3VyY2U+KHNvdXJjZVtTeW1ib2wuaXRlcmF0b3JdKCksIG5ldyBSZWZDb3VudExpc3Q8VFNvdXJjZT4ocmVhZGVyQ291bnQpKTtcbiAgfVxuXG4gIHJldHVybiBjcmVhdGU8VFNvdXJjZSB8IFRSZXN1bHQ+KCgpID0+IC8qKiBAdHlwZSB7ZnVuY3Rpb24oIUl0ZXJhYmxlPFRTb3VyY2U+KTogIUl0ZXJhYmxlPFRSZXN1bHQ+fSAqLygoIHNlbGVjdG9yKSkobWVtb2l6ZShzb3VyY2UsIHJlYWRlckNvdW50KSlbU3ltYm9sLml0ZXJhdG9yXSgpKTtcbn1cbiJdfQ==