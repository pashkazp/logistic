goog.module('targets.es5.cls.asyncsink'); exports = {}; var module = {id: 'targets/es5/cls/asyncsink.js'};/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

var /** @type {string} */ ARRAY_VALUE = 'value';
var /** @type {string} */ ARRAY_ERROR = 'error';
/**
 * @record
 * @template T
 */
function AsyncSinkItem() { }
function AsyncSinkItem_tsickle_Closure_declarations() {
    /** @type {string} */
    AsyncSinkItem.prototype.type;
    /** @type {T} */
    AsyncSinkItem.prototype.value;
    /** @type {?|undefined} */
    AsyncSinkItem.prototype.error;
}
/**
 * @record
 * @template T
 */
function AsyncResolver() { }
function AsyncResolver_tsickle_Closure_declarations() {
    /** @type {function((T|!PromiseLike<T>)): void} */
    AsyncResolver.prototype.resolve;
    /** @type {function(?): void} */
    AsyncResolver.prototype.reject;
}
/**
 * @template TSource
 * @implements {AsyncIterableIterator}
 */
var AsyncSink = (function () {
    function AsyncSink() {
        this._ended = false;
        this._values = [];
        this._resolvers = [];
    }
    /**
     * @return {AsyncSink}
     */
    AsyncSink.prototype[Symbol.asyncIterator] = function () {
        return this;
    };
    /**
     * @param {TSource} value
     * @return {void}
     */
    AsyncSink.prototype.write = function (value) {
        this._push({ type: ARRAY_VALUE, value: value });
    };
    /**
     * @param {?} error
     * @return {void}
     */
    AsyncSink.prototype.error = function (error) {
        this._push({ type: ARRAY_ERROR, error: error });
    };
    /**
     * @param {!AsyncSinkItem<TSource>} item
     * @return {void}
     */
    AsyncSink.prototype._push = function (item) {
        if (this._ended) {
            throw new Error('AsyncSink already ended');
        }
        if (this._resolvers.length > 0) {
            var _a = ((this._resolvers.shift())), resolve = _a.resolve, reject = _a.reject;
            if (item.type === ARRAY_ERROR) {
                reject(/** @type {?} */ ((item.error)));
            }
            else {
                resolve({ done: false, value: /** @type {TSource} */ ((item.value)) });
            }
        }
        else {
            this._values.push(item);
        }
    };
    /**
     * @return {!Promise<!IteratorResult<TSource>>}
     */
    AsyncSink.prototype.next = function () {
        var _this = this;
        if (this._values.length > 0) {
            var _a = ((this._values.shift())), type = _a.type, value = _a.value, error = _a.error;
            if (type === ARRAY_ERROR) {
                return Promise.reject(error);
            }
            else {
                return Promise.resolve(/** @type {!IteratorResult<TSource>} */ ({ done: false, value: value }));
            }
        }
        if (this._ended) {
            return Promise.resolve(/** @type {!IteratorResult<TSource>} */ ({ done: true }));
        }
        return new Promise(function (resolve, reject) {
            _this._resolvers.push({ resolve: resolve, reject: reject });
        });
    };
    /**
     * @return {void}
     */
    AsyncSink.prototype.end = function () {
        while (this._resolvers.length > 0) {
            ((this._resolvers.shift())).resolve(/** @type {!IteratorResult<TSource>} */ ({ done: true }));
        }
        this._ended = true;
    };
    return AsyncSink;
}());
exports.AsyncSink = AsyncSink;
function AsyncSink_tsickle_Closure_declarations() {
    /** @type {boolean} */
    AsyncSink.prototype._ended;
    /** @type {!Array<!AsyncSinkItem<TSource>>} */
    AsyncSink.prototype._values;
    /** @type {!Array<!AsyncResolver<!IteratorResult<TSource>>>} */
    AsyncSink.prototype._resolvers;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hc3luY3NpbmsudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHOztBQUhILElBQUEscUJBQUssQ0FBQSxXQUFZLEdBQUUsT0FBUSxDQUFDO0FBTTVCLElBQU0scUJBTEQsQ0FBQSxXQUFZLEdBQUUsT0FBUSxDQUFBO0FBTTNCOzs7R0FHRztBQUNILDJCQUEwQixDQUFDO0FBRzNCO0lBQ0EscUJBQXFCO0lBQ3JCLGFBQWEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDO0lBQzdCLGdCQUFnQjtJQUNoQixhQUFhLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQztJQUM5QiwwQkFBMEI7SUFDMUIsYUFBYSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7QUFDOUIsQ0FBQztBQVFEOzs7R0FHRztBQUNILDJCQUEwQixDQUFDO0FBRzNCO0lBQ0Esa0RBQWtEO0lBQ2xELGFBQWEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDO0lBQ2hDLGdDQUFnQztJQUNoQyxhQUFhLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQztBQUMvQixDQUFDO0FBT0Q7OztHQUdHO0FBckNIO0lBS0U7UUFzQ0UsSUFyQ0ksQ0FBQyxNQUFNLEdBQUUsS0FBTSxDQUFDO1FBc0NwQixJQXJDSSxDQUFDLE9BQU8sR0FBRSxFQUFHLENBQUM7UUFzQ2xCLElBckNJLENBQUMsVUFBVSxHQUFFLEVBQUcsQ0FBQztJQXNDdkIsQ0FBQztJQUNIOztPQUVHO0lBdENELG9CQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsR0FBdEI7UUF3Q0UsTUF2Q00sQ0FBQSxJQUFLLENBQUM7SUF3Q2QsQ0FBQztJQUNIOzs7T0FHRztJQXpDRCx5QkFBSyxHQUFMLFVBQU0sS0FBYztRQTJDbEIsSUExQ0ksQ0FBQyxLQUFLLENBQUMsRUFBQyxJQUFLLEVBQUMsV0FBWSxFQUFDLEtBQU0sT0FBQSxFQUFFLENBQUMsQ0FBQztJQTJDM0MsQ0FBQztJQUNIOzs7T0FHRztJQTVDRCx5QkFBSyxHQUFMLFVBQU0sS0FBVTtRQThDZCxJQTdDSSxDQUFDLEtBQUssQ0FBQyxFQUFDLElBQUssRUFBQyxXQUFZLEVBQUMsS0FBTSxPQUFBLEVBQUUsQ0FBQyxDQUFDO0lBOEMzQyxDQUFDO0lBQ0g7OztPQUdHO0lBL0NNLHlCQUFNLEdBQWIsVUFBYyxJQUE0QjtRQWtEeEMsRUFBRSxDQUFDLENBakRDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQSxDQUFFO1lBa0RoQixNQWpESyxJQUFJLEtBQU0sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1FBa0Q3QyxDQWpEQztRQW1ERCxFQUFFLENBQUMsQ0FqREMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUUsQ0FBRSxDQUFDLENBQUEsQ0FBRTtZQUMxQixJQUFBLGdDQUE4QyxFQUE1QyxvQkFBTyxFQUFDLGtCQUFPLENBQThCO1lBa0RwRCxFQUFFLENBQUMsQ0FqREMsSUFBSSxDQUFDLElBQUksS0FBSSxXQUFZLENBQUMsQ0FBQSxDQUFFO2dCQWtEOUIsTUFqRE0sQ0FBQSxnQkFBQSxDQUFBLENBQUEsQ0FBQyxJQUFJLENBQUMsS0FBQSxDQUFBLENBQU0sQ0FBQyxDQUFDO1lBa0R0QixDQWpEQztZQUFBLElBQUssQ0FBQSxDQUFFO2dCQWtETixPQWpETyxDQUFDLEVBQUMsSUFBSyxFQUFDLEtBQU0sRUFBQyxLQUFNLEVBQUEsc0JBQUEsQ0FBQSxDQUFBLENBQUMsSUFBSyxDQUFDLEtBQUEsQ0FBQSxDQUFNLEVBQUUsQ0FBQyxDQUFDO1lBa0QvQyxDQWpEQztRQWtESCxDQWpEQztRQUFBLElBQUssQ0FBQSxDQUFFO1lBa0ROLElBakRJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQWtEMUIsQ0FqREM7SUFrREgsQ0FBQztJQUNIOztPQUVHO0lBbERELHdCQUFJLEdBQUo7UUFBQSxpQkFvRUM7UUFoQkMsRUFBRSxDQUFDLENBbkRDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFFLENBQUUsQ0FBQyxDQUFBLENBQUU7WUFDdkIsSUFBQSw2QkFBK0MsRUFBN0MsY0FBSyxFQUFDLGdCQUFNLEVBQUMsZ0JBQU0sQ0FBMkI7WUFvRHJELEVBQUUsQ0FBQyxDQW5EQyxJQUFJLEtBQUksV0FBWSxDQUFDLENBQUEsQ0FBRTtnQkFvRHpCLE1BbkRNLENBQUEsT0FBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQW9EL0IsQ0FuREM7WUFBQSxJQUFLLENBQUEsQ0FBRTtnQkFvRE4sTUFuRE0sQ0FBQSxPQUFRLENBQUMsT0FBTyxDQUFBLHVDQUFBLENBQUEsQ0FBQyxFQUFDLElBQUssRUFBQyxLQUFNLEVBQUMsS0FBTSxPQUFBLEVBQTRCLENBQUMsQ0FBQyxDQUFDO1lBb0Q1RSxDQW5EQztRQW9ESCxDQW5EQztRQXFERCxFQUFFLENBQUMsQ0FuREMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBLENBQUU7WUFvRGhCLE1BbkRNLENBQUEsT0FBUSxDQUFDLE9BQU8sQ0FBQSx1Q0FBQSxDQUFBLENBQUMsRUFBQyxJQUFLLEVBQUMsSUFBSyxFQUE0QixDQUFDLENBQUMsQ0FBQztRQW9EcEUsQ0FuREM7UUFxREQsTUFuRE0sQ0FBQSxJQUFJLE9BQVEsQ0FBMEIsVUFBQyxPQUFPLEVBQUMsTUFBTztZQW9EMUQsS0FuREksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUMsT0FBUSxTQUFBLEVBQUMsTUFBTyxRQUFBLEVBQUUsQ0FBQyxDQUFDO1FBb0Q1QyxDQW5EQyxDQUFDLENBQUM7SUFvREwsQ0FBQztJQUNIOztPQUVHO0lBcERELHVCQUFHLEdBQUg7UUFzREUsT0FyRE8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUUsQ0FBRSxFQUFDLENBQUE7WUFBQSxDQUFBLENBc0RoQyxJQXJESSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUEsQ0FBQSxDQUFHLENBQUMsT0FBTyxDQUFBLHVDQUFBLENBQUEsQ0FBQyxFQUFDLElBQUssRUFBQyxJQUFLLEVBQTRCLENBQUMsQ0FBQyxDQUFDO1FBc0Q5RSxDQXJEQztRQXNERCxJQXJESSxDQUFDLE1BQU0sR0FBRSxJQUFLLENBQUM7SUFzRHJCLENBckRDO0lBQ0gsZ0JBQUE7QUFBQSxDQWpFQSxBQWlFQSxJQUFBO0FBakVZLDhCQUFVO0FBd0h0QjtJQUNBLHNCQUFzQjtJQUN0QixTQUFTLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQztJQUMzQiw4Q0FBOEM7SUFDOUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUM7SUFDNUIsK0RBQStEO0lBQy9ELFNBQVMsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDO0FBQy9CLENBQUMiLCJmaWxlIjoiYXN5bmNzaW5rLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGVvdmVydmlldyBhZGRlZCBieSB0c2lja2xlXG4gKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9IGNoZWNrZWQgYnkgdHNjXG4gKi9cblxuY29uc3QgLyoqIEB0eXBlIHtzdHJpbmd9ICovIEFSUkFZX1ZBTFVFID0gJ3ZhbHVlJztcbmNvbnN0IC8qKiBAdHlwZSB7c3RyaW5nfSAqLyBBUlJBWV9FUlJPUiA9ICdlcnJvcic7XG4vKipcbiAqIEByZWNvcmRcbiAqIEB0ZW1wbGF0ZSBUXG4gKi9cbmZ1bmN0aW9uIEFzeW5jU2lua0l0ZW0oKSB7fVxuXG5cbmZ1bmN0aW9uIEFzeW5jU2lua0l0ZW1fdHNpY2tsZV9DbG9zdXJlX2RlY2xhcmF0aW9ucygpIHtcbi8qKiBAdHlwZSB7c3RyaW5nfSAqL1xuQXN5bmNTaW5rSXRlbS5wcm90b3R5cGUudHlwZTtcbi8qKiBAdHlwZSB7VH0gKi9cbkFzeW5jU2lua0l0ZW0ucHJvdG90eXBlLnZhbHVlO1xuLyoqIEB0eXBlIHs/fHVuZGVmaW5lZH0gKi9cbkFzeW5jU2lua0l0ZW0ucHJvdG90eXBlLmVycm9yO1xufVxuXG5cbmludGVyZmFjZSBBc3luY1NpbmtJdGVtPFQ+IHtcbiAgdHlwZTogc3RyaW5nO1xuICB2YWx1ZT86IFQ7XG4gIGVycm9yPzogYW55O1xufVxuLyoqXG4gKiBAcmVjb3JkXG4gKiBAdGVtcGxhdGUgVFxuICovXG5mdW5jdGlvbiBBc3luY1Jlc29sdmVyKCkge31cblxuXG5mdW5jdGlvbiBBc3luY1Jlc29sdmVyX3RzaWNrbGVfQ2xvc3VyZV9kZWNsYXJhdGlvbnMoKSB7XG4vKiogQHR5cGUge2Z1bmN0aW9uKChUfCFQcm9taXNlTGlrZTxUPikpOiB2b2lkfSAqL1xuQXN5bmNSZXNvbHZlci5wcm90b3R5cGUucmVzb2x2ZTtcbi8qKiBAdHlwZSB7ZnVuY3Rpb24oPyk6IHZvaWR9ICovXG5Bc3luY1Jlc29sdmVyLnByb3RvdHlwZS5yZWplY3Q7XG59XG5cblxuaW50ZXJmYWNlIEFzeW5jUmVzb2x2ZXI8VD4ge1xuICByZXNvbHZlOiAodmFsdWU/OiBUIHwgUHJvbWlzZUxpa2U8VD4gfCB1bmRlZmluZWQpID0+IHZvaWQ7XG4gIHJlamVjdDogKHJlYXNvbj86IGFueSkgPT4gdm9pZDtcbn1cbi8qKlxuICogQHRlbXBsYXRlIFRTb3VyY2VcbiAqIEBpbXBsZW1lbnRzIHtBc3luY0l0ZXJhYmxlSXRlcmF0b3J9XG4gKi9cbmV4cG9ydCBjbGFzcyBBc3luY1Npbms8VFNvdXJjZT4gaW1wbGVtZW50cyBBc3luY0l0ZXJhYmxlSXRlcmF0b3I8VFNvdXJjZT4ge1xucHJpdmF0ZSBfZW5kZWQ6IGJvb2xlYW47XG5wcml2YXRlIF92YWx1ZXM6IEFzeW5jU2lua0l0ZW08VFNvdXJjZT5bXTtcbnByaXZhdGUgX3Jlc29sdmVyczogQXN5bmNSZXNvbHZlcjxJdGVyYXRvclJlc3VsdDxUU291cmNlPj5bXTtcbmNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuX2VuZGVkID0gZmFsc2U7XG4gICAgdGhpcy5fdmFsdWVzID0gW107XG4gICAgdGhpcy5fcmVzb2x2ZXJzID0gW107XG4gIH1cbi8qKlxuICogQHJldHVybiB7QXN5bmNTaW5rfVxuICovXG5bU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4vKipcbiAqIEBwYXJhbSB7VFNvdXJjZX0gdmFsdWVcbiAqIEByZXR1cm4ge3ZvaWR9XG4gKi9cbndyaXRlKHZhbHVlOiBUU291cmNlKSB7XG4gICAgdGhpcy5fcHVzaCh7IHR5cGU6IEFSUkFZX1ZBTFVFLCB2YWx1ZSB9KTtcbiAgfVxuLyoqXG4gKiBAcGFyYW0gez99IGVycm9yXG4gKiBAcmV0dXJuIHt2b2lkfVxuICovXG5lcnJvcihlcnJvcjogYW55KSB7XG4gICAgdGhpcy5fcHVzaCh7IHR5cGU6IEFSUkFZX0VSUk9SLCBlcnJvciB9KTtcbiAgfVxuLyoqXG4gKiBAcGFyYW0geyFBc3luY1NpbmtJdGVtPFRTb3VyY2U+fSBpdGVtXG4gKiBAcmV0dXJuIHt2b2lkfVxuICovXG5cbnByaXZhdGUgX3B1c2goaXRlbTogQXN5bmNTaW5rSXRlbTxUU291cmNlPikge1xuICAgIGlmICh0aGlzLl9lbmRlZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBc3luY1NpbmsgYWxyZWFkeSBlbmRlZCcpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLl9yZXNvbHZlcnMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3Qge3Jlc29sdmUsIHJlamVjdCB9ID0gLyoqIEB0eXBlIHshQXN5bmNSZXNvbHZlcjwhSXRlcmF0b3JSZXN1bHQ8VFNvdXJjZT4+fSAqLygoIHRoaXMuX3Jlc29sdmVycy5zaGlmdCgpKSk7XG4gICAgICBpZiAoaXRlbS50eXBlID09PSBBUlJBWV9FUlJPUikge1xuICAgICAgICByZWplY3QoIC8qKiBAdHlwZSB7P30gKi8oKGl0ZW0uZXJyb3IpKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNvbHZlKHsgZG9uZTogZmFsc2UsIHZhbHVlOiAvKiogQHR5cGUge1RTb3VyY2V9ICovKCggaXRlbS52YWx1ZSkpIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl92YWx1ZXMucHVzaChpdGVtKTtcbiAgICB9XG4gIH1cbi8qKlxuICogQHJldHVybiB7IVByb21pc2U8IUl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+Pn1cbiAqL1xubmV4dCgpIHtcbiAgICBpZiAodGhpcy5fdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHsgdHlwZSwgdmFsdWUsIGVycm9yIH0gPSAvKiogQHR5cGUgeyFBc3luY1NpbmtJdGVtPFRTb3VyY2U+fSAqLygoIHRoaXMuX3ZhbHVlcy5zaGlmdCgpKSk7XG4gICAgICBpZiAodHlwZSA9PT0gQVJSQVlfRVJST1IpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoIC8qKiBAdHlwZSB7IUl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+fSAqLygoeyBkb25lOiBmYWxzZSwgdmFsdWUgfSBhcyBJdGVyYXRvclJlc3VsdDxUU291cmNlPikpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5fZW5kZWQpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoIC8qKiBAdHlwZSB7IUl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+fSAqLygoeyBkb25lOiB0cnVlIH0gYXMgSXRlcmF0b3JSZXN1bHQ8VFNvdXJjZT4pKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPEl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLl9yZXNvbHZlcnMucHVzaCh7IHJlc29sdmUsIHJlamVjdCB9KTtcbiAgICB9KTtcbiAgfVxuLyoqXG4gKiBAcmV0dXJuIHt2b2lkfVxuICovXG5lbmQoKSB7XG4gICAgd2hpbGUgKHRoaXMuX3Jlc29sdmVycy5sZW5ndGggPiAwKSB7IC8qKiBAdHlwZSB7IUFzeW5jUmVzb2x2ZXI8IUl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+Pn0gKi8oKFxuICAgICAgdGhpcy5fcmVzb2x2ZXJzLnNoaWZ0KCkpKS5yZXNvbHZlKCAvKiogQHR5cGUgeyFJdGVyYXRvclJlc3VsdDxUU291cmNlPn0gKi8oKHsgZG9uZTogdHJ1ZSB9IGFzIEl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+KSkpO1xuICAgIH1cbiAgICB0aGlzLl9lbmRlZCA9IHRydWU7XG4gIH1cbn1cblxuZnVuY3Rpb24gQXN5bmNTaW5rX3RzaWNrbGVfQ2xvc3VyZV9kZWNsYXJhdGlvbnMoKSB7XG4vKiogQHR5cGUge2Jvb2xlYW59ICovXG5Bc3luY1NpbmsucHJvdG90eXBlLl9lbmRlZDtcbi8qKiBAdHlwZSB7IUFycmF5PCFBc3luY1NpbmtJdGVtPFRTb3VyY2U+Pn0gKi9cbkFzeW5jU2luay5wcm90b3R5cGUuX3ZhbHVlcztcbi8qKiBAdHlwZSB7IUFycmF5PCFBc3luY1Jlc29sdmVyPCFJdGVyYXRvclJlc3VsdDxUU291cmNlPj4+fSAqL1xuQXN5bmNTaW5rLnByb3RvdHlwZS5fcmVzb2x2ZXJzO1xufVxuXG4iXX0=