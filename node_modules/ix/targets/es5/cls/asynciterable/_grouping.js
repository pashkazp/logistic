goog.module('targets.es5.cls.asynciterable._grouping'); exports = {}; var module = {id: 'targets/es5/cls/asynciterable/_grouping.js'};/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

/**
 * @ignore
 * @template TSource, TKey, TValue
 * @param {!AsyncIterable<TSource>} source
 * @param {function(TSource): (TKey|!Promise<TKey>)} keySelector
 * @param {function(TSource): (TValue|!Promise<TValue>)} elementSelector
 * @return {!Promise<!Map<TKey, !Array<TValue>>>}
 */
function createGrouping(source, keySelector, elementSelector) {
    return __awaiter(this, void 0, void 0, function () {
        var map, source_1, source_1_1, item, key, grouping, element, e_1_1, e_1, _a;
        return __generator(this, function (_b) {
            switch (_b.label) {
                case 0:
                    map = new Map();
                    _b.label = 1;
                case 1:
                    _b.trys.push([1, 9, 10, 15]);
                    source_1 = __asyncValues(source);
                    _b.label = 2;
                case 2: return [4 /*yield*/, source_1.next()];
                case 3:
                    if (!(source_1_1 = _b.sent(), !source_1_1.done)) return [3 /*break*/, 8];
                    return [4 /*yield*/, source_1_1.value];
                case 4:
                    item = _b.sent();
                    return [4 /*yield*/, keySelector(item)];
                case 5:
                    key = _b.sent();
                    grouping = map.get(key);
                    if (!map.has(key)) {
                        grouping = [];
                        map.set(key, grouping);
                    }
                    return [4 /*yield*/, elementSelector(item)];
                case 6:
                    element = _b.sent();
                    ((grouping)).push(element);
                    _b.label = 7;
                case 7: return [3 /*break*/, 2];
                case 8: return [3 /*break*/, 15];
                case 9:
                    e_1_1 = _b.sent();
                    e_1 = { error: e_1_1 };
                    return [3 /*break*/, 15];
                case 10:
                    _b.trys.push([10, , 13, 14]);
                    if (!(source_1_1 && !source_1_1.done && (_a = source_1.return))) return [3 /*break*/, 12];
                    return [4 /*yield*/, _a.call(source_1)];
                case 11:
                    _b.sent();
                    _b.label = 12;
                case 12: return [3 /*break*/, 14];
                case 13:
                    if (e_1) throw e_1.error;
                    return [7 /*endfinally*/];
                case 14: return [7 /*endfinally*/];
                case 15: return [2 /*return*/, map];
            }
        });
    });
}
exports.createGrouping = createGrouping;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hc3luY2l0ZXJhYmxlL19ncm91cGluZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7O0FBR0g7Ozs7Ozs7R0FPRztBQVZILHdCQVlJLE1BWDhCLEVBWTlCLFdBWHFELEVBWXJELGVBWDZEOzs7Ozs7b0JBQzVELEdBQUksR0FBRSxJQUFJLEdBQUksRUFBa0IsQ0FBQzs7OztvQkFDZCxXQUFBLGNBQUEsTUFBTyxDQUFBOzs7Ozs7O29CQUFmLElBQUssWUFBQTtvQkFDUixxQkFBTSxXQUFZLENBQUMsSUFBSSxDQUFDLEVBQUE7O29CQUE5QixHQUFJLEdBQUUsU0FBd0I7b0JBQzlCLFFBQVMsR0FBRSxHQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQVk1QixFQUFFLENBQUMsQ0FYQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQSxDQUFFO3dCQVlsQixRQVhRLEdBQUUsRUFBRyxDQUFDO3dCQVlkLEdBWEcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFDLFFBQVMsQ0FBQyxDQUFDO29CQVl6QixDQVhDO29CQUNZLHFCQUFNLGVBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUE7O29CQUF0QyxPQUFRLEdBQUUsU0FBNEI7b0JBQUEsQ0FBQSxDQVl6QyxRQUFRLENBQUMsQ0FYQSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7eUJBYzFCLHNCQVhNLEdBQUksRUFBQzs7OztDQUNaO0FBakJELHdDQWlCQyIsImZpbGUiOiJfZ3JvdXBpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IGFkZGVkIGJ5IHRzaWNrbGVcbiAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlc30gY2hlY2tlZCBieSB0c2NcbiAqL1xuXG5cbi8qKlxuICogQGlnbm9yZVxuICogQHRlbXBsYXRlIFRTb3VyY2UsIFRLZXksIFRWYWx1ZVxuICogQHBhcmFtIHshQXN5bmNJdGVyYWJsZTxUU291cmNlPn0gc291cmNlXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFRTb3VyY2UpOiAoVEtleXwhUHJvbWlzZTxUS2V5Pil9IGtleVNlbGVjdG9yXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFRTb3VyY2UpOiAoVFZhbHVlfCFQcm9taXNlPFRWYWx1ZT4pfSBlbGVtZW50U2VsZWN0b3JcbiAqIEByZXR1cm4geyFQcm9taXNlPCFNYXA8VEtleSwgIUFycmF5PFRWYWx1ZT4+Pn1cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUdyb3VwaW5nPFRTb3VyY2UsIFRLZXksIFRWYWx1ZT4oXG4gICAgc291cmNlOiBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+LFxuICAgIGtleVNlbGVjdG9yOiAodmFsdWU6IFRTb3VyY2UpID0+IFRLZXkgfCBQcm9taXNlPFRLZXk+LFxuICAgIGVsZW1lbnRTZWxlY3RvcjogKHZhbHVlOiBUU291cmNlKSA9PiBUVmFsdWUgfCBQcm9taXNlPFRWYWx1ZT4pOiBQcm9taXNlPE1hcDxUS2V5LCBUVmFsdWVbXT4+IHtcbiAgbGV0IC8qKiBAdHlwZSB7IU1hcDxUS2V5LCAhQXJyYXk8VFZhbHVlPj59ICovIG1hcCA9IG5ldyBNYXA8VEtleSwgVFZhbHVlW10+KCk7XG4gIGZvciBhd2FpdCAobGV0IC8qKiBAdHlwZSB7VFNvdXJjZX0gKi8gaXRlbSBvZiBzb3VyY2UpIHtcbiAgICBsZXQgLyoqIEB0eXBlIHtUS2V5fSAqLyBrZXkgPSBhd2FpdCBrZXlTZWxlY3RvcihpdGVtKTtcbiAgICBsZXQgLyoqIEB0eXBlIHshQXJyYXk8VFZhbHVlPn0gKi8gZ3JvdXBpbmcgPSBtYXAuZ2V0KGtleSk7XG4gICAgaWYgKCFtYXAuaGFzKGtleSkpIHtcbiAgICAgIGdyb3VwaW5nID0gW107XG4gICAgICBtYXAuc2V0KGtleSwgZ3JvdXBpbmcpO1xuICAgIH1cbiAgICBsZXQgLyoqIEB0eXBlIHtUVmFsdWV9ICovIGVsZW1lbnQgPSBhd2FpdCBlbGVtZW50U2VsZWN0b3IoaXRlbSk7IC8qKiBAdHlwZSB7IUFycmF5PFRWYWx1ZT59ICovKChcbiAgICBncm91cGluZykpLnB1c2goZWxlbWVudCk7XG4gIH1cblxuICByZXR1cm4gbWFwO1xufVxuIl19