goog.module('targets.es5.cls.asynciterable.from'); exports = {}; var module = {id: 'targets/es5/cls/asynciterable/from.js'};/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

var asynciterable_1 = goog.require('targets.es5.cls.asynciterable');
var tsickle_forward_declare_1 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.asynciterable");
var bindcallback_1 = goog.require('targets.es5.cls.internal.bindcallback');
var tsickle_forward_declare_2 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.internal.bindcallback");
var identity_1 = goog.require('targets.es5.cls.internal.identity');
var tsickle_forward_declare_3 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.internal.identity");
var tolength_1 = goog.require('targets.es5.cls.internal.tolength');
var tsickle_forward_declare_4 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.internal.tolength");
var isiterable_1 = goog.require('targets.es5.cls.internal.isiterable');
var tsickle_forward_declare_5 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.internal.isiterable");
var tsickle_forward_declare_6 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.observer");
goog.require("_Users.ptaylor.dev.ixjs.src.observer"); // force type-only module to be loaded
/**
 * @template TSource, TResult
 */
var FromArrayIterable = (function (_super) {
    __extends(FromArrayIterable, _super);
    /**
     * @param {!ArrayLike<TSource>} source
     * @param {function(TSource, number): (TResult|!Promise<TResult>)} selector
     */
    function FromArrayIterable(source, selector) {
        var _this = _super.call(this) || this;
        _this._source = source;
        _this._selector = selector;
        return _this;
    }
    /**
     * @return {!AsyncIterableIterator<TResult>}
     */
    FromArrayIterable.prototype[Symbol.asyncIterator] = function () {
        return __asyncGenerator(this, arguments, function _a() {
            var i, length;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        i = 0;
                        length = tolength_1.toLength(((this._source)).length);
                        _a.label = 1;
                    case 1:
                        if (!(i < length)) return [3 /*break*/, 4];
                        return [4 /*yield*/, __await(this._selector(this._source[i], i++))];
                    case 2: return [4 /*yield*/, _a.sent()];
                    case 3:
                        _a.sent();
                        return [3 /*break*/, 1];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    return FromArrayIterable;
}(asynciterable_1.AsyncIterableX));
function FromArrayIterable_tsickle_Closure_declarations() {
    /** @type {!ArrayLike<TSource>} */
    FromArrayIterable.prototype._source;
    /** @type {function(TSource, number): (TResult|!Promise<TResult>)} */
    FromArrayIterable.prototype._selector;
}
/**
 * @template TSource, TResult
 */
var FromAsyncIterable = (function (_super) {
    __extends(FromAsyncIterable, _super);
    /**
     * @param {(!Iterable<(TSource|!PromiseLike<TSource>)>|!AsyncIterable<TSource>)} source
     * @param {function(TSource, number): (TResult|!Promise<TResult>)} selector
     */
    function FromAsyncIterable(source, selector) {
        var _this = _super.call(this) || this;
        _this._source = source;
        _this._selector = selector;
        return _this;
    }
    /**
     * @return {!AsyncIterableIterator<TResult>}
     */
    FromAsyncIterable.prototype[Symbol.asyncIterator] = function () {
        return __asyncGenerator(this, arguments, function _a() {
            var i, _a, _b, item, e_1_1, e_1, _c;
            return __generator(this, function (_d) {
                switch (_d.label) {
                    case 0:
                        i = 0;
                        _d.label = 1;
                    case 1:
                        _d.trys.push([1, 9, 10, 15]);
                        _a = __asyncValues(/** @type {!AsyncIterable<TSource>} */ (this._source));
                        _d.label = 2;
                    case 2: return [4 /*yield*/, __await(_a.next())];
                    case 3:
                        if (!(_b = _d.sent(), !_b.done)) return [3 /*break*/, 8];
                        return [4 /*yield*/, __await(_b.value)];
                    case 4:
                        item = _d.sent();
                        return [4 /*yield*/, __await(this._selector(item, i++))];
                    case 5: return [4 /*yield*/, _d.sent()];
                    case 6:
                        _d.sent();
                        _d.label = 7;
                    case 7: return [3 /*break*/, 2];
                    case 8: return [3 /*break*/, 15];
                    case 9:
                        e_1_1 = _d.sent();
                        e_1 = { error: e_1_1 };
                        return [3 /*break*/, 15];
                    case 10:
                        _d.trys.push([10, , 13, 14]);
                        if (!(_b && !_b.done && (_c = _a.return))) return [3 /*break*/, 12];
                        return [4 /*yield*/, __await(_c.call(_a))];
                    case 11:
                        _d.sent();
                        _d.label = 12;
                    case 12: return [3 /*break*/, 14];
                    case 13:
                        if (e_1) throw e_1.error;
                        return [7 /*endfinally*/];
                    case 14: return [7 /*endfinally*/];
                    case 15: return [2 /*return*/];
                }
            });
        });
    };
    return FromAsyncIterable;
}(asynciterable_1.AsyncIterableX));
function FromAsyncIterable_tsickle_Closure_declarations() {
    /** @type {(!Iterable<(TSource|!PromiseLike<TSource>)>|!AsyncIterable<TSource>)} */
    FromAsyncIterable.prototype._source;
    /** @type {function(TSource, number): (TResult|!Promise<TResult>)} */
    FromAsyncIterable.prototype._selector;
}
/**
 * @template TSource, TResult
 */
var FromPromiseIterable = (function (_super) {
    __extends(FromPromiseIterable, _super);
    /**
     * @param {!PromiseLike<TSource>} source
     * @param {function(TSource, number): (TResult|!Promise<TResult>)} selector
     */
    function FromPromiseIterable(source, selector) {
        var _this = _super.call(this) || this;
        _this._source = source;
        _this._selector = selector;
        return _this;
    }
    /**
     * @return {!AsyncIterableIterator<TResult>}
     */
    FromPromiseIterable.prototype[Symbol.asyncIterator] = function () {
        return __asyncGenerator(this, arguments, function _a() {
            var item;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, __await(this._source)];
                    case 1:
                        item = _a.sent();
                        return [4 /*yield*/, __await(this._selector(item, 0))];
                    case 2: return [4 /*yield*/, _a.sent()];
                    case 3:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    return FromPromiseIterable;
}(asynciterable_1.AsyncIterableX));
function FromPromiseIterable_tsickle_Closure_declarations() {
    /** @type {!PromiseLike<TSource>} */
    FromPromiseIterable.prototype._source;
    /** @type {function(TSource, number): (TResult|!Promise<TResult>)} */
    FromPromiseIterable.prototype._selector;
}
/**
 * @template TSource
 */
var AsyncObserver = (function () {
    function AsyncObserver() {
        this.values = [];
        this.hasCompleted = false;
        this.hasError = false;
        this.errorValue = null;
        this.closed = false;
    }
    /**
     * @param {TSource} value
     * @return {void}
     */
    AsyncObserver.prototype.next = function (value) {
        if (!this.closed) {
            this.values.push(value);
        }
    };
    /**
     * @param {?} err
     * @return {void}
     */
    AsyncObserver.prototype.error = function (err) {
        if (!this.closed) {
            this.closed = true;
            this.hasError = true;
            this.errorValue = err;
        }
    };
    /**
     * @return {void}
     */
    AsyncObserver.prototype.complete = function () {
        if (!this.closed) {
            this.closed = true;
        }
    };
    return AsyncObserver;
}());
function AsyncObserver_tsickle_Closure_declarations() {
    /** @type {!Array<TSource>} */
    AsyncObserver.prototype.values;
    /** @type {boolean} */
    AsyncObserver.prototype.hasError;
    /** @type {boolean} */
    AsyncObserver.prototype.hasCompleted;
    /** @type {?} */
    AsyncObserver.prototype.errorValue;
    /** @type {boolean} */
    AsyncObserver.prototype.closed;
}
/**
 * @template TSource, TResult
 */
var FromObservableAsyncIterable = (function (_super) {
    __extends(FromObservableAsyncIterable, _super);
    /**
     * @param {!tsickle_forward_declare_6.Observable<TSource>} observable
     * @param {function(TSource, number): (TResult|!Promise<TResult>)} selector
     */
    function FromObservableAsyncIterable(observable, selector) {
        var _this = _super.call(this) || this;
        _this._observable = observable;
        _this._selector = selector;
        return _this;
    }
    /**
     * @return {!AsyncIterableIterator<TResult>}
     */
    FromObservableAsyncIterable.prototype[Symbol.asyncIterator] = function () {
        return __asyncGenerator(this, arguments, function _a() {
            var observer, subscription, i;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        observer = new AsyncObserver();
                        subscription = this._observable.subscribe(observer);
                        i = 0;
                        _a.label = 1;
                    case 1:
                        if (!1) return [3 /*break*/, 6];
                        if (!(observer.values.length > 0)) return [3 /*break*/, 4];
                        return [4 /*yield*/, __await(this._selector(observer.values.shift(), i++))];
                    case 2: return [4 /*yield*/, _a.sent()];
                    case 3:
                        _a.sent();
                        return [3 /*break*/, 5];
                    case 4:
                        if (observer.closed) {
                            subscription.unsubscribe();
                            if (observer.hasError) {
                                throw observer.errorValue;
                            }
                            else {
                                return [3 /*break*/, 6];
                            }
                        }
                        _a.label = 5;
                    case 5: return [3 /*break*/, 1];
                    case 6: return [2 /*return*/];
                }
            });
        });
    };
    return FromObservableAsyncIterable;
}(asynciterable_1.AsyncIterableX));
function FromObservableAsyncIterable_tsickle_Closure_declarations() {
    /** @type {!tsickle_forward_declare_6.Observable<TSource>} */
    FromObservableAsyncIterable.prototype._observable;
    /** @type {function(TSource, number): (TResult|!Promise<TResult>)} */
    FromObservableAsyncIterable.prototype._selector;
}
/** @typedef {(!PromiseLike<TSource>|!Iterable<(TSource|!PromiseLike<TSource>)>|!AsyncIterable<TSource>|!ArrayLike<TSource>|!tsickle_forward_declare_6.Observable<TSource>)} */
exports.AsyncIterableInput;
/**
 * @param {?} x
 * @return {boolean}
 */
function isPromise(x) {
    return x != null && Object(x) === x && typeof x['then'] === 'function';
}
/**
 * @param {?} x
 * @return {boolean}
 */
function isObservable(x) {
    return x != null && Object(x) === x && typeof x['subscribe'] === 'function';
}
/**
 * @param {?} x
 * @return {boolean}
 */
function isArrayLike(x) {
    return x != null && Object(x) === x && typeof x['length'] === 'number';
}
/**
 * @template TSource, TResult
 * @param {(!PromiseLike<TSource>|!Iterable<(TSource|!PromiseLike<TSource>)>|!AsyncIterable<TSource>|!ArrayLike<TSource>|!tsickle_forward_declare_6.Observable<TSource>)} source
 * @param {function(TSource, number): (TResult|!Promise<TResult>)=} selector
 * @param {?=} thisArg
 * @return {!tsickle_forward_declare_1.AsyncIterableX<TResult>}
 */
function from(source, selector, thisArg) {
    if (selector === void 0) { selector = identity_1.identityAsync; }
    var /** @type {?} */ fn = bindcallback_1.bindCallback(selector, thisArg, 2);
    if (isiterable_1.isIterable(source) || isiterable_1.isAsyncIterable(source)) {
        return new FromAsyncIterable(source, fn);
    }
    if (isPromise(source)) {
        return new FromPromiseIterable(source, fn);
    }
    if (isObservable(source)) {
        return new FromObservableAsyncIterable(source, fn);
    }
    if (isArrayLike(source)) {
        return new FromArrayIterable(source, fn);
    }
    throw new TypeError('Input type not supported');
}
exports.from = from;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hc3luY2l0ZXJhYmxlL2Zyb20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHOztBQUVILGtEQUx1QjtBQU12QixJQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsMkNBQTJDLENBQUMsQ0FOaEQ7QUFPbEQseURBTnFCO0FBT3JCLElBQU0seUJBQXlCLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxtREFBbUQsQ0FBQyxDQVBsRDtBQVF4RCxpREFQc0I7QUFRdEIsSUFBTSx5QkFBeUIsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLCtDQUErQyxDQUFDLENBUmpEO0FBU3JELGlEQVJpQjtBQVNqQixJQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsK0NBQStDLENBQUMsQ0FUdEQ7QUFVaEQscURBVG9DO0FBVXBDLElBQU0seUJBQXlCLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxpREFBaUQsQ0FBQyxDQVZuQztBQVlyRSxJQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsc0NBQXNDLENBQUMsQ0FBQztBQUM5RixJQUFJLENBQUMsT0FBTyxDQUFDLHNDQUFzQyxDQUFDLENBQUMsQ0FBQyxzQ0FBc0M7QUFDNUY7O0dBRUc7QUFiSDtJQUEyRCxxQ0FBd0I7SUFpQm5GOzs7T0FHRztJQWhCRCwyQkFrQkksTUFqQjBCLEVBa0IxQixRQWpCdUU7UUFGM0UsWUFvQkUsaUJBakJPLFNBb0JSO1FBRkMsS0FqQkksQ0FBQyxPQUFPLEdBQUUsTUFBTyxDQUFDO1FBa0J0QixLQWpCSSxDQUFDLFNBQVMsR0FBRSxRQUFTLENBQUM7O0lBa0I1QixDQUFDO0lBQ0g7O09BRUc7SUFsQk0sNEJBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxHQUE3Qjs7Ozs7O3dCQUNLLENBQUUsR0FBRSxDQUFFLENBQUM7d0JBQ0wsTUFBTyxHQUFFLG1CQUFTLENBQUMsQ0FBQSxDQUFxQixJQUFJLENBQUMsT0FBQSxDQUFPLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQzs7OzZCQUM1RCxDQUFBLENBQUMsR0FBRSxNQUFPLENBQUE7d0JBQ1YsNkJBQU0sSUFBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUUsRUFBRSxDQUFDLEdBQUE7NEJBbUJoRCxxQkFuQkssU0FBMkMsRUFBQTs7d0JBbUJoRCxTQW5CZ0QsQ0FBQzs7Ozs7O0tBRXBEO0lBQ0gsd0JBQUE7QUFBQSxDQW5CQSxBQW1CQSxDQW5CMkQsOEJBQWUsR0FtQjFFO0FBcUJBO0lBQ0Esa0NBQWtDO0lBQ2xDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUM7SUFDcEMscUVBQXFFO0lBQ3JFLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUM7QUFDdEMsQ0FBQztBQUVEOztHQUVHO0FBNUJIO0lBQTJELHFDQUF3QjtJQWdDbkY7OztPQUdHO0lBL0JELDJCQWlDSSxNQWhDeUUsRUFpQ3pFLFFBaEN1RTtRQUYzRSxZQW1DRSxpQkFoQ08sU0FtQ1I7UUFGQyxLQWhDSSxDQUFDLE9BQU8sR0FBRSxNQUFPLENBQUM7UUFpQ3RCLEtBaENJLENBQUMsU0FBUyxHQUFFLFFBQVMsQ0FBQzs7SUFpQzVCLENBQUM7SUFDSDs7T0FFRztJQWpDTSw0QkFBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEdBQTdCOzs7Ozs7d0JBQ0ssQ0FBRSxHQUFFLENBQUUsQ0FBQzs7Ozt3QkFDUyxLQUFBLGNBQUEsc0NBQUEsQ0FBQSxDQUE0QixJQUFJLENBQUMsT0FBQSxDQUFPLENBQUE7Ozs7Ozs7d0JBQTdDLElBQUssWUFBQTt3QkFDWiw2QkFBTSxJQUFLLENBQUMsU0FBUyxDQUFDLElBQUksRUFBQyxDQUFFLEVBQUUsQ0FBQyxHQUFBOzRCQWtDckMscUJBbENLLFNBQWdDLEVBQUE7O3dCQWtDckMsU0FsQ3FDLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztLQUV6QztJQUNILHdCQUFBO0FBQUEsQ0FsQkEsQUFrQkEsQ0FsQjJELDhCQUFlLEdBa0IxRTtBQW9DQTtJQUNBLG1GQUFtRjtJQUNuRixpQkFBaUIsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDO0lBQ3BDLHFFQUFxRTtJQUNyRSxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDO0FBQ3RDLENBQUM7QUFFRDs7R0FFRztBQTNDSDtJQUE2RCx1Q0FBd0I7SUErQ3JGOzs7T0FHRztJQTlDRCw2QkFnREksTUEvQzRCLEVBZ0Q1QixRQS9DdUU7UUFGM0UsWUFrREUsaUJBL0NPLFNBa0RSO1FBRkMsS0EvQ0ksQ0FBQyxPQUFPLEdBQUUsTUFBTyxDQUFDO1FBZ0R0QixLQS9DSSxDQUFDLFNBQVMsR0FBRSxRQUFTLENBQUM7O0lBZ0Q1QixDQUFDO0lBQ0g7O09BRUc7SUFoRE0sOEJBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxHQUE3Qjs7Ozs7NEJBQ2MsNkJBQU0sSUFBSyxDQUFDLE9BQU8sR0FBQTs7d0JBQTFCLElBQUssR0FBRSxTQUFtQjt3QkFDMUIsNkJBQU0sSUFBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUMsQ0FBRSxDQUFDLEdBQUE7NEJBaURuQyxxQkFqREssU0FBOEIsRUFBQTs7d0JBaURuQyxTQWpEbUMsQ0FBQzs7Ozs7S0FDckM7SUFDSCwwQkFBQTtBQUFBLENBaEJBLEFBZ0JBLENBaEI2RCw4QkFBZSxHQWdCNUU7QUFtREE7SUFDQSxvQ0FBb0M7SUFDcEMsbUJBQW1CLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQztJQUN0QyxxRUFBcUU7SUFDckUsbUJBQW1CLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQztBQUN4QyxDQUFDO0FBRUQ7O0dBRUc7QUExREg7SUFPRTtRQTJERSxJQTFESSxDQUFDLE1BQU0sR0FBRSxFQUFHLENBQUM7UUEyRGpCLElBMURJLENBQUMsWUFBWSxHQUFFLEtBQU0sQ0FBQztRQTJEMUIsSUExREksQ0FBQyxRQUFRLEdBQUUsS0FBTSxDQUFDO1FBMkR0QixJQTFESSxDQUFDLFVBQVUsR0FBRSxJQUFLLENBQUM7UUEyRHZCLElBMURJLENBQUMsTUFBTSxHQUFFLEtBQU0sQ0FBQztJQTJEdEIsQ0FBQztJQUNIOzs7T0FHRztJQTVERCw0QkFBSSxHQUFKLFVBQUssS0FBYztRQThEakIsRUFBRSxDQUFDLENBN0RDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBLENBQUU7WUE4RGpCLElBN0RJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQThEMUIsQ0E3REM7SUE4REgsQ0FBQztJQUNIOzs7T0FHRztJQS9ERCw2QkFBSyxHQUFMLFVBQU0sR0FBUTtRQWlFWixFQUFFLENBQUMsQ0FoRUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUEsQ0FBRTtZQWlFakIsSUFoRUksQ0FBQyxNQUFNLEdBQUUsSUFBSyxDQUFDO1lBaUVuQixJQWhFSSxDQUFDLFFBQVEsR0FBRSxJQUFLLENBQUM7WUFpRXJCLElBaEVJLENBQUMsVUFBVSxHQUFFLEdBQUksQ0FBQztRQWlFeEIsQ0FoRUM7SUFpRUgsQ0FBQztJQUNIOztPQUVHO0lBakVELGdDQUFRLEdBQVI7UUFtRUUsRUFBRSxDQUFDLENBbEVDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBLENBQUU7WUFtRWpCLElBbEVJLENBQUMsTUFBTSxHQUFFLElBQUssQ0FBQztRQW1FckIsQ0FsRUM7SUFtRUgsQ0FsRUM7SUFDSCxvQkFBQTtBQUFBLENBbENBLEFBa0NBLElBQUE7QUFvRUE7SUFDQSw4QkFBOEI7SUFDOUIsYUFBYSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7SUFDL0Isc0JBQXNCO0lBQ3RCLGFBQWEsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO0lBQ2pDLHNCQUFzQjtJQUN0QixhQUFhLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQztJQUNyQyxnQkFBZ0I7SUFDaEIsYUFBYSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUM7SUFDbkMsc0JBQXNCO0lBQ3RCLGFBQWEsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDO0FBQy9CLENBQUM7QUFFRDs7R0FFRztBQWpGSDtJQUFxRSwrQ0FBd0I7SUFxRjdGOzs7T0FHRztJQXBGRCxxQ0FzRkksVUFyRitCLEVBc0YvQixRQXJGdUU7UUFGM0UsWUF3RkUsaUJBckZPLFNBd0ZSO1FBRkMsS0FyRkksQ0FBQyxXQUFXLEdBQUUsVUFBVyxDQUFDO1FBc0Y5QixLQXJGSSxDQUFDLFNBQVMsR0FBRSxRQUFTLENBQUM7O0lBc0Y1QixDQUFDO0lBQ0g7O09BRUc7SUF0Rk0sc0NBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxHQUE3Qjs7Ozs7O3dCQUNPLFFBQVMsR0FBRSxJQUFJLGFBQWMsRUFBVyxDQUFDO3dCQUN6QyxZQUFhLEdBQUUsSUFBSyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7d0JBRXZELENBQUUsR0FBRSxDQUFFLENBQUM7Ozs2QkFDSCxDQUFDOzZCQUNGLENBQUEsUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUUsQ0FBRSxDQUFBLEVBQTFCLHdCQUEwQjt3QkFDdkIsNkJBQU0sSUFBSyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxFQUFDLENBQUUsRUFBRSxDQUFDLEdBQUE7NEJBdUZ4RCxxQkF2RkssU0FBbUQsRUFBQTs7d0JBdUZ4RCxTQXZGd0QsQ0FBQzs7O3dCQUNyRCxFQUFBLENBQUEsQ0FBSyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUEsQ0FBRTs0QkF3RjNCLFlBdkZZLENBQUMsV0FBVyxFQUFFLENBQUM7NEJBd0YzQixFQUFFLENBQUMsQ0F2RkMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFBLENBQUU7Z0NBd0Z0QixNQXZGSyxRQUFTLENBQUMsVUFBVSxDQUFDOzRCQXdGNUIsQ0F2RkM7NEJBQUEsSUFBSyxDQUFBLENBQUU7Z0NBd0ZOLE1BdkZNLGtCQUFBOzRCQXdGUixDQXZGQzt3QkF3RkgsQ0F2RkM7Ozs7Ozs7S0FFSjtJQUNILGtDQUFBO0FBQUEsQ0E5QkEsQUE4QkEsQ0E5QnFFLDhCQUFlLEdBOEJwRjtBQXlGQTtJQUNBLDZEQUE2RDtJQUM3RCwyQkFBMkIsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDO0lBQ2xELHFFQUFxRTtJQUNyRSwyQkFBMkIsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDO0FBQ2hELENBQUM7QUFTRCwrS0FBK0s7QUFDL0ssT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBRTNCOzs7R0FHRztBQXBHSCxtQkFBbUIsQ0FBTTtJQXNHdkIsTUFyR00sQ0FBQSxDQUFFLElBQUcsSUFBSyxJQUFHLE1BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSSxDQUFFLElBQUcsT0FBTyxDQUFFLENBQUMsTUFBTSxDQUFDLEtBQUksVUFBVyxDQUFDO0FBc0d6RSxDQUFDO0FBQ0Q7OztHQUdHO0FBdkdILHNCQUFzQixDQUFNO0lBeUcxQixNQXhHTSxDQUFBLENBQUUsSUFBRyxJQUFLLElBQUcsTUFBTyxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUUsSUFBRyxPQUFPLENBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSSxVQUFXLENBQUM7QUF5RzlFLENBQUM7QUFDRDs7O0dBR0c7QUExR0gscUJBQXFCLENBQU07SUE0R3pCLE1BM0dNLENBQUEsQ0FBRSxJQUFHLElBQUssSUFBRyxNQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBRSxJQUFHLE9BQU8sQ0FBRSxDQUFDLFFBQVEsQ0FBQyxLQUFJLFFBQVMsQ0FBQztBQTRHekUsQ0FBQztBQUNEOzs7Ozs7R0FNRztBQWhISCxjQWtISSxNQWpIbUMsRUFrSG5DLFFBakh1RixFQWtIdkYsT0FqSGE7SUFnSGIseUJBQUEsRUFBQSxXQWpIeUUsd0JBQWM7SUFtSHpGLElBQU0sZ0JBakhELENBQUEsRUFBRyxHQUFFLDJCQUFhLENBQUMsUUFBUSxFQUFDLE9BQVEsRUFBQyxDQUFFLENBQUMsQ0FBQztJQWtIOUMsRUFBRSxDQUFDLENBakhDLHVCQUFVLENBQUMsTUFBTSxDQUFDLElBQUcsNEJBQWdCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQSxDQUFFO1FBa0hsRCxNQWpITSxDQUFBLElBQUksaUJBQWtCLENBQW1CLE1BQU0sRUFBQyxFQUFHLENBQUMsQ0FBQztJQWtIN0QsQ0FqSEM7SUFrSEQsRUFBRSxDQUFDLENBakhDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFBLENBQUU7UUFrSHRCLE1BakhNLENBQUEsSUFBSSxtQkFBb0IsQ0FBbUIsTUFBTSxFQUFDLEVBQUcsQ0FBQyxDQUFDO0lBa0gvRCxDQWpIQztJQWtIRCxFQUFFLENBQUMsQ0FqSEMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUEsQ0FBRTtRQWtIekIsTUFqSE0sQ0FBQSxJQUFJLDJCQUE0QixDQUFtQixNQUFNLEVBQUMsRUFBRyxDQUFDLENBQUM7SUFrSHZFLENBakhDO0lBa0hELEVBQUUsQ0FBQyxDQWpIQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQSxDQUFFO1FBa0h4QixNQWpITSxDQUFBLElBQUksaUJBQWtCLENBQW1CLE1BQU0sRUFBQyxFQUFHLENBQUMsQ0FBQztJQWtIN0QsQ0FqSEM7SUFtSEQsTUFqSEssSUFBSSxTQUFVLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQWtIbEQsQ0FqSEM7QUFuQkQsb0JBbUJDIiwiZmlsZSI6ImZyb20uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IGFkZGVkIGJ5IHRzaWNrbGVcbiAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlc30gY2hlY2tlZCBieSB0c2NcbiAqL1xuXG5pbXBvcnQgeyBBc3luY0l0ZXJhYmxlWCB9IGZyb20gJy4uL2FzeW5jaXRlcmFibGUnO1xuY29uc3QgdHNpY2tsZV9mb3J3YXJkX2RlY2xhcmVfMSA9IGdvb2cuZm9yd2FyZERlY2xhcmUoXCJfVXNlcnMucHRheWxvci5kZXYuaXhqcy5zcmMuYXN5bmNpdGVyYWJsZVwiKTtcbmltcG9ydCB7IGJpbmRDYWxsYmFjayB9IGZyb20gJy4uL2ludGVybmFsL2JpbmRjYWxsYmFjayc7XG5jb25zdCB0c2lja2xlX2ZvcndhcmRfZGVjbGFyZV8yID0gZ29vZy5mb3J3YXJkRGVjbGFyZShcIl9Vc2Vycy5wdGF5bG9yLmRldi5peGpzLnNyYy5pbnRlcm5hbC5iaW5kY2FsbGJhY2tcIik7XG5pbXBvcnQgeyBpZGVudGl0eUFzeW5jIH0gZnJvbSAnLi4vaW50ZXJuYWwvaWRlbnRpdHknO1xuY29uc3QgdHNpY2tsZV9mb3J3YXJkX2RlY2xhcmVfMyA9IGdvb2cuZm9yd2FyZERlY2xhcmUoXCJfVXNlcnMucHRheWxvci5kZXYuaXhqcy5zcmMuaW50ZXJuYWwuaWRlbnRpdHlcIik7XG5pbXBvcnQgeyB0b0xlbmd0aCB9IGZyb20gJy4uL2ludGVybmFsL3RvbGVuZ3RoJztcbmNvbnN0IHRzaWNrbGVfZm9yd2FyZF9kZWNsYXJlXzQgPSBnb29nLmZvcndhcmREZWNsYXJlKFwiX1VzZXJzLnB0YXlsb3IuZGV2Lml4anMuc3JjLmludGVybmFsLnRvbGVuZ3RoXCIpO1xuaW1wb3J0IHsgaXNJdGVyYWJsZSwgaXNBc3luY0l0ZXJhYmxlIH0gZnJvbSAnLi4vaW50ZXJuYWwvaXNpdGVyYWJsZSc7XG5jb25zdCB0c2lja2xlX2ZvcndhcmRfZGVjbGFyZV81ID0gZ29vZy5mb3J3YXJkRGVjbGFyZShcIl9Vc2Vycy5wdGF5bG9yLmRldi5peGpzLnNyYy5pbnRlcm5hbC5pc2l0ZXJhYmxlXCIpO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJy4uL29ic2VydmVyJztcbmNvbnN0IHRzaWNrbGVfZm9yd2FyZF9kZWNsYXJlXzYgPSBnb29nLmZvcndhcmREZWNsYXJlKFwiX1VzZXJzLnB0YXlsb3IuZGV2Lml4anMuc3JjLm9ic2VydmVyXCIpO1xuZ29vZy5yZXF1aXJlKFwiX1VzZXJzLnB0YXlsb3IuZGV2Lml4anMuc3JjLm9ic2VydmVyXCIpOyAvLyBmb3JjZSB0eXBlLW9ubHkgbW9kdWxlIHRvIGJlIGxvYWRlZFxuLyoqXG4gKiBAdGVtcGxhdGUgVFNvdXJjZSwgVFJlc3VsdFxuICovXG5jbGFzcyBGcm9tQXJyYXlJdGVyYWJsZTxUU291cmNlLCBUUmVzdWx0ID0gVFNvdXJjZT4gZXh0ZW5kcyBBc3luY0l0ZXJhYmxlWDxUUmVzdWx0PiB7XG5wcml2YXRlIF9zb3VyY2U6IEFycmF5TGlrZTxUU291cmNlPjtcbnByaXZhdGUgX3NlbGVjdG9yOiAodmFsdWU6IFRTb3VyY2UsIGluZGV4OiBudW1iZXIpID0+IFRSZXN1bHQgfCBQcm9taXNlPFRSZXN1bHQ+O1xuLyoqXG4gKiBAcGFyYW0geyFBcnJheUxpa2U8VFNvdXJjZT59IHNvdXJjZVxuICogQHBhcmFtIHtmdW5jdGlvbihUU291cmNlLCBudW1iZXIpOiAoVFJlc3VsdHwhUHJvbWlzZTxUUmVzdWx0Pil9IHNlbGVjdG9yXG4gKi9cbmNvbnN0cnVjdG9yKFxuICAgICAgc291cmNlOiBBcnJheUxpa2U8VFNvdXJjZT4sXG4gICAgICBzZWxlY3RvcjogKHZhbHVlOiBUU291cmNlLCBpbmRleDogbnVtYmVyKSA9PiBUUmVzdWx0IHwgUHJvbWlzZTxUUmVzdWx0Pikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fc291cmNlID0gc291cmNlO1xuICAgIHRoaXMuX3NlbGVjdG9yID0gc2VsZWN0b3I7XG4gIH1cbi8qKlxuICogQHJldHVybiB7IUFzeW5jSXRlcmFibGVJdGVyYXRvcjxUUmVzdWx0Pn1cbiAqL1xuYXN5bmMgKltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgbGV0IC8qKiBAdHlwZSB7bnVtYmVyfSAqLyBpID0gMDtcbiAgICBjb25zdCAvKiogQHR5cGUge251bWJlcn0gKi8gbGVuZ3RoID0gdG9MZW5ndGgoKCAvKiogQHR5cGUgeyFBcnJheUxpa2U8VFNvdXJjZT59ICovKCg8QXJyYXlMaWtlPFRTb3VyY2U+PnRoaXMuX3NvdXJjZSkpKS5sZW5ndGgpO1xuICAgIHdoaWxlIChpIDwgbGVuZ3RoKSB7XG4gICAgICB5aWVsZCBhd2FpdCB0aGlzLl9zZWxlY3Rvcih0aGlzLl9zb3VyY2VbaV0sIGkrKyk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIEZyb21BcnJheUl0ZXJhYmxlX3RzaWNrbGVfQ2xvc3VyZV9kZWNsYXJhdGlvbnMoKSB7XG4vKiogQHR5cGUgeyFBcnJheUxpa2U8VFNvdXJjZT59ICovXG5Gcm9tQXJyYXlJdGVyYWJsZS5wcm90b3R5cGUuX3NvdXJjZTtcbi8qKiBAdHlwZSB7ZnVuY3Rpb24oVFNvdXJjZSwgbnVtYmVyKTogKFRSZXN1bHR8IVByb21pc2U8VFJlc3VsdD4pfSAqL1xuRnJvbUFycmF5SXRlcmFibGUucHJvdG90eXBlLl9zZWxlY3Rvcjtcbn1cblxuLyoqXG4gKiBAdGVtcGxhdGUgVFNvdXJjZSwgVFJlc3VsdFxuICovXG5jbGFzcyBGcm9tQXN5bmNJdGVyYWJsZTxUU291cmNlLCBUUmVzdWx0ID0gVFNvdXJjZT4gZXh0ZW5kcyBBc3luY0l0ZXJhYmxlWDxUUmVzdWx0PiB7XG5wcml2YXRlIF9zb3VyY2U6IEl0ZXJhYmxlPFRTb3VyY2UgfCBQcm9taXNlTGlrZTxUU291cmNlPj4gfCBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+O1xucHJpdmF0ZSBfc2VsZWN0b3I6ICh2YWx1ZTogVFNvdXJjZSwgaW5kZXg6IG51bWJlcikgPT4gVFJlc3VsdCB8IFByb21pc2U8VFJlc3VsdD47XG4vKipcbiAqIEBwYXJhbSB7KCFJdGVyYWJsZTwoVFNvdXJjZXwhUHJvbWlzZUxpa2U8VFNvdXJjZT4pPnwhQXN5bmNJdGVyYWJsZTxUU291cmNlPil9IHNvdXJjZVxuICogQHBhcmFtIHtmdW5jdGlvbihUU291cmNlLCBudW1iZXIpOiAoVFJlc3VsdHwhUHJvbWlzZTxUUmVzdWx0Pil9IHNlbGVjdG9yXG4gKi9cbmNvbnN0cnVjdG9yKFxuICAgICAgc291cmNlOiBJdGVyYWJsZTxUU291cmNlIHwgUHJvbWlzZUxpa2U8VFNvdXJjZT4+IHwgQXN5bmNJdGVyYWJsZTxUU291cmNlPixcbiAgICAgIHNlbGVjdG9yOiAodmFsdWU6IFRTb3VyY2UsIGluZGV4OiBudW1iZXIpID0+IFRSZXN1bHQgfCBQcm9taXNlPFRSZXN1bHQ+KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9zb3VyY2UgPSBzb3VyY2U7XG4gICAgdGhpcy5fc2VsZWN0b3IgPSBzZWxlY3RvcjtcbiAgfVxuLyoqXG4gKiBAcmV0dXJuIHshQXN5bmNJdGVyYWJsZUl0ZXJhdG9yPFRSZXN1bHQ+fVxuICovXG5hc3luYyAqW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICBsZXQgLyoqIEB0eXBlIHtudW1iZXJ9ICovIGkgPSAwO1xuICAgIGZvciBhd2FpdCAobGV0IC8qKiBAdHlwZSB7VFNvdXJjZX0gKi8gaXRlbSBvZiAvKiogQHR5cGUgeyFBc3luY0l0ZXJhYmxlPFRTb3VyY2U+fSAqLygoIDxBc3luY0l0ZXJhYmxlPFRTb3VyY2U+PnRoaXMuX3NvdXJjZSkpKSB7XG4gICAgICB5aWVsZCBhd2FpdCB0aGlzLl9zZWxlY3RvcihpdGVtLCBpKyspO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBGcm9tQXN5bmNJdGVyYWJsZV90c2lja2xlX0Nsb3N1cmVfZGVjbGFyYXRpb25zKCkge1xuLyoqIEB0eXBlIHsoIUl0ZXJhYmxlPChUU291cmNlfCFQcm9taXNlTGlrZTxUU291cmNlPik+fCFBc3luY0l0ZXJhYmxlPFRTb3VyY2U+KX0gKi9cbkZyb21Bc3luY0l0ZXJhYmxlLnByb3RvdHlwZS5fc291cmNlO1xuLyoqIEB0eXBlIHtmdW5jdGlvbihUU291cmNlLCBudW1iZXIpOiAoVFJlc3VsdHwhUHJvbWlzZTxUUmVzdWx0Pil9ICovXG5Gcm9tQXN5bmNJdGVyYWJsZS5wcm90b3R5cGUuX3NlbGVjdG9yO1xufVxuXG4vKipcbiAqIEB0ZW1wbGF0ZSBUU291cmNlLCBUUmVzdWx0XG4gKi9cbmNsYXNzIEZyb21Qcm9taXNlSXRlcmFibGU8VFNvdXJjZSwgVFJlc3VsdCA9IFRTb3VyY2U+IGV4dGVuZHMgQXN5bmNJdGVyYWJsZVg8VFJlc3VsdD4ge1xucHJpdmF0ZSBfc291cmNlOiBQcm9taXNlTGlrZTxUU291cmNlPjtcbnByaXZhdGUgX3NlbGVjdG9yOiAodmFsdWU6IFRTb3VyY2UsIGluZGV4OiBudW1iZXIpID0+IFRSZXN1bHQgfCBQcm9taXNlPFRSZXN1bHQ+O1xuLyoqXG4gKiBAcGFyYW0geyFQcm9taXNlTGlrZTxUU291cmNlPn0gc291cmNlXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFRTb3VyY2UsIG51bWJlcik6IChUUmVzdWx0fCFQcm9taXNlPFRSZXN1bHQ+KX0gc2VsZWN0b3JcbiAqL1xuY29uc3RydWN0b3IoXG4gICAgICBzb3VyY2U6IFByb21pc2VMaWtlPFRTb3VyY2U+LFxuICAgICAgc2VsZWN0b3I6ICh2YWx1ZTogVFNvdXJjZSwgaW5kZXg6IG51bWJlcikgPT4gVFJlc3VsdCB8IFByb21pc2U8VFJlc3VsdD4pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3NvdXJjZSA9IHNvdXJjZTtcbiAgICB0aGlzLl9zZWxlY3RvciA9IHNlbGVjdG9yO1xuICB9XG4vKipcbiAqIEByZXR1cm4geyFBc3luY0l0ZXJhYmxlSXRlcmF0b3I8VFJlc3VsdD59XG4gKi9cbmFzeW5jICpbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgIGNvbnN0IC8qKiBAdHlwZSB7VFNvdXJjZX0gKi8gaXRlbSA9IGF3YWl0IHRoaXMuX3NvdXJjZTtcbiAgICB5aWVsZCBhd2FpdCB0aGlzLl9zZWxlY3RvcihpdGVtLCAwKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBGcm9tUHJvbWlzZUl0ZXJhYmxlX3RzaWNrbGVfQ2xvc3VyZV9kZWNsYXJhdGlvbnMoKSB7XG4vKiogQHR5cGUgeyFQcm9taXNlTGlrZTxUU291cmNlPn0gKi9cbkZyb21Qcm9taXNlSXRlcmFibGUucHJvdG90eXBlLl9zb3VyY2U7XG4vKiogQHR5cGUge2Z1bmN0aW9uKFRTb3VyY2UsIG51bWJlcik6IChUUmVzdWx0fCFQcm9taXNlPFRSZXN1bHQ+KX0gKi9cbkZyb21Qcm9taXNlSXRlcmFibGUucHJvdG90eXBlLl9zZWxlY3Rvcjtcbn1cblxuLyoqXG4gKiBAdGVtcGxhdGUgVFNvdXJjZVxuICovXG5jbGFzcyBBc3luY09ic2VydmVyPFRTb3VyY2U+IHtcbnB1YmxpYyB2YWx1ZXM6IFRTb3VyY2VbXTtcbnB1YmxpYyBoYXNFcnJvcjogYm9vbGVhbjtcbnB1YmxpYyBoYXNDb21wbGV0ZWQ6IGJvb2xlYW47XG5wdWJsaWMgZXJyb3JWYWx1ZTogYW55O1xucHVibGljIGNsb3NlZDogYm9vbGVhbjtcbmNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMudmFsdWVzID0gW107XG4gICAgdGhpcy5oYXNDb21wbGV0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmhhc0Vycm9yID0gZmFsc2U7XG4gICAgdGhpcy5lcnJvclZhbHVlID0gbnVsbDtcbiAgICB0aGlzLmNsb3NlZCA9IGZhbHNlO1xuICB9XG4vKipcbiAqIEBwYXJhbSB7VFNvdXJjZX0gdmFsdWVcbiAqIEByZXR1cm4ge3ZvaWR9XG4gKi9cbm5leHQodmFsdWU6IFRTb3VyY2UpIHtcbiAgICBpZiAoIXRoaXMuY2xvc2VkKSB7XG4gICAgICB0aGlzLnZhbHVlcy5wdXNoKHZhbHVlKTtcbiAgICB9XG4gIH1cbi8qKlxuICogQHBhcmFtIHs/fSBlcnJcbiAqIEByZXR1cm4ge3ZvaWR9XG4gKi9cbmVycm9yKGVycjogYW55KSB7XG4gICAgaWYgKCF0aGlzLmNsb3NlZCkge1xuICAgICAgdGhpcy5jbG9zZWQgPSB0cnVlO1xuICAgICAgdGhpcy5oYXNFcnJvciA9IHRydWU7XG4gICAgICB0aGlzLmVycm9yVmFsdWUgPSBlcnI7XG4gICAgfVxuICB9XG4vKipcbiAqIEByZXR1cm4ge3ZvaWR9XG4gKi9cbmNvbXBsZXRlKCkge1xuICAgIGlmICghdGhpcy5jbG9zZWQpIHtcbiAgICAgIHRoaXMuY2xvc2VkID0gdHJ1ZTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gQXN5bmNPYnNlcnZlcl90c2lja2xlX0Nsb3N1cmVfZGVjbGFyYXRpb25zKCkge1xuLyoqIEB0eXBlIHshQXJyYXk8VFNvdXJjZT59ICovXG5Bc3luY09ic2VydmVyLnByb3RvdHlwZS52YWx1ZXM7XG4vKiogQHR5cGUge2Jvb2xlYW59ICovXG5Bc3luY09ic2VydmVyLnByb3RvdHlwZS5oYXNFcnJvcjtcbi8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cbkFzeW5jT2JzZXJ2ZXIucHJvdG90eXBlLmhhc0NvbXBsZXRlZDtcbi8qKiBAdHlwZSB7P30gKi9cbkFzeW5jT2JzZXJ2ZXIucHJvdG90eXBlLmVycm9yVmFsdWU7XG4vKiogQHR5cGUge2Jvb2xlYW59ICovXG5Bc3luY09ic2VydmVyLnByb3RvdHlwZS5jbG9zZWQ7XG59XG5cbi8qKlxuICogQHRlbXBsYXRlIFRTb3VyY2UsIFRSZXN1bHRcbiAqL1xuY2xhc3MgRnJvbU9ic2VydmFibGVBc3luY0l0ZXJhYmxlPFRTb3VyY2UsIFRSZXN1bHQgPSBUU291cmNlPiBleHRlbmRzIEFzeW5jSXRlcmFibGVYPFRSZXN1bHQ+IHtcbnByaXZhdGUgX29ic2VydmFibGU6IE9ic2VydmFibGU8VFNvdXJjZT47XG5wcml2YXRlIF9zZWxlY3RvcjogKHZhbHVlOiBUU291cmNlLCBpbmRleDogbnVtYmVyKSA9PiBUUmVzdWx0IHwgUHJvbWlzZTxUUmVzdWx0Pjtcbi8qKlxuICogQHBhcmFtIHshdHNpY2tsZV9mb3J3YXJkX2RlY2xhcmVfNi5PYnNlcnZhYmxlPFRTb3VyY2U+fSBvYnNlcnZhYmxlXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFRTb3VyY2UsIG51bWJlcik6IChUUmVzdWx0fCFQcm9taXNlPFRSZXN1bHQ+KX0gc2VsZWN0b3JcbiAqL1xuY29uc3RydWN0b3IoXG4gICAgICBvYnNlcnZhYmxlOiBPYnNlcnZhYmxlPFRTb3VyY2U+LFxuICAgICAgc2VsZWN0b3I6ICh2YWx1ZTogVFNvdXJjZSwgaW5kZXg6IG51bWJlcikgPT4gVFJlc3VsdCB8IFByb21pc2U8VFJlc3VsdD4pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX29ic2VydmFibGUgPSBvYnNlcnZhYmxlO1xuICAgIHRoaXMuX3NlbGVjdG9yID0gc2VsZWN0b3I7XG4gIH1cbi8qKlxuICogQHJldHVybiB7IUFzeW5jSXRlcmFibGVJdGVyYXRvcjxUUmVzdWx0Pn1cbiAqL1xuYXN5bmMgKltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgY29uc3QgLyoqIEB0eXBlIHshQXN5bmNPYnNlcnZlcjxUU291cmNlPn0gKi8gb2JzZXJ2ZXIgPSBuZXcgQXN5bmNPYnNlcnZlcjxUU291cmNlPigpO1xuICAgIGNvbnN0IC8qKiBAdHlwZSB7IVN1YnNjcmlwdGlvbn0gKi8gc3Vic2NyaXB0aW9uID0gdGhpcy5fb2JzZXJ2YWJsZS5zdWJzY3JpYmUob2JzZXJ2ZXIpO1xuXG4gICAgbGV0IC8qKiBAdHlwZSB7bnVtYmVyfSAqLyBpID0gMDtcbiAgICB3aGlsZSAoMSkge1xuICAgICAgaWYgKG9ic2VydmVyLnZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHlpZWxkIGF3YWl0IHRoaXMuX3NlbGVjdG9yKG9ic2VydmVyLnZhbHVlcy5zaGlmdCgpLCBpKyspO1xuICAgICAgfSBlbHNlIGlmIChvYnNlcnZlci5jbG9zZWQpIHtcbiAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIGlmIChvYnNlcnZlci5oYXNFcnJvcikge1xuICAgICAgICAgIHRocm93IG9ic2VydmVyLmVycm9yVmFsdWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gRnJvbU9ic2VydmFibGVBc3luY0l0ZXJhYmxlX3RzaWNrbGVfQ2xvc3VyZV9kZWNsYXJhdGlvbnMoKSB7XG4vKiogQHR5cGUgeyF0c2lja2xlX2ZvcndhcmRfZGVjbGFyZV82Lk9ic2VydmFibGU8VFNvdXJjZT59ICovXG5Gcm9tT2JzZXJ2YWJsZUFzeW5jSXRlcmFibGUucHJvdG90eXBlLl9vYnNlcnZhYmxlO1xuLyoqIEB0eXBlIHtmdW5jdGlvbihUU291cmNlLCBudW1iZXIpOiAoVFJlc3VsdHwhUHJvbWlzZTxUUmVzdWx0Pil9ICovXG5Gcm9tT2JzZXJ2YWJsZUFzeW5jSXRlcmFibGUucHJvdG90eXBlLl9zZWxlY3Rvcjtcbn1cblxuXG5leHBvcnQgdHlwZSBBc3luY0l0ZXJhYmxlSW5wdXQ8VFNvdXJjZT4gPVxuICBJdGVyYWJsZTxUU291cmNlIHwgUHJvbWlzZUxpa2U8VFNvdXJjZT4+IHxcbiAgQXN5bmNJdGVyYWJsZTxUU291cmNlPiB8XG4gIEFycmF5TGlrZTxUU291cmNlPiB8XG4gIFByb21pc2VMaWtlPFRTb3VyY2U+IHxcbiAgT2JzZXJ2YWJsZTxUU291cmNlPjtcbi8qKiBAdHlwZWRlZiB7KCFQcm9taXNlTGlrZTxUU291cmNlPnwhSXRlcmFibGU8KFRTb3VyY2V8IVByb21pc2VMaWtlPFRTb3VyY2U+KT58IUFzeW5jSXRlcmFibGU8VFNvdXJjZT58IUFycmF5TGlrZTxUU291cmNlPnwhdHNpY2tsZV9mb3J3YXJkX2RlY2xhcmVfNi5PYnNlcnZhYmxlPFRTb3VyY2U+KX0gKi9cbmV4cG9ydHMuQXN5bmNJdGVyYWJsZUlucHV0O1xuXG4vKipcbiAqIEBwYXJhbSB7P30geFxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gaXNQcm9taXNlKHg6IGFueSk6IHggaXMgUHJvbWlzZUxpa2U8YW55PiB7XG4gIHJldHVybiB4ICE9IG51bGwgJiYgT2JqZWN0KHgpID09PSB4ICYmIHR5cGVvZiB4Wyd0aGVuJ10gPT09ICdmdW5jdGlvbic7XG59XG4vKipcbiAqIEBwYXJhbSB7P30geFxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gaXNPYnNlcnZhYmxlKHg6IGFueSk6IHggaXMgT2JzZXJ2YWJsZTxhbnk+IHtcbiAgcmV0dXJuIHggIT0gbnVsbCAmJiBPYmplY3QoeCkgPT09IHggJiYgdHlwZW9mIHhbJ3N1YnNjcmliZSddID09PSAnZnVuY3Rpb24nO1xufVxuLyoqXG4gKiBAcGFyYW0gez99IHhcbiAqIEByZXR1cm4ge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGlzQXJyYXlMaWtlKHg6IGFueSk6IHggaXMgQXJyYXlMaWtlPGFueT4ge1xuICByZXR1cm4geCAhPSBudWxsICYmIE9iamVjdCh4KSA9PT0geCAmJiB0eXBlb2YgeFsnbGVuZ3RoJ10gPT09ICdudW1iZXInO1xufVxuLyoqXG4gKiBAdGVtcGxhdGUgVFNvdXJjZSwgVFJlc3VsdFxuICogQHBhcmFtIHsoIVByb21pc2VMaWtlPFRTb3VyY2U+fCFJdGVyYWJsZTwoVFNvdXJjZXwhUHJvbWlzZUxpa2U8VFNvdXJjZT4pPnwhQXN5bmNJdGVyYWJsZTxUU291cmNlPnwhQXJyYXlMaWtlPFRTb3VyY2U+fCF0c2lja2xlX2ZvcndhcmRfZGVjbGFyZV82Lk9ic2VydmFibGU8VFNvdXJjZT4pfSBzb3VyY2VcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oVFNvdXJjZSwgbnVtYmVyKTogKFRSZXN1bHR8IVByb21pc2U8VFJlc3VsdD4pPX0gc2VsZWN0b3JcbiAqIEBwYXJhbSB7Pz19IHRoaXNBcmdcbiAqIEByZXR1cm4geyF0c2lja2xlX2ZvcndhcmRfZGVjbGFyZV8xLkFzeW5jSXRlcmFibGVYPFRSZXN1bHQ+fVxuICovXG5leHBvcnQgZnVuY3Rpb24gZnJvbTxUU291cmNlLCBUUmVzdWx0ID0gVFNvdXJjZT4oXG4gICAgc291cmNlOiBBc3luY0l0ZXJhYmxlSW5wdXQ8VFNvdXJjZT4sXG4gICAgc2VsZWN0b3I6ICh2YWx1ZTogVFNvdXJjZSwgaW5kZXg6IG51bWJlcikgPT4gVFJlc3VsdCB8IFByb21pc2U8VFJlc3VsdD4gPSBpZGVudGl0eUFzeW5jLFxuICAgIHRoaXNBcmc/OiBhbnkpOiBBc3luY0l0ZXJhYmxlWDxUUmVzdWx0PiB7XG4gIGNvbnN0IC8qKiBAdHlwZSB7P30gKi8gZm4gPSBiaW5kQ2FsbGJhY2soc2VsZWN0b3IsIHRoaXNBcmcsIDIpO1xuICBpZiAoaXNJdGVyYWJsZShzb3VyY2UpIHx8IGlzQXN5bmNJdGVyYWJsZShzb3VyY2UpKSB7XG4gICAgcmV0dXJuIG5ldyBGcm9tQXN5bmNJdGVyYWJsZTxUU291cmNlLCBUUmVzdWx0Pihzb3VyY2UsIGZuKTtcbiAgfVxuICBpZiAoaXNQcm9taXNlKHNvdXJjZSkpIHtcbiAgICByZXR1cm4gbmV3IEZyb21Qcm9taXNlSXRlcmFibGU8VFNvdXJjZSwgVFJlc3VsdD4oc291cmNlLCBmbik7XG4gIH1cbiAgaWYgKGlzT2JzZXJ2YWJsZShzb3VyY2UpKSB7XG4gICAgcmV0dXJuIG5ldyBGcm9tT2JzZXJ2YWJsZUFzeW5jSXRlcmFibGU8VFNvdXJjZSwgVFJlc3VsdD4oc291cmNlLCBmbik7XG4gIH1cbiAgaWYgKGlzQXJyYXlMaWtlKHNvdXJjZSkpIHtcbiAgICByZXR1cm4gbmV3IEZyb21BcnJheUl0ZXJhYmxlPFRTb3VyY2UsIFRSZXN1bHQ+KHNvdXJjZSwgZm4pO1xuICB9XG5cbiAgdGhyb3cgbmV3IFR5cGVFcnJvcignSW5wdXQgdHlwZSBub3Qgc3VwcG9ydGVkJyk7XG59XG4iXX0=