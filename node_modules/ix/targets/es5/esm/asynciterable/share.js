import * as tslib_1 from "tslib";
import { AsyncIterableX } from '../asynciterable';
import { create } from './create';
var SharedAsyncIterable = (function (_super) {
    tslib_1.__extends(SharedAsyncIterable, _super);
    function SharedAsyncIterable(it) {
        var _this = _super.call(this) || this;
        _this._it = it;
        return _this;
    }
    SharedAsyncIterable.prototype[Symbol.asyncIterator] = function () {
        return this._it;
    };
    return SharedAsyncIterable;
}(AsyncIterableX));
export function share(source, selector) {
    var _this = this;
    return selector ?
        create(function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {
            var it;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, selector(new SharedAsyncIterable(source[Symbol.asyncIterator]()))];
                    case 1:
                        it = _a.sent();
                        return [2 /*return*/, it[Symbol.asyncIterator]()];
                }
            });
        }); }) :
        new SharedAsyncIterable(source[Symbol.asyncIterator]());
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvc2hhcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRWxDO0lBQXFDLCtDQUFpQjtJQUdwRCw2QkFBWSxFQUFvQjtRQUFoQyxZQUNFLGlCQUFPLFNBRVI7UUFEQyxLQUFJLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQzs7SUFDaEIsQ0FBQztJQUVELDhCQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsR0FBdEI7UUFDRSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNsQixDQUFDO0lBQ0gsMEJBQUM7QUFBRCxDQVhBLEFBV0MsQ0FYb0MsY0FBYyxHQVdsRDtBQVFELE1BQU0sZ0JBQ0YsTUFBOEIsRUFDOUIsUUFBc0c7SUFGMUcsaUJBV0M7SUFQQyxNQUFNLENBQUMsUUFBUTtRQUNiLE1BQU0sQ0FDSjs7Ozs0QkFDYSxxQkFBTSxRQUFRLENBQUMsSUFBSSxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFBOzt3QkFBNUUsRUFBRSxHQUFHLFNBQXVFO3dCQUNsRixzQkFBTyxFQUFFLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxFQUFFLEVBQUM7OzthQUNsQyxDQUFDO1FBQ0wsSUFBSSxtQkFBbUIsQ0FBVSxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUNyRSxDQUFDIiwiZmlsZSI6ImFzeW5jaXRlcmFibGUvc2hhcmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBc3luY0l0ZXJhYmxlWCB9IGZyb20gJy4uL2FzeW5jaXRlcmFibGUnO1xuaW1wb3J0IHsgY3JlYXRlIH0gZnJvbSAnLi9jcmVhdGUnO1xuXG5jbGFzcyBTaGFyZWRBc3luY0l0ZXJhYmxlPFQ+IGV4dGVuZHMgQXN5bmNJdGVyYWJsZVg8VD4ge1xuICBwcml2YXRlIF9pdDogQXN5bmNJdGVyYXRvcjxUPjtcblxuICBjb25zdHJ1Y3RvcihpdDogQXN5bmNJdGVyYXRvcjxUPikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5faXQgPSBpdDtcbiAgfVxuXG4gIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2l0O1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzaGFyZTxUU291cmNlPihcbiAgICBzb3VyY2U6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4pOiBBc3luY0l0ZXJhYmxlWDxUU291cmNlPjtcbmV4cG9ydCBmdW5jdGlvbiBzaGFyZTxUU291cmNlLCBUUmVzdWx0PihcbiAgICBzb3VyY2U6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgc2VsZWN0b3I/OiAodmFsdWU6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4pID0+IEFzeW5jSXRlcmFibGU8VFJlc3VsdD4gfCBQcm9taXNlPEFzeW5jSXRlcmFibGU8VFJlc3VsdD4+KTpcbiAgICAgIEFzeW5jSXRlcmFibGVYPFRSZXN1bHQ+O1xuZXhwb3J0IGZ1bmN0aW9uIHNoYXJlPFRTb3VyY2UsIFRSZXN1bHQgPSBUU291cmNlPihcbiAgICBzb3VyY2U6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgc2VsZWN0b3I/OiAodmFsdWU6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4pID0+IEFzeW5jSXRlcmFibGU8VFJlc3VsdD4gfCBQcm9taXNlPEFzeW5jSXRlcmFibGU8VFJlc3VsdD4+KTpcbiAgICAgIEFzeW5jSXRlcmFibGVYPFRTb3VyY2UgfCBUUmVzdWx0PiB7XG4gIHJldHVybiBzZWxlY3RvciA/XG4gICAgY3JlYXRlPFRSZXN1bHQ+KFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBpdCA9IGF3YWl0IHNlbGVjdG9yKG5ldyBTaGFyZWRBc3luY0l0ZXJhYmxlKHNvdXJjZVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSkpO1xuICAgICAgICByZXR1cm4gaXRbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCk7XG4gICAgICAgfSkgOlxuICAgIG5ldyBTaGFyZWRBc3luY0l0ZXJhYmxlPFRTb3VyY2U+KHNvdXJjZVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSk7XG59XG4iXX0=
