import * as tslib_1 from "tslib";
import { AsyncIterableX } from '../asynciterable';
import { arrayIndexOfAsync } from '../internal/arrayindexof';
import { comparerAsync } from '../internal/comparer';
var UnionAsyncIterable = (function (_super) {
    tslib_1.__extends(UnionAsyncIterable, _super);
    function UnionAsyncIterable(left, right, comparer) {
        var _this = _super.call(this) || this;
        _this._left = left;
        _this._right = right;
        _this._comparer = comparer;
        return _this;
    }
    UnionAsyncIterable.prototype[Symbol.asyncIterator] = function () {
        return tslib_1.__asyncGenerator(this, arguments, function _a() {
            var map, _a, _b, lItem, e_1_1, _c, _d, rItem, e_2_1, e_1, _e, e_2, _f;
            return tslib_1.__generator(this, function (_g) {
                switch (_g.label) {
                    case 0:
                        map = [];
                        _g.label = 1;
                    case 1:
                        _g.trys.push([1, 9, 10, 15]);
                        _a = tslib_1.__asyncValues(this._left);
                        _g.label = 2;
                    case 2: return [4 /*yield*/, tslib_1.__await(_a.next())];
                    case 3:
                        if (!(_b = _g.sent(), !_b.done)) return [3 /*break*/, 8];
                        return [4 /*yield*/, tslib_1.__await(_b.value)];
                    case 4:
                        lItem = _g.sent();
                        return [4 /*yield*/, tslib_1.__await(arrayIndexOfAsync(map, lItem, this._comparer))];
                    case 5:
                        if (!((_g.sent()) === -1)) return [3 /*break*/, 7];
                        map.push(lItem);
                        return [4 /*yield*/, lItem];
                    case 6:
                        _g.sent();
                        _g.label = 7;
                    case 7: return [3 /*break*/, 2];
                    case 8: return [3 /*break*/, 15];
                    case 9:
                        e_1_1 = _g.sent();
                        e_1 = { error: e_1_1 };
                        return [3 /*break*/, 15];
                    case 10:
                        _g.trys.push([10, , 13, 14]);
                        if (!(_b && !_b.done && (_e = _a.return))) return [3 /*break*/, 12];
                        return [4 /*yield*/, tslib_1.__await(_e.call(_a))];
                    case 11:
                        _g.sent();
                        _g.label = 12;
                    case 12: return [3 /*break*/, 14];
                    case 13:
                        if (e_1) throw e_1.error;
                        return [7 /*endfinally*/];
                    case 14: return [7 /*endfinally*/];
                    case 15:
                        _g.trys.push([15, 23, 24, 29]);
                        _c = tslib_1.__asyncValues(this._right);
                        _g.label = 16;
                    case 16: return [4 /*yield*/, tslib_1.__await(_c.next())];
                    case 17:
                        if (!(_d = _g.sent(), !_d.done)) return [3 /*break*/, 22];
                        return [4 /*yield*/, tslib_1.__await(_d.value)];
                    case 18:
                        rItem = _g.sent();
                        return [4 /*yield*/, tslib_1.__await(arrayIndexOfAsync(map, rItem, this._comparer))];
                    case 19:
                        if (!((_g.sent()) === -1)) return [3 /*break*/, 21];
                        map.push(rItem);
                        return [4 /*yield*/, rItem];
                    case 20:
                        _g.sent();
                        _g.label = 21;
                    case 21: return [3 /*break*/, 16];
                    case 22: return [3 /*break*/, 29];
                    case 23:
                        e_2_1 = _g.sent();
                        e_2 = { error: e_2_1 };
                        return [3 /*break*/, 29];
                    case 24:
                        _g.trys.push([24, , 27, 28]);
                        if (!(_d && !_d.done && (_f = _c.return))) return [3 /*break*/, 26];
                        return [4 /*yield*/, tslib_1.__await(_f.call(_c))];
                    case 25:
                        _g.sent();
                        _g.label = 26;
                    case 26: return [3 /*break*/, 28];
                    case 27:
                        if (e_2) throw e_2.error;
                        return [7 /*endfinally*/];
                    case 28: return [7 /*endfinally*/];
                    case 29: return [2 /*return*/];
                }
            });
        });
    };
    return UnionAsyncIterable;
}(AsyncIterableX));
export function union(left, right, comparer) {
    if (comparer === void 0) { comparer = comparerAsync; }
    return new UnionAsyncIterable(left, right, comparer);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvdW5pb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFckQ7SUFBMEMsOENBQXVCO0lBSy9ELDRCQUNJLElBQTRCLEVBQzVCLEtBQTZCLEVBQzdCLFFBQWdFO1FBSHBFLFlBSUUsaUJBQU8sU0FJUjtRQUhDLEtBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLEtBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLEtBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDOztJQUM1QixDQUFDO0lBRU0sNkJBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxHQUE3Qjs7Ozs7O3dCQUNNLEdBQUcsR0FBRyxFQUFFLENBQUM7Ozs7d0JBQ1csS0FBQSxzQkFBQSxJQUFJLENBQUMsS0FBSyxDQUFBOzs7Ozs7O3dCQUFuQixLQUFLLFlBQUE7d0JBQ2QscUNBQU0saUJBQWlCLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUE7OzZCQUFuRCxDQUFBLENBQUEsU0FBbUQsTUFBSyxDQUFDLENBQUMsQ0FBQSxFQUExRCx3QkFBMEQ7d0JBQzVELEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7d0JBQ2hCLHFCQUFNLEtBQUssRUFBQTs7d0JBQVgsU0FBVyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O3dCQUlRLEtBQUEsc0JBQUEsSUFBSSxDQUFDLE1BQU0sQ0FBQTs7Ozs7Ozt3QkFBcEIsS0FBSyxZQUFBO3dCQUNkLHFDQUFNLGlCQUFpQixDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFBOzs2QkFBbkQsQ0FBQSxDQUFBLFNBQW1ELE1BQUssQ0FBQyxDQUFDLENBQUEsRUFBMUQseUJBQTBEO3dCQUM1RCxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUNoQixxQkFBTSxLQUFLLEVBQUE7O3dCQUFYLFNBQVcsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0tBR2pCO0lBQ0gseUJBQUM7QUFBRCxDQS9CQSxBQStCQyxDQS9CeUMsY0FBYyxHQStCdkQ7QUFFRCxNQUFNLGdCQUNGLElBQTRCLEVBQzVCLEtBQTZCLEVBQzdCLFFBQWdGO0lBQWhGLHlCQUFBLEVBQUEsd0JBQWdGO0lBQ2xGLE1BQU0sQ0FBQyxJQUFJLGtCQUFrQixDQUFVLElBQUksRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDaEUsQ0FBQyIsImZpbGUiOiJhc3luY2l0ZXJhYmxlL3VuaW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXN5bmNJdGVyYWJsZVggfSBmcm9tICcuLi9hc3luY2l0ZXJhYmxlJztcbmltcG9ydCB7IGFycmF5SW5kZXhPZkFzeW5jIH0gZnJvbSAnLi4vaW50ZXJuYWwvYXJyYXlpbmRleG9mJztcbmltcG9ydCB7IGNvbXBhcmVyQXN5bmMgfSBmcm9tICcuLi9pbnRlcm5hbC9jb21wYXJlcic7XG5cbmNsYXNzIFVuaW9uQXN5bmNJdGVyYWJsZTxUU291cmNlPiBleHRlbmRzIEFzeW5jSXRlcmFibGVYPFRTb3VyY2U+IHtcbiAgcHJpdmF0ZSBfbGVmdDogQXN5bmNJdGVyYWJsZTxUU291cmNlPjtcbiAgcHJpdmF0ZSBfcmlnaHQ6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT47XG4gIHByaXZhdGUgX2NvbXBhcmVyOiAoeDogVFNvdXJjZSwgeTogVFNvdXJjZSkgPT4gYm9vbGVhbiB8IFByb21pc2U8Ym9vbGVhbj47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgICBsZWZ0OiBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+LFxuICAgICAgcmlnaHQ6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgICBjb21wYXJlcjogKHg6IFRTb3VyY2UsIHk6IFRTb3VyY2UpID0+IGJvb2xlYW4gfCBQcm9taXNlPGJvb2xlYW4+KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9sZWZ0ID0gbGVmdDtcbiAgICB0aGlzLl9yaWdodCA9IHJpZ2h0O1xuICAgIHRoaXMuX2NvbXBhcmVyID0gY29tcGFyZXI7XG4gIH1cblxuICBhc3luYyAqW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICBsZXQgbWFwID0gW107XG4gICAgZm9yIGF3YWl0IChsZXQgbEl0ZW0gb2YgdGhpcy5fbGVmdCkge1xuICAgICAgaWYgKGF3YWl0IGFycmF5SW5kZXhPZkFzeW5jKG1hcCwgbEl0ZW0sIHRoaXMuX2NvbXBhcmVyKSA9PT0gLTEpIHtcbiAgICAgICAgbWFwLnB1c2gobEl0ZW0pO1xuICAgICAgICB5aWVsZCBsSXRlbTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgYXdhaXQgKGxldCBySXRlbSBvZiB0aGlzLl9yaWdodCkge1xuICAgICAgaWYgKGF3YWl0IGFycmF5SW5kZXhPZkFzeW5jKG1hcCwgckl0ZW0sIHRoaXMuX2NvbXBhcmVyKSA9PT0gLTEpIHtcbiAgICAgICAgbWFwLnB1c2gockl0ZW0pO1xuICAgICAgICB5aWVsZCBySXRlbTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVuaW9uPFRTb3VyY2U+KFxuICAgIGxlZnQ6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgcmlnaHQ6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgY29tcGFyZXI6ICh4OiBUU291cmNlLCB5OiBUU291cmNlKSA9PiBib29sZWFuIHwgUHJvbWlzZTxib29sZWFuPiA9IGNvbXBhcmVyQXN5bmMpOiBBc3luY0l0ZXJhYmxlWDxUU291cmNlPiB7XG4gIHJldHVybiBuZXcgVW5pb25Bc3luY0l0ZXJhYmxlPFRTb3VyY2U+KGxlZnQsIHJpZ2h0LCBjb21wYXJlcik7XG59XG4iXX0=
