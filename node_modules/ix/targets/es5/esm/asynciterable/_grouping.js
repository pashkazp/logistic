import * as tslib_1 from "tslib";
/**
 * @ignore
 */
export function createGrouping(source, keySelector, elementSelector) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        var map, source_1, source_1_1, item, key, grouping, element, e_1_1, e_1, _a;
        return tslib_1.__generator(this, function (_b) {
            switch (_b.label) {
                case 0:
                    map = new Map();
                    _b.label = 1;
                case 1:
                    _b.trys.push([1, 9, 10, 15]);
                    source_1 = tslib_1.__asyncValues(source);
                    _b.label = 2;
                case 2: return [4 /*yield*/, source_1.next()];
                case 3:
                    if (!(source_1_1 = _b.sent(), !source_1_1.done)) return [3 /*break*/, 8];
                    return [4 /*yield*/, source_1_1.value];
                case 4:
                    item = _b.sent();
                    return [4 /*yield*/, keySelector(item)];
                case 5:
                    key = _b.sent();
                    grouping = map.get(key);
                    if (!map.has(key)) {
                        grouping = [];
                        map.set(key, grouping);
                    }
                    return [4 /*yield*/, elementSelector(item)];
                case 6:
                    element = _b.sent();
                    grouping.push(element);
                    _b.label = 7;
                case 7: return [3 /*break*/, 2];
                case 8: return [3 /*break*/, 15];
                case 9:
                    e_1_1 = _b.sent();
                    e_1 = { error: e_1_1 };
                    return [3 /*break*/, 15];
                case 10:
                    _b.trys.push([10, , 13, 14]);
                    if (!(source_1_1 && !source_1_1.done && (_a = source_1.return))) return [3 /*break*/, 12];
                    return [4 /*yield*/, _a.call(source_1)];
                case 11:
                    _b.sent();
                    _b.label = 12;
                case 12: return [3 /*break*/, 14];
                case 13:
                    if (e_1) throw e_1.error;
                    return [7 /*endfinally*/];
                case 14: return [7 /*endfinally*/];
                case 15: return [2 /*return*/, map];
            }
        });
    });
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvX2dyb3VwaW5nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRztBQUNILE1BQU0seUJBQ0YsTUFBOEIsRUFDOUIsV0FBcUQsRUFDckQsZUFBNkQ7Ozs7OztvQkFDM0QsR0FBRyxHQUFHLElBQUksR0FBRyxFQUFrQixDQUFDOzs7O29CQUNiLFdBQUEsc0JBQUEsTUFBTSxDQUFBOzs7Ozs7O29CQUFkLElBQUksWUFBQTtvQkFDUCxxQkFBTSxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUE7O29CQUE3QixHQUFHLEdBQUcsU0FBdUI7b0JBQzdCLFFBQVEsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUM1QixFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNsQixRQUFRLEdBQUcsRUFBRSxDQUFDO3dCQUNkLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDO29CQUN6QixDQUFDO29CQUNhLHFCQUFNLGVBQWUsQ0FBQyxJQUFJLENBQUMsRUFBQTs7b0JBQXJDLE9BQU8sR0FBRyxTQUEyQjtvQkFDekMsUUFBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7eUJBRzFCLHNCQUFPLEdBQUcsRUFBQzs7OztDQUNaIiwiZmlsZSI6ImFzeW5jaXRlcmFibGUvX2dyb3VwaW5nLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAaWdub3JlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVHcm91cGluZzxUU291cmNlLCBUS2V5LCBUVmFsdWU+KFxuICAgIHNvdXJjZTogQXN5bmNJdGVyYWJsZTxUU291cmNlPixcbiAgICBrZXlTZWxlY3RvcjogKHZhbHVlOiBUU291cmNlKSA9PiBUS2V5IHwgUHJvbWlzZTxUS2V5PixcbiAgICBlbGVtZW50U2VsZWN0b3I6ICh2YWx1ZTogVFNvdXJjZSkgPT4gVFZhbHVlIHwgUHJvbWlzZTxUVmFsdWU+KTogUHJvbWlzZTxNYXA8VEtleSwgVFZhbHVlW10+PiB7XG4gIGxldCBtYXAgPSBuZXcgTWFwPFRLZXksIFRWYWx1ZVtdPigpO1xuICBmb3IgYXdhaXQgKGxldCBpdGVtIG9mIHNvdXJjZSkge1xuICAgIGxldCBrZXkgPSBhd2FpdCBrZXlTZWxlY3RvcihpdGVtKTtcbiAgICBsZXQgZ3JvdXBpbmcgPSBtYXAuZ2V0KGtleSk7XG4gICAgaWYgKCFtYXAuaGFzKGtleSkpIHtcbiAgICAgIGdyb3VwaW5nID0gW107XG4gICAgICBtYXAuc2V0KGtleSwgZ3JvdXBpbmcpO1xuICAgIH1cbiAgICBsZXQgZWxlbWVudCA9IGF3YWl0IGVsZW1lbnRTZWxlY3RvcihpdGVtKTtcbiAgICBncm91cGluZyEucHVzaChlbGVtZW50KTtcbiAgfVxuXG4gIHJldHVybiBtYXA7XG59XG4iXX0=
