import { AsyncSink } from '../asyncsink';
import { memoize } from './memoize';
export function fromEventPattern(addHandler, removeHandler) {
    var sink = new AsyncSink();
    var handler = function (e) { return sink.write(e); };
    addHandler(handler);
    return memoize((_a = {},
        _a[Symbol.asyncIterator] = function () {
            return {
                next: function () {
                    return sink.next();
                },
                return: function () {
                    removeHandler(handler);
                    sink.end();
                    return Promise.resolve({ done: true });
                }
            };
        },
        _a));
    var _a;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvZnJvbWV2ZW50cGF0dGVybi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFcEMsTUFBTSwyQkFDRixVQUF1RCxFQUN2RCxhQUEwRDtJQUM1RCxJQUFNLElBQUksR0FBRyxJQUFJLFNBQVMsRUFBVyxDQUFDO0lBQ3RDLElBQU0sT0FBTyxHQUFHLFVBQUMsQ0FBVSxJQUFLLE9BQUEsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBYixDQUFhLENBQUM7SUFFOUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRXBCLE1BQU0sQ0FBQyxPQUFPO1FBQ1osR0FBQyxNQUFNLENBQUMsYUFBYSxJQUFyQjtZQUNFLE1BQU0sQ0FBQztnQkFDTCxJQUFJO29CQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ3JCLENBQUM7Z0JBRUQsTUFBTTtvQkFDSixhQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQ3ZCLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDWCxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQTZCLENBQUMsQ0FBQztnQkFDcEUsQ0FBQzthQUNGLENBQUM7UUFDSixDQUFDO1lBQ0QsQ0FBQzs7QUFDTCxDQUFDIiwiZmlsZSI6ImFzeW5jaXRlcmFibGUvZnJvbWV2ZW50cGF0dGVybi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jU2luayB9IGZyb20gJy4uL2FzeW5jc2luayc7XG5pbXBvcnQgeyBtZW1vaXplIH0gZnJvbSAnLi9tZW1vaXplJztcblxuZXhwb3J0IGZ1bmN0aW9uIGZyb21FdmVudFBhdHRlcm48VFNvdXJjZT4oXG4gICAgYWRkSGFuZGxlcjogKGhhbmRsZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCkgPT4gdm9pZCxcbiAgICByZW1vdmVIYW5kbGVyOiAoaGFuZGxlcjogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkKSA9PiB2b2lkKTogQXN5bmNJdGVyYWJsZTxUU291cmNlPiB7XG4gIGNvbnN0IHNpbmsgPSBuZXcgQXN5bmNTaW5rPFRTb3VyY2U+KCk7XG4gIGNvbnN0IGhhbmRsZXIgPSAoZTogVFNvdXJjZSkgPT4gc2luay53cml0ZShlKTtcblxuICBhZGRIYW5kbGVyKGhhbmRsZXIpO1xuXG4gIHJldHVybiBtZW1vaXplKHtcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmV4dCgpIHtcbiAgICAgICAgICByZXR1cm4gc2luay5uZXh0KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmV0dXJuKCkge1xuICAgICAgICAgIHJlbW92ZUhhbmRsZXIoaGFuZGxlcik7XG4gICAgICAgICAgc2luay5lbmQoKTtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgZG9uZTogdHJ1ZSB9IGFzIEl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH0pO1xufVxuIl19
