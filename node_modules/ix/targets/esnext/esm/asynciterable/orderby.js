import { AsyncIterableX } from '../asynciterable';
import { toArray } from './toarray';
import { sorter as defaultSorter } from '../internal/sorter';
export class OrderedAsyncIterableBaseX extends AsyncIterableX {
    constructor(source) {
        super();
        this._source = source;
    }
    async *[Symbol.asyncIterator]() {
        const array = await toArray(this._source);
        const len = array.length;
        const indices = new Array(len);
        for (let i = 0, len = array.length; i < len; i++) {
            indices[i] = i;
        }
        indices.sort(this._getSorter(array));
        for (const index of indices) {
            yield array[index];
        }
    }
    thenBy(keySelector, comparer = defaultSorter) {
        /* tslint:disable-next-line: no-use-before-declare */
        return new OrderedAsyncIterableX(this._source, keySelector, comparer, false, this);
    }
    thenByDescending(keySelector, comparer = defaultSorter) {
        /* tslint:disable-next-line: no-use-before-declare */
        return new OrderedAsyncIterableX(this._source, keySelector, comparer, true, this);
    }
}
export class OrderedAsyncIterableX extends OrderedAsyncIterableBaseX {
    constructor(source, keySelector, comparer, descending, parent) {
        super(source);
        this._keySelector = keySelector;
        this._comparer = comparer;
        this._descending = descending;
        this._parent = parent;
    }
    _getSorter(elements, next) {
        const keys = elements.map(this._keySelector);
        const comparer = this._comparer;
        const parent = this._parent;
        const descending = this._descending;
        const sorter = (x, y) => {
            const result = comparer(keys[x], keys[y]);
            if (result === 0) {
                return next ? next(x, y) : x - y;
            }
            return descending ? -result : result;
        };
        return parent ? parent._getSorter(elements, sorter) : sorter;
    }
}
export function orderBy(source, keySelector, comparer = defaultSorter) {
    return new OrderedAsyncIterableX(source, keySelector, comparer, false);
}
export function orderByDescending(source, keySelector, comparer = defaultSorter) {
    return new OrderedAsyncIterableX(source, keySelector, comparer, true);
}
export function thenBy(source, keySelector, comparer = defaultSorter) {
    return new OrderedAsyncIterableX(source._source, keySelector, comparer, false, source);
}
export function thenByDescending(source, keySelector, comparer = defaultSorter) {
    return new OrderedAsyncIterableX(source._source, keySelector, comparer, true, source);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvb3JkZXJieS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNwQyxPQUFPLEVBQUUsTUFBTSxJQUFJLGFBQWEsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRTdELE1BQU0sZ0NBQW1ELFNBQVEsY0FBdUI7SUFHdEYsWUFBWSxNQUE4QjtRQUN4QyxLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO0lBQ3hCLENBQUM7SUFFRCxLQUFLLEVBQUUsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDO1FBQzNCLE1BQU0sS0FBSyxHQUFHLE1BQU0sT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMxQyxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO1FBQ3pCLE1BQU0sT0FBTyxHQUFHLElBQUksS0FBSyxDQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDakQsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNqQixDQUFDO1FBRUQsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDckMsR0FBRyxDQUFDLENBQUMsTUFBTSxLQUFLLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQztZQUM1QixNQUFNLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNyQixDQUFDO0lBQ0gsQ0FBQztJQUVELE1BQU0sQ0FDRixXQUFvQyxFQUNwQyxXQUE2QyxhQUFh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QUFFLE1BQU0sQ0FBQyxDQUFDO0FBQ3ZHLENBQUMiLCJmaWxlIjoiYXN5bmNpdGVyYWJsZS9vcmRlcmJ5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXN5bmNJdGVyYWJsZVggfSBmcm9tICcuLi9hc3luY2l0ZXJhYmxlJztcbmltcG9ydCB7IHRvQXJyYXkgfSBmcm9tICcuL3RvYXJyYXknO1xuaW1wb3J0IHsgc29ydGVyIGFzIGRlZmF1bHRTb3J0ZXIgfSBmcm9tICcuLi9pbnRlcm5hbC9zb3J0ZXInO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgT3JkZXJlZEFzeW5jSXRlcmFibGVCYXNlWDxUU291cmNlPiBleHRlbmRzIEFzeW5jSXRlcmFibGVYPFRTb3VyY2U+IHtcbiAgX3NvdXJjZTogQXN5bmNJdGVyYWJsZTxUU291cmNlPjtcblxuICBjb25zdHJ1Y3Rvcihzb3VyY2U6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3NvdXJjZSA9IHNvdXJjZTtcbiAgfVxuXG4gIGFzeW5jICpbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgIGNvbnN0IGFycmF5ID0gYXdhaXQgdG9BcnJheSh0aGlzLl9zb3VyY2UpO1xuICAgIGNvbnN0IGxlbiA9IGFycmF5Lmxlbmd0aDtcbiAgICBjb25zdCBpbmRpY2VzID0gbmV3IEFycmF5PG51bWJlcj4obGVuKTtcbiAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gYXJyYXkubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGluZGljZXNbaV0gPSBpO1xuICAgIH1cblxuICAgIGluZGljZXMuc29ydCh0aGlzLl9nZXRTb3J0ZXIoYXJyYXkpKTtcbiAgICBmb3IgKGNvbnN0IGluZGV4IG9mIGluZGljZXMpIHtcbiAgICAgIHlpZWxkIGFycmF5W2luZGV4XTtcbiAgICB9XG4gIH1cblxuICB0aGVuQnk8VEtleT4oXG4gICAgICBrZXlTZWxlY3RvcjogKGl0ZW06IFRTb3VyY2UpID0+IFRLZXksXG4gICAgICBjb21wYXJlcjogKGZzdDogVEtleSwgc25kOiBUS2V5KSA9PiBudW1iZXIgPSBkZWZhdWx0U29ydGVyKTogT3JkZXJlZEFzeW5jSXRlcmFibGVCYXNlWDxUU291cmNlPiB7XG4gICAgLyogdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby11c2UtYmVmb3JlLWRlY2xhcmUgKi9cbiAgICByZXR1cm4gbmV3IE9yZGVyZWRBc3luY0l0ZXJhYmxlWDxUS2V5LCBUU291cmNlPih0aGlzLl9zb3VyY2UsIGtleVNlbGVjdG9yLCBjb21wYXJlciwgZmFsc2UsIHRoaXMpO1xuICB9XG5cbiAgdGhlbkJ5RGVzY2VuZGluZzxUS2V5PihcbiAgICAgIGtleVNlbGVjdG9yOiAoaXRlbTogVFNvdXJjZSkgPT4gVEtleSxcbiAgICAgIGNvbXBhcmVyOiAoZnN0OiBUS2V5LCBzbmQ6IFRLZXkpID0+IG51bWJlciA9IGRlZmF1bHRTb3J0ZXIpOiBPcmRlcmVkQXN5bmNJdGVyYWJsZUJhc2VYPFRTb3VyY2U+IHtcbiAgICAvKiB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLXVzZS1iZWZvcmUtZGVjbGFyZSAqL1xuICAgIHJldHVybiBuZXcgT3JkZXJlZEFzeW5jSXRlcmFibGVYPFRLZXksIFRTb3VyY2U+KHRoaXMuX3NvdXJjZSwga2V5U2VsZWN0b3IsIGNvbXBhcmVyLCB0cnVlLCB0aGlzKTtcbiAgfVxuXG4gIGFic3RyYWN0IF9nZXRTb3J0ZXIoXG4gICAgZWxlbWVudHM6IFRTb3VyY2VbXSxcbiAgICBuZXh0PzogKHg6IG51bWJlciwgeTogbnVtYmVyKSA9PiBudW1iZXIpOiAoeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIE9yZGVyZWRBc3luY0l0ZXJhYmxlWDxUS2V5LCBUU291cmNlPiBleHRlbmRzIE9yZGVyZWRBc3luY0l0ZXJhYmxlQmFzZVg8VFNvdXJjZT4ge1xuICBwcml2YXRlIF9rZXlTZWxlY3RvcjogKGl0ZW06IFRTb3VyY2UpID0+IFRLZXk7XG4gIHByaXZhdGUgX2NvbXBhcmVyOiAoZnN0OiBUS2V5LCBzbmQ6IFRLZXkpID0+IG51bWJlcjtcbiAgcHJpdmF0ZSBfZGVzY2VuZGluZzogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfcGFyZW50PzogT3JkZXJlZEFzeW5jSXRlcmFibGVCYXNlWDxUU291cmNlPjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICAgIHNvdXJjZTogQXN5bmNJdGVyYWJsZTxUU291cmNlPixcbiAgICAgIGtleVNlbGVjdG9yOiAoaXRlbTogVFNvdXJjZSkgPT4gVEtleSxcbiAgICAgIGNvbXBhcmVyOiAoZnN0OiBUS2V5LCBzbmQ6IFRLZXkpID0+IG51bWJlcixcbiAgICAgIGRlc2NlbmRpbmc6IGJvb2xlYW4sXG4gICAgICBwYXJlbnQ/OiBPcmRlcmVkQXN5bmNJdGVyYWJsZUJhc2VYPFRTb3VyY2U+KSB7XG4gICAgc3VwZXIoc291cmNlKTtcbiAgICB0aGlzLl9rZXlTZWxlY3RvciA9IGtleVNlbGVjdG9yO1xuICAgIHRoaXMuX2NvbXBhcmVyID0gY29tcGFyZXI7XG4gICAgdGhpcy5fZGVzY2VuZGluZyA9IGRlc2NlbmRpbmc7XG4gICAgdGhpcy5fcGFyZW50ID0gcGFyZW50O1xuICB9XG5cbiAgX2dldFNvcnRlcihcbiAgICAgIGVsZW1lbnRzOiBUU291cmNlW10sXG4gICAgICBuZXh0PzogKHg6IG51bWJlciwgeTogbnVtYmVyKSA9PiBudW1iZXIpOiAoeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IG51bWJlciB7XG4gICAgY29uc3Qga2V5cyA9IGVsZW1lbnRzLm1hcCh0aGlzLl9rZXlTZWxlY3Rvcik7XG4gICAgY29uc3QgY29tcGFyZXIgPSB0aGlzLl9jb21wYXJlcjtcbiAgICBjb25zdCBwYXJlbnQgPSB0aGlzLl9wYXJlbnQ7XG4gICAgY29uc3QgZGVzY2VuZGluZyA9IHRoaXMuX2Rlc2NlbmRpbmc7XG4gICAgY29uc3Qgc29ydGVyID0gKHg6IG51bWJlciwgeTogbnVtYmVyKTogbnVtYmVyID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbXBhcmVyKGtleXNbeF0sIGtleXNbeV0pO1xuICAgICAgaWYgKHJlc3VsdCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gbmV4dCA/IG5leHQoeCwgeSkgOiB4IC0geTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRlc2NlbmRpbmcgPyAtcmVzdWx0IDogcmVzdWx0O1xuICAgIH07XG5cbiAgICByZXR1cm4gcGFyZW50ID8gcGFyZW50Ll9nZXRTb3J0ZXIoZWxlbWVudHMsIHNvcnRlcikgOiBzb3J0ZXI7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9yZGVyQnk8VEtleSwgVFNvdXJjZT4oXG4gICAgICBzb3VyY2U6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgICBrZXlTZWxlY3RvcjogKGl0ZW06IFRTb3VyY2UpID0+IFRLZXksXG4gICAgICBjb21wYXJlcjogKGZzdDogVEtleSwgc25kOiBUS2V5KSA9PiBudW1iZXIgPSBkZWZhdWx0U29ydGVyKTogT3JkZXJlZEFzeW5jSXRlcmFibGVYPFRLZXksIFRTb3VyY2U+IHtcbiAgcmV0dXJuIG5ldyBPcmRlcmVkQXN5bmNJdGVyYWJsZVg8VEtleSwgVFNvdXJjZT4oc291cmNlLCBrZXlTZWxlY3RvciwgY29tcGFyZXIsIGZhbHNlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9yZGVyQnlEZXNjZW5kaW5nPFRLZXksIFRTb3VyY2U+KFxuICAgICAgc291cmNlOiBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+LFxuICAgICAga2V5U2VsZWN0b3I6IChpdGVtOiBUU291cmNlKSA9PiBUS2V5LFxuICAgICAgY29tcGFyZXI6IChmc3Q6IFRLZXksIHNuZDogVEtleSkgPT4gbnVtYmVyID0gZGVmYXVsdFNvcnRlcik6IE9yZGVyZWRBc3luY0l0ZXJhYmxlWDxUS2V5LCBUU291cmNlPiB7XG4gIHJldHVybiBuZXcgT3JkZXJlZEFzeW5jSXRlcmFibGVYPFRLZXksIFRTb3VyY2U+KHNvdXJjZSwga2V5U2VsZWN0b3IsIGNvbXBhcmVyLCB0cnVlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRoZW5CeTxUS2V5LCBUU291cmNlPihcbiAgICAgIHNvdXJjZTogT3JkZXJlZEFzeW5jSXRlcmFibGVCYXNlWDxUU291cmNlPixcbiAgICAgIGtleVNlbGVjdG9yOiAoaXRlbTogVFNvdXJjZSkgPT4gVEtleSxcbiAgICAgIGNvbXBhcmVyOiAoZnN0OiBUS2V5LCBzbmQ6IFRLZXkpID0+IG51bWJlciA9IGRlZmF1bHRTb3J0ZXIpOiBPcmRlcmVkQXN5bmNJdGVyYWJsZVg8VEtleSwgVFNvdXJjZT4ge1xuICByZXR1cm4gbmV3IE9yZGVyZWRBc3luY0l0ZXJhYmxlWDxUS2V5LCBUU291cmNlPihzb3VyY2UuX3NvdXJjZSwga2V5U2VsZWN0b3IsIGNvbXBhcmVyLCBmYWxzZSwgc291cmNlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRoZW5CeURlc2NlbmRpbmc8VEtleSwgVFNvdXJjZT4oXG4gICAgICBzb3VyY2U6IE9yZGVyZWRBc3luY0l0ZXJhYmxlQmFzZVg8VFNvdXJjZT4sXG4gICAgICBrZXlTZWxlY3RvcjogKGl0ZW06IFRTb3VyY2UpID0+IFRLZXksXG4gICAgICBjb21wYXJlcjogKGZzdDogVEtleSwgc25kOiBUS2V5KSA9PiBudW1iZXIgPSBkZWZhdWx0U29ydGVyKTogT3JkZXJlZEFzeW5jSXRlcmFibGVYPFRLZXksIFRTb3VyY2U+IHtcbiAgcmV0dXJuIG5ldyBPcmRlcmVkQXN5bmNJdGVyYWJsZVg8VEtleSwgVFNvdXJjZT4oc291cmNlLl9zb3VyY2UsIGtleVNlbGVjdG9yLCBjb21wYXJlciwgdHJ1ZSwgc291cmNlKTtcbn1cbiJdfQ==
