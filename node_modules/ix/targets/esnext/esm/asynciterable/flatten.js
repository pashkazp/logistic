import { AsyncIterableX } from '../asynciterable';
import { isAsyncIterable } from '../internal/isiterable';
class FlattenAsyncIterable extends AsyncIterableX {
    constructor(source, depth) {
        super();
        this._source = source;
        this._depth = depth;
    }
    async *_flatten(source, depth) {
        if (depth === 0) {
            for await (let item of source) {
                yield item;
            }
            return;
        }
        for await (let item of source) {
            if (isAsyncIterable(item)) {
                for await (let innerItem of this._flatten(item, depth - 1)) {
                    yield innerItem;
                }
            }
            else {
                yield item;
            }
        }
    }
    [Symbol.asyncIterator]() {
        return this._flatten(this._source, this._depth)[Symbol.asyncIterator]();
    }
}
export function flatten(source, depth = Infinity) {
    return new FlattenAsyncIterable(source, depth);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvZmxhdHRlbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRXpELDBCQUFvQyxTQUFRLGNBQXVCO0lBSWpFLFlBQVksTUFBOEIsRUFBRSxLQUFhO1FBQ3ZELEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDdEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7SUFDdEIsQ0FBQztJQUVPLEtBQUssRUFBRSxRQUFRLENBQUMsTUFBOEIsRUFBRSxLQUFhO1FBQ25FLEVBQUUsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hCLEdBQUcsQ0FBQyxLQUFLLENBQUwsQ0FBTyxJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUFDLE1BQU0sSUFBSSxDQUFDO1lBQUMsQ0FBQztZQUM5QyxNQUFNLENBQUM7UUFDVCxDQUFDO1FBQ0QsR0FBRyxDQUFDLEtBQUssQ0FBTCxDQUFPLElBQUksSUFBSSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDOUIsRUFBRSxDQUFDLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDMUIsR0FBRyxDQUFDLEtBQUssQ0FBTCxDQUFPLElBQUksU0FBUyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQUMsTUFBTSxTQUFTLENBQUM7Z0JBQUMsQ0FBQztZQUNsRixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sTUFBTSxJQUFJLENBQUM7WUFDYixDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUM7UUFDcEIsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUM7SUFDMUUsQ0FBQztDQUNGO0FBRUQsTUFBTSxrQkFBcUIsTUFBd0IsRUFBRSxRQUFnQixRQUFRO0lBQzNFLE1BQU0sQ0FBQyxJQUFJLG9CQUFvQixDQUFJLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNwRCxDQUFDIiwiZmlsZSI6ImFzeW5jaXRlcmFibGUvZmxhdHRlbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jSXRlcmFibGVYIH0gZnJvbSAnLi4vYXN5bmNpdGVyYWJsZSc7XG5pbXBvcnQgeyBpc0FzeW5jSXRlcmFibGUgfSBmcm9tICcuLi9pbnRlcm5hbC9pc2l0ZXJhYmxlJztcblxuY2xhc3MgRmxhdHRlbkFzeW5jSXRlcmFibGU8VFNvdXJjZT4gZXh0ZW5kcyBBc3luY0l0ZXJhYmxlWDxUU291cmNlPiB7XG4gIHByaXZhdGUgX3NvdXJjZTogQXN5bmNJdGVyYWJsZTxUU291cmNlPjtcbiAgcHJpdmF0ZSBfZGVwdGg6IG51bWJlcjtcblxuICBjb25zdHJ1Y3Rvcihzb3VyY2U6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sIGRlcHRoOiBudW1iZXIpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3NvdXJjZSA9IHNvdXJjZTtcbiAgICB0aGlzLl9kZXB0aCA9IGRlcHRoO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyAqX2ZsYXR0ZW4oc291cmNlOiBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+LCBkZXB0aDogbnVtYmVyKTogQXN5bmNJdGVyYWJsZTxUU291cmNlPiB7XG4gICAgaWYgKGRlcHRoID09PSAwKSB7XG4gICAgICBmb3IgYXdhaXQgKGxldCBpdGVtIG9mIHNvdXJjZSkgeyB5aWVsZCBpdGVtOyB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGZvciBhd2FpdCAobGV0IGl0ZW0gb2Ygc291cmNlKSB7XG4gICAgICBpZiAoaXNBc3luY0l0ZXJhYmxlKGl0ZW0pKSB7XG4gICAgICAgIGZvciBhd2FpdCAobGV0IGlubmVySXRlbSBvZiB0aGlzLl9mbGF0dGVuKGl0ZW0sIGRlcHRoIC0gMSkpIHsgeWllbGQgaW5uZXJJdGVtOyB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB5aWVsZCBpdGVtO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZsYXR0ZW4odGhpcy5fc291cmNlLCB0aGlzLl9kZXB0aClbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZsYXR0ZW48VD4oc291cmNlOiBBc3luY0l0ZXJhYmxlPFQ+LCBkZXB0aDogbnVtYmVyID0gSW5maW5pdHkpOiBBc3luY0l0ZXJhYmxlWDxUPiB7XG4gIHJldHVybiBuZXcgRmxhdHRlbkFzeW5jSXRlcmFibGU8VD4oc291cmNlLCBkZXB0aCk7XG59XG4iXX0=
