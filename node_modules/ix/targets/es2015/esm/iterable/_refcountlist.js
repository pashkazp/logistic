/**
 * @ignore
 */
export class MaxRefCountList {
    constructor() {
        this._list = [];
    }
    clear() { this._list = []; }
    get count() { return this._list.length; }
    get(index) { return this._list[index]; }
    push(value) { this._list.push(value); }
    // tslint:disable-next-line:no-empty
    done() { }
}
/**
 * @ignore
 */
export class RefCountList {
    constructor(readerCount) {
        this._count = 0;
        this._readerCount = readerCount;
        this._list = new Map();
    }
    clear() { this._list.clear(); }
    get count() { return this._count; }
    get readerCount() { return this._readerCount; }
    set readerCount(value) { this._readerCount = value; }
    done() { this._readerCount--; }
    get(index) {
        if (!this._list.has(index)) {
            throw new Error('Element no longer available in the buffer.');
        }
        const res = this._list.get(index);
        const val = res.value;
        if (--res.count === 0) {
            this._list.delete(index);
        }
        return val;
    }
    push(value) {
        this._list.set(this._count++, { value: value, count: this._readerCount });
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIml0ZXJhYmxlL19yZWZjb3VudGxpc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBbUJBOztHQUVHO0FBQ0gsTUFBTTtJQUFOO1FBQ1UsVUFBSyxHQUFRLEVBQUUsQ0FBQztJQVMxQixDQUFDO0lBUEMsS0FBSyxLQUFLLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUM1QixJQUFJLEtBQUssS0FBSyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ3pDLEdBQUcsQ0FBQyxLQUFhLElBQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25ELElBQUksQ0FBQyxLQUFRLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTFDLG9DQUFvQztJQUNwQyxJQUFJLEtBQUssQ0FBQztDQUNYO0FBRUQ7O0dBRUc7QUFDSCxNQUFNO0lBS0osWUFBWSxXQUFtQjtRQUZ2QixXQUFNLEdBQVcsQ0FBQyxDQUFDO1FBR3pCLElBQUksQ0FBQyxZQUFZLEdBQUcsV0FBVyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxHQUFHLEVBQXVCLENBQUM7SUFDOUMsQ0FBQztJQUVELEtBQUssS0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUMvQixJQUFJLEtBQUssS0FBSyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDbkMsSUFBSSxXQUFXLEtBQUssTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO0lBQy9DLElBQUksV0FBVyxDQUFDLEtBQWEsSUFBSSxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDN0QsSUFBSSxLQUFLLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFFL0IsR0FBRyxDQUFDLEtBQWE7UUFDZixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMzQixNQUFNLElBQUksS0FBSyxDQUFDLDRDQUE0QyxDQUFDLENBQUM7UUFDaEUsQ0FBQztRQUNELE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBRSxDQUFDO1FBQ25DLE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUM7UUFDdEIsRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0IsQ0FBQztRQUNELE1BQU0sQ0FBQyxHQUFHLENBQUM7SUFDYixDQUFDO0lBRUQsSUFBSSxDQUFDLEtBQVE7UUFDWCxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQztJQUM1RSxDQUFDO0NBQ0YiLCJmaWxlIjoiaXRlcmFibGUvX3JlZmNvdW50bGlzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlZkNvdW50PFQ+IHtcbiAgdmFsdWU6IFQ7XG4gIGNvdW50OiBudW1iZXI7XG59XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIElSZWZDb3VudExpc3Q8VD4ge1xuICBjbGVhcigpOiB2b2lkO1xuICByZWFkb25seSBjb3VudDogbnVtYmVyO1xuICBnZXQoaW5kZXg6IG51bWJlcik6IFQ7XG4gIHB1c2godmFsdWU6IFQpOiB2b2lkO1xuICBkb25lKCk6IHZvaWQ7XG59XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgY2xhc3MgTWF4UmVmQ291bnRMaXN0PFQ+IGltcGxlbWVudHMgSVJlZkNvdW50TGlzdDxUPiB7XG4gIHByaXZhdGUgX2xpc3Q6IFRbXSA9IFtdO1xuXG4gIGNsZWFyKCkgeyB0aGlzLl9saXN0ID0gW107IH1cbiAgZ2V0IGNvdW50KCkgeyByZXR1cm4gdGhpcy5fbGlzdC5sZW5ndGg7IH1cbiAgZ2V0KGluZGV4OiBudW1iZXIpOiBUIHsgcmV0dXJuIHRoaXMuX2xpc3RbaW5kZXhdOyB9XG4gIHB1c2godmFsdWU6IFQpIHsgdGhpcy5fbGlzdC5wdXNoKHZhbHVlKTsgfVxuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1lbXB0eVxuICBkb25lKCkgeyB9XG59XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgY2xhc3MgUmVmQ291bnRMaXN0PFQ+IGltcGxlbWVudHMgSVJlZkNvdW50TGlzdDxUPiB7XG4gIHByaXZhdGUgX3JlYWRlckNvdW50OiBudW1iZXI7XG4gIHByaXZhdGUgX2xpc3Q6IE1hcDxudW1iZXIsIFJlZkNvdW50PFQ+PjtcbiAgcHJpdmF0ZSBfY291bnQ6IG51bWJlciA9IDA7XG5cbiAgY29uc3RydWN0b3IocmVhZGVyQ291bnQ6IG51bWJlcikge1xuICAgIHRoaXMuX3JlYWRlckNvdW50ID0gcmVhZGVyQ291bnQ7XG4gICAgdGhpcy5fbGlzdCA9IG5ldyBNYXA8bnVtYmVyLCBSZWZDb3VudDxUPj4oKTtcbiAgfVxuXG4gIGNsZWFyKCkgeyB0aGlzLl9saXN0LmNsZWFyKCk7IH1cbiAgZ2V0IGNvdW50KCkgeyByZXR1cm4gdGhpcy5fY291bnQ7IH1cbiAgZ2V0IHJlYWRlckNvdW50KCkgeyByZXR1cm4gdGhpcy5fcmVhZGVyQ291bnQ7IH1cbiAgc2V0IHJlYWRlckNvdW50KHZhbHVlOiBudW1iZXIpIHsgdGhpcy5fcmVhZGVyQ291bnQgPSB2YWx1ZTsgfVxuICBkb25lKCkgeyB0aGlzLl9yZWFkZXJDb3VudC0tOyB9XG5cbiAgZ2V0KGluZGV4OiBudW1iZXIpOiBUIHtcbiAgICBpZiAoIXRoaXMuX2xpc3QuaGFzKGluZGV4KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbGVtZW50IG5vIGxvbmdlciBhdmFpbGFibGUgaW4gdGhlIGJ1ZmZlci4nKTtcbiAgICB9XG4gICAgY29uc3QgcmVzID0gdGhpcy5fbGlzdC5nZXQoaW5kZXgpITtcbiAgICBjb25zdCB2YWwgPSByZXMudmFsdWU7XG4gICAgaWYgKC0tcmVzLmNvdW50ID09PSAwKSB7XG4gICAgICB0aGlzLl9saXN0LmRlbGV0ZShpbmRleCk7XG4gICAgfVxuICAgIHJldHVybiB2YWw7XG4gIH1cblxuICBwdXNoKHZhbHVlOiBUKSB7XG4gICAgdGhpcy5fbGlzdC5zZXQodGhpcy5fY291bnQrKywgeyB2YWx1ZTogdmFsdWUsIGNvdW50OiB0aGlzLl9yZWFkZXJDb3VudCB9KTtcbiAgfVxufVxuIl19
