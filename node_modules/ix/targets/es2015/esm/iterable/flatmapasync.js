import * as tslib_1 from "tslib";
import { AsyncIterableX } from '../asynciterable';
import { bindCallback } from '../internal/bindcallback';
class FlatMapAsyncIterable extends AsyncIterableX {
    constructor(source, selector) {
        super();
        this._source = source;
        this._selector = selector;
    }
    [Symbol.asyncIterator]() {
        return tslib_1.__asyncGenerator(this, arguments, function* _a() {
            try {
                for (var _a = tslib_1.__asyncValues((this._source)), _b; _b = yield tslib_1.__await(_a.next()), !_b.done;) {
                    let outer = yield tslib_1.__await(_b.value);
                    try {
                        for (var _c = tslib_1.__asyncValues((this._selector(outer))), _d; _d = yield tslib_1.__await(_c.next()), !_d.done;) {
                            let inner = yield tslib_1.__await(_d.value);
                            yield inner;
                        }
                    }
                    catch (e_1_1) { e_1 = { error: e_1_1 }; }
                    finally {
                        try {
                            if (_d && !_d.done && (_e = _c.return)) yield tslib_1.__await(_e.call(_c));
                        }
                        finally { if (e_1) throw e_1.error; }
                    }
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_b && !_b.done && (_f = _a.return)) yield tslib_1.__await(_f.call(_a));
                }
                finally { if (e_2) throw e_2.error; }
            }
            var e_2, _f, e_1, _e;
        });
    }
}
/**
 * Projects each element of a sequence to a potentially async iterable and flattens the
 * resulting sequences into one sequence.
 * @param {Iterable<T | Promise<T>> | AsyncIterable<T>} source Source sequence
 * @param {function:(value: T): Iterable<R | Promise<R>> | AsyncIterable<R>} selector A transform function to apply to each element.
 * @param {Object} [thisArg] An optional "this" binding for the selector function.
 * @returns {AsyncIterable<R>} An async iterable whose elements are the result of invoking the one-to-many
 * transform function on each element of the input sequence.
 */
export function flatMapAsync(source, selector, thisArg) {
    return new FlatMapAsyncIterable(source, bindCallback(selector, thisArg, 1));
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIml0ZXJhYmxlL2ZsYXRtYXBhc3luYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUV4RCwwQkFBNkMsU0FBUSxjQUF1QjtJQUkxRSxZQUNFLE1BQXlFLEVBQ3pFLFFBQStGO1FBQy9GLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDdEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7SUFDNUIsQ0FBQztJQUVNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQzs7O2dCQUMzQixHQUFHLENBQUMsQ0FBb0IsSUFBQSxLQUFBLHNCQUF3QixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQSxJQUFBO29CQUFuRCxJQUFJLEtBQUssa0NBQUEsQ0FBQTs7d0JBQ2xCLEdBQUcsQ0FBQyxDQUFvQixJQUFBLEtBQUEsc0JBQXdCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBLElBQUE7NEJBQTVELElBQUksS0FBSyxrQ0FBQSxDQUFBOzRCQUNsQixNQUFNLEtBQUssQ0FBQzt5QkFDYjs7Ozs7Ozs7O2lCQUNGOzs7Ozs7Ozs7O1FBQ0gsQ0FBQztLQUFBO0NBQ0Y7QUFFRDs7Ozs7Ozs7R0FRRztBQUNILE1BQU0sdUJBQ0YsTUFBeUUsRUFDekUsUUFBK0YsRUFDL0YsT0FBYTtJQUNmLE1BQU0sQ0FBQyxJQUFJLG9CQUFvQixDQUFtQixNQUFNLEVBQUUsWUFBWSxDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoRyxDQUFDIiwiZmlsZSI6Iml0ZXJhYmxlL2ZsYXRtYXBhc3luYy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jSXRlcmFibGVYIH0gZnJvbSAnLi4vYXN5bmNpdGVyYWJsZSc7XG5pbXBvcnQgeyBiaW5kQ2FsbGJhY2sgfSBmcm9tICcuLi9pbnRlcm5hbC9iaW5kY2FsbGJhY2snO1xuXG5jbGFzcyBGbGF0TWFwQXN5bmNJdGVyYWJsZTxUU291cmNlLCBUUmVzdWx0PiBleHRlbmRzIEFzeW5jSXRlcmFibGVYPFRSZXN1bHQ+IHtcbiAgcHJpdmF0ZSBfc291cmNlOiBJdGVyYWJsZTxUU291cmNlIHwgUHJvbWlzZUxpa2U8VFNvdXJjZT4+IHwgQXN5bmNJdGVyYWJsZTxUU291cmNlPjtcbiAgcHJpdmF0ZSBfc2VsZWN0b3I6ICh2YWx1ZTogVFNvdXJjZSkgPT4gSXRlcmFibGU8VFJlc3VsdCB8IFByb21pc2VMaWtlPFRSZXN1bHQ+PiB8IEFzeW5jSXRlcmFibGU8VFJlc3VsdD47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgc291cmNlOiBJdGVyYWJsZTxUU291cmNlIHwgUHJvbWlzZUxpa2U8VFNvdXJjZT4+IHwgQXN5bmNJdGVyYWJsZTxUU291cmNlPixcbiAgICBzZWxlY3RvcjogKHZhbHVlOiBUU291cmNlKSA9PiBJdGVyYWJsZTxUUmVzdWx0IHwgUHJvbWlzZUxpa2U8VFJlc3VsdD4+IHwgQXN5bmNJdGVyYWJsZTxUUmVzdWx0Pikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fc291cmNlID0gc291cmNlO1xuICAgIHRoaXMuX3NlbGVjdG9yID0gc2VsZWN0b3I7XG4gIH1cblxuICBhc3luYyAqW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICBmb3IgYXdhaXQgKGxldCBvdXRlciBvZiA8QXN5bmNJdGVyYWJsZTxUU291cmNlPj4odGhpcy5fc291cmNlKSkge1xuICAgICAgZm9yIGF3YWl0IChsZXQgaW5uZXIgb2YgPEFzeW5jSXRlcmFibGU8VFJlc3VsdD4+KHRoaXMuX3NlbGVjdG9yKG91dGVyKSkpIHtcbiAgICAgICAgeWllbGQgaW5uZXI7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogUHJvamVjdHMgZWFjaCBlbGVtZW50IG9mIGEgc2VxdWVuY2UgdG8gYSBwb3RlbnRpYWxseSBhc3luYyBpdGVyYWJsZSBhbmQgZmxhdHRlbnMgdGhlXG4gKiByZXN1bHRpbmcgc2VxdWVuY2VzIGludG8gb25lIHNlcXVlbmNlLlxuICogQHBhcmFtIHtJdGVyYWJsZTxUIHwgUHJvbWlzZTxUPj4gfCBBc3luY0l0ZXJhYmxlPFQ+fSBzb3VyY2UgU291cmNlIHNlcXVlbmNlXG4gKiBAcGFyYW0ge2Z1bmN0aW9uOih2YWx1ZTogVCk6IEl0ZXJhYmxlPFIgfCBQcm9taXNlPFI+PiB8IEFzeW5jSXRlcmFibGU8Uj59IHNlbGVjdG9yIEEgdHJhbnNmb3JtIGZ1bmN0aW9uIHRvIGFwcGx5IHRvIGVhY2ggZWxlbWVudC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbdGhpc0FyZ10gQW4gb3B0aW9uYWwgXCJ0aGlzXCIgYmluZGluZyBmb3IgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uLlxuICogQHJldHVybnMge0FzeW5jSXRlcmFibGU8Uj59IEFuIGFzeW5jIGl0ZXJhYmxlIHdob3NlIGVsZW1lbnRzIGFyZSB0aGUgcmVzdWx0IG9mIGludm9raW5nIHRoZSBvbmUtdG8tbWFueVxuICogdHJhbnNmb3JtIGZ1bmN0aW9uIG9uIGVhY2ggZWxlbWVudCBvZiB0aGUgaW5wdXQgc2VxdWVuY2UuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmbGF0TWFwQXN5bmM8VFNvdXJjZSwgVFJlc3VsdD4oXG4gICAgc291cmNlOiBJdGVyYWJsZTxUU291cmNlIHwgUHJvbWlzZUxpa2U8VFNvdXJjZT4+IHwgQXN5bmNJdGVyYWJsZTxUU291cmNlPixcbiAgICBzZWxlY3RvcjogKHZhbHVlOiBUU291cmNlKSA9PiBJdGVyYWJsZTxUUmVzdWx0IHwgUHJvbWlzZUxpa2U8VFJlc3VsdD4+IHwgQXN5bmNJdGVyYWJsZTxUUmVzdWx0PixcbiAgICB0aGlzQXJnPzogYW55KTogQXN5bmNJdGVyYWJsZVg8VFJlc3VsdD4ge1xuICByZXR1cm4gbmV3IEZsYXRNYXBBc3luY0l0ZXJhYmxlPFRTb3VyY2UsIFRSZXN1bHQ+KHNvdXJjZSwgYmluZENhbGxiYWNrKHNlbGVjdG9yLCB0aGlzQXJnLCAxKSk7XG59XG4iXX0=
