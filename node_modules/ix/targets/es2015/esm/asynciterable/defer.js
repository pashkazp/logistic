import * as tslib_1 from "tslib";
import { AsyncIterableX } from '../asynciterable';
class DeferAsyncIterable extends AsyncIterableX {
    constructor(fn) {
        super();
        this._fn = fn;
    }
    [Symbol.asyncIterator]() {
        return tslib_1.__asyncGenerator(this, arguments, function* _a() {
            let items = yield tslib_1.__await(this._fn());
            try {
                for (var items_1 = tslib_1.__asyncValues(items), items_1_1; items_1_1 = yield tslib_1.__await(items_1.next()), !items_1_1.done;) {
                    let item = yield tslib_1.__await(items_1_1.value);
                    yield item;
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (items_1_1 && !items_1_1.done && (_a = items_1.return)) yield tslib_1.__await(_a.call(items_1));
                }
                finally { if (e_1) throw e_1.error; }
            }
            var e_1, _a;
        });
    }
}
export function defer(factory) {
    return new DeferAsyncIterable(factory);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvZGVmZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUVsRCx3QkFBa0MsU0FBUSxjQUF1QjtJQUcvRCxZQUFZLEVBQWtFO1FBQzVFLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUM7SUFDaEIsQ0FBQztJQUVNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQzs7WUFDM0IsSUFBSSxLQUFLLEdBQUcsc0JBQU0sSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFBLENBQUM7O2dCQUM3QixHQUFHLENBQUMsQ0FBbUIsSUFBQSxVQUFBLHNCQUFBLEtBQUssQ0FBQSxXQUFBO29CQUFqQixJQUFJLElBQUkseUNBQUEsQ0FBQTtvQkFBYSxNQUFNLElBQUksQ0FBQztpQkFBRTs7Ozs7Ozs7OztRQUMvQyxDQUFDO0tBQUE7Q0FDRjtBQUVELE1BQU0sZ0JBQ0YsT0FBdUU7SUFDekUsTUFBTSxDQUFDLElBQUksa0JBQWtCLENBQVUsT0FBTyxDQUFDLENBQUM7QUFDbEQsQ0FBQyIsImZpbGUiOiJhc3luY2l0ZXJhYmxlL2RlZmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXN5bmNJdGVyYWJsZVggfSBmcm9tICcuLi9hc3luY2l0ZXJhYmxlJztcblxuY2xhc3MgRGVmZXJBc3luY0l0ZXJhYmxlPFRTb3VyY2U+IGV4dGVuZHMgQXN5bmNJdGVyYWJsZVg8VFNvdXJjZT4ge1xuICBwcml2YXRlIF9mbjogKCkgPT4gQXN5bmNJdGVyYWJsZTxUU291cmNlPiB8IFByb21pc2U8QXN5bmNJdGVyYWJsZTxUU291cmNlPj47XG5cbiAgY29uc3RydWN0b3IoZm46ICgpID0+IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4gfCBQcm9taXNlPEFzeW5jSXRlcmFibGU8VFNvdXJjZT4+KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9mbiA9IGZuO1xuICB9XG5cbiAgYXN5bmMgKltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgbGV0IGl0ZW1zID0gYXdhaXQgdGhpcy5fZm4oKTtcbiAgICBmb3IgYXdhaXQgKGxldCBpdGVtIG9mIGl0ZW1zKSB7IHlpZWxkIGl0ZW07IH1cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVmZXI8VFNvdXJjZT4oXG4gICAgZmFjdG9yeTogKCkgPT4gQXN5bmNJdGVyYWJsZTxUU291cmNlPiB8IFByb21pc2U8QXN5bmNJdGVyYWJsZTxUU291cmNlPj4pOiBBc3luY0l0ZXJhYmxlWDxUU291cmNlPiB7XG4gIHJldHVybiBuZXcgRGVmZXJBc3luY0l0ZXJhYmxlPFRTb3VyY2U+KGZhY3RvcnkpO1xufVxuIl19
