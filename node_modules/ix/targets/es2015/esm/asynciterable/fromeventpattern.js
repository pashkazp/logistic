import { AsyncSink } from '../asyncsink';
import { memoize } from './memoize';
export function fromEventPattern(addHandler, removeHandler) {
    const sink = new AsyncSink();
    const handler = (e) => sink.write(e);
    addHandler(handler);
    return memoize({
        [Symbol.asyncIterator]() {
            return {
                next() {
                    return sink.next();
                },
                return() {
                    removeHandler(handler);
                    sink.end();
                    return Promise.resolve({ done: true });
                }
            };
        }
    });
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvZnJvbWV2ZW50cGF0dGVybi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFcEMsTUFBTSwyQkFDRixVQUF1RCxFQUN2RCxhQUEwRDtJQUM1RCxNQUFNLElBQUksR0FBRyxJQUFJLFNBQVMsRUFBVyxDQUFDO0lBQ3RDLE1BQU0sT0FBTyxHQUFHLENBQUMsQ0FBVSxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFOUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRXBCLE1BQU0sQ0FBQyxPQUFPLENBQUM7UUFDYixDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUM7WUFDcEIsTUFBTSxDQUFDO2dCQUNMLElBQUk7b0JBQ0YsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDckIsQ0FBQztnQkFFRCxNQUFNO29CQUNKLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFDdkIsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUNYLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBNkIsQ0FBQyxDQUFDO2dCQUNwRSxDQUFDO2FBQ0YsQ0FBQztRQUNKLENBQUM7S0FDRixDQUFDLENBQUM7QUFDTCxDQUFDIiwiZmlsZSI6ImFzeW5jaXRlcmFibGUvZnJvbWV2ZW50cGF0dGVybi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jU2luayB9IGZyb20gJy4uL2FzeW5jc2luayc7XG5pbXBvcnQgeyBtZW1vaXplIH0gZnJvbSAnLi9tZW1vaXplJztcblxuZXhwb3J0IGZ1bmN0aW9uIGZyb21FdmVudFBhdHRlcm48VFNvdXJjZT4oXG4gICAgYWRkSGFuZGxlcjogKGhhbmRsZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCkgPT4gdm9pZCxcbiAgICByZW1vdmVIYW5kbGVyOiAoaGFuZGxlcjogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkKSA9PiB2b2lkKTogQXN5bmNJdGVyYWJsZTxUU291cmNlPiB7XG4gIGNvbnN0IHNpbmsgPSBuZXcgQXN5bmNTaW5rPFRTb3VyY2U+KCk7XG4gIGNvbnN0IGhhbmRsZXIgPSAoZTogVFNvdXJjZSkgPT4gc2luay53cml0ZShlKTtcblxuICBhZGRIYW5kbGVyKGhhbmRsZXIpO1xuXG4gIHJldHVybiBtZW1vaXplKHtcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmV4dCgpIHtcbiAgICAgICAgICByZXR1cm4gc2luay5uZXh0KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmV0dXJuKCkge1xuICAgICAgICAgIHJlbW92ZUhhbmRsZXIoaGFuZGxlcik7XG4gICAgICAgICAgc2luay5lbmQoKTtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgZG9uZTogdHJ1ZSB9IGFzIEl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH0pO1xufVxuIl19
