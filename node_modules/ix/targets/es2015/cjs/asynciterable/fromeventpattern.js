Object.defineProperty(exports, "__esModule", { value: true });
const asyncsink_1 = require("../asyncsink");
const memoize_1 = require("./memoize");
function fromEventPattern(addHandler, removeHandler) {
    const sink = new asyncsink_1.AsyncSink();
    const handler = (e) => sink.write(e);
    addHandler(handler);
    return memoize_1.memoize({
        [Symbol.asyncIterator]() {
            return {
                next() {
                    return sink.next();
                },
                return() {
                    removeHandler(handler);
                    sink.end();
                    return Promise.resolve({ done: true });
                }
            };
        }
    });
}
exports.fromEventPattern = fromEventPattern;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvZnJvbWV2ZW50cGF0dGVybi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsNENBQXlDO0FBQ3pDLHVDQUFvQztBQUVwQywwQkFDSSxVQUF1RCxFQUN2RCxhQUEwRDtJQUM1RCxNQUFNLElBQUksR0FBRyxJQUFJLHFCQUFTLEVBQVcsQ0FBQztJQUN0QyxNQUFNLE9BQU8sR0FBRyxDQUFDLENBQVUsS0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTlDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUVwQixNQUFNLENBQUMsaUJBQU8sQ0FBQztRQUNiLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQztZQUNwQixNQUFNLENBQUM7Z0JBQ0wsSUFBSTtvQkFDRixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNyQixDQUFDO2dCQUVELE1BQU07b0JBQ0osYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUN2QixJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7b0JBQ1gsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUE2QixDQUFDLENBQUM7Z0JBQ3BFLENBQUM7YUFDRixDQUFDO1FBQ0osQ0FBQztLQUNGLENBQUMsQ0FBQztBQUNMLENBQUM7QUF2QkQsNENBdUJDIiwiZmlsZSI6ImFzeW5jaXRlcmFibGUvZnJvbWV2ZW50cGF0dGVybi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jU2luayB9IGZyb20gJy4uL2FzeW5jc2luayc7XG5pbXBvcnQgeyBtZW1vaXplIH0gZnJvbSAnLi9tZW1vaXplJztcblxuZXhwb3J0IGZ1bmN0aW9uIGZyb21FdmVudFBhdHRlcm48VFNvdXJjZT4oXG4gICAgYWRkSGFuZGxlcjogKGhhbmRsZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCkgPT4gdm9pZCxcbiAgICByZW1vdmVIYW5kbGVyOiAoaGFuZGxlcjogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkKSA9PiB2b2lkKTogQXN5bmNJdGVyYWJsZTxUU291cmNlPiB7XG4gIGNvbnN0IHNpbmsgPSBuZXcgQXN5bmNTaW5rPFRTb3VyY2U+KCk7XG4gIGNvbnN0IGhhbmRsZXIgPSAoZTogVFNvdXJjZSkgPT4gc2luay53cml0ZShlKTtcblxuICBhZGRIYW5kbGVyKGhhbmRsZXIpO1xuXG4gIHJldHVybiBtZW1vaXplKHtcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmV4dCgpIHtcbiAgICAgICAgICByZXR1cm4gc2luay5uZXh0KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmV0dXJuKCkge1xuICAgICAgICAgIHJlbW92ZUhhbmRsZXIoaGFuZGxlcik7XG4gICAgICAgICAgc2luay5lbmQoKTtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgZG9uZTogdHJ1ZSB9IGFzIEl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH0pO1xufVxuIl19
