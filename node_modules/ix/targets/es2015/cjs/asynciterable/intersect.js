Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const asynciterable_1 = require("../asynciterable");
const arrayindexof_1 = require("../internal/arrayindexof");
const comparer_1 = require("../internal/comparer");
function arrayRemove(array, item, comparer) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        let idx = yield arrayindexof_1.arrayIndexOfAsync(array, item, comparer);
        if (idx === -1) {
            return false;
        }
        array.splice(idx, 1);
        return true;
    });
}
class IntersectAsyncIterable extends asynciterable_1.AsyncIterableX {
    constructor(first, second, comparer) {
        super();
        this._first = first;
        this._second = second;
        this._comparer = comparer;
    }
    [Symbol.asyncIterator]() {
        return tslib_1.__asyncGenerator(this, arguments, function* _a() {
            let map = [];
            try {
                for (var _a = tslib_1.__asyncValues(this._second), _b; _b = yield tslib_1.__await(_a.next()), !_b.done;) {
                    let secondItem = yield tslib_1.__await(_b.value);
                    map.push(secondItem);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_b && !_b.done && (_c = _a.return)) yield tslib_1.__await(_c.call(_a));
                }
                finally { if (e_1) throw e_1.error; }
            }
            try {
                for (var _d = tslib_1.__asyncValues(this._first), _e; _e = yield tslib_1.__await(_d.next()), !_e.done;) {
                    let firstItem = yield tslib_1.__await(_e.value);
                    if (yield tslib_1.__await(arrayRemove(map, firstItem, this._comparer))) {
                        yield firstItem;
                    }
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_e && !_e.done && (_f = _d.return)) yield tslib_1.__await(_f.call(_d));
                }
                finally { if (e_2) throw e_2.error; }
            }
            var e_1, _c, e_2, _f;
        });
    }
}
function intersect(first, second, comparer = comparer_1.comparerAsync) {
    return new IntersectAsyncIterable(first, second, comparer);
}
exports.intersect = intersect;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzeW5jaXRlcmFibGUvaW50ZXJzZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsb0RBQWtEO0FBQ2xELDJEQUE2RDtBQUM3RCxtREFBcUQ7QUFFckQscUJBQ0ksS0FBVSxFQUFFLElBQU8sRUFDbkIsUUFBb0Q7O1FBQ3RELElBQUksR0FBRyxHQUFHLE1BQU0sZ0NBQWlCLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztRQUN6RCxFQUFFLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUFDLENBQUM7UUFDakMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDckIsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7Q0FBQTtBQUVELDRCQUFzQyxTQUFRLDhCQUF1QjtJQUtuRSxZQUNFLEtBQTZCLEVBQzdCLE1BQThCLEVBQzlCLFFBQWdFO1FBQ2hFLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDcEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDdEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7SUFDNUIsQ0FBQztJQUVNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQzs7WUFDM0IsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDOztnQkFDYixHQUFHLENBQUMsQ0FBeUIsSUFBQSxLQUFBLHNCQUFBLElBQUksQ0FBQyxPQUFPLENBQUEsSUFBQTtvQkFBOUIsSUFBSSxVQUFVLGtDQUFBLENBQUE7b0JBQ3ZCLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7aUJBQ3RCOzs7Ozs7Ozs7O2dCQUVELEdBQUcsQ0FBQyxDQUF3QixJQUFBLEtBQUEsc0JBQUEsSUFBSSxDQUFDLE1BQU0sQ0FBQSxJQUFBO29CQUE1QixJQUFJLFNBQVMsa0NBQUEsQ0FBQTtvQkFDdEIsRUFBRSxDQUFDLENBQUMsc0JBQU0sV0FBVyxDQUFDLEdBQUcsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFDO3dCQUN0RCxNQUFNLFNBQVMsQ0FBQztvQkFDbEIsQ0FBQztpQkFDRjs7Ozs7Ozs7OztRQUNILENBQUM7S0FBQTtDQUNGO0FBRUQsbUJBQ0ksS0FBNkIsRUFDN0IsTUFBOEIsRUFDOUIsV0FBbUUsd0JBQWE7SUFDbEYsTUFBTSxDQUFDLElBQUksc0JBQXNCLENBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztBQUN0RSxDQUFDO0FBTEQsOEJBS0MiLCJmaWxlIjoiYXN5bmNpdGVyYWJsZS9pbnRlcnNlY3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBc3luY0l0ZXJhYmxlWCB9IGZyb20gJy4uL2FzeW5jaXRlcmFibGUnO1xuaW1wb3J0IHsgYXJyYXlJbmRleE9mQXN5bmMgfSBmcm9tICcuLi9pbnRlcm5hbC9hcnJheWluZGV4b2YnO1xuaW1wb3J0IHsgY29tcGFyZXJBc3luYyB9IGZyb20gJy4uL2ludGVybmFsL2NvbXBhcmVyJztcblxuYXN5bmMgZnVuY3Rpb24gYXJyYXlSZW1vdmU8VD4oXG4gICAgYXJyYXk6IFRbXSwgaXRlbTogVCxcbiAgICBjb21wYXJlcjogKHg6IFQsIHk6IFQpID0+IGJvb2xlYW4gfCBQcm9taXNlPGJvb2xlYW4+KTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGxldCBpZHggPSBhd2FpdCBhcnJheUluZGV4T2ZBc3luYyhhcnJheSwgaXRlbSwgY29tcGFyZXIpO1xuICBpZiAoaWR4ID09PSAtMSkgeyByZXR1cm4gZmFsc2U7IH1cbiAgYXJyYXkuc3BsaWNlKGlkeCwgMSk7XG4gIHJldHVybiB0cnVlO1xufVxuXG5jbGFzcyBJbnRlcnNlY3RBc3luY0l0ZXJhYmxlPFRTb3VyY2U+IGV4dGVuZHMgQXN5bmNJdGVyYWJsZVg8VFNvdXJjZT4ge1xuICBwcml2YXRlIF9maXJzdDogQXN5bmNJdGVyYWJsZTxUU291cmNlPjtcbiAgcHJpdmF0ZSBfc2Vjb25kOiBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+O1xuICBwcml2YXRlIF9jb21wYXJlcjogKHg6IFRTb3VyY2UsIHk6IFRTb3VyY2UpID0+IGJvb2xlYW4gfCBQcm9taXNlPGJvb2xlYW4+O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGZpcnN0OiBBc3luY0l0ZXJhYmxlPFRTb3VyY2U+LFxuICAgIHNlY29uZDogQXN5bmNJdGVyYWJsZTxUU291cmNlPixcbiAgICBjb21wYXJlcjogKHg6IFRTb3VyY2UsIHk6IFRTb3VyY2UpID0+IGJvb2xlYW4gfCBQcm9taXNlPGJvb2xlYW4+KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9maXJzdCA9IGZpcnN0O1xuICAgIHRoaXMuX3NlY29uZCA9IHNlY29uZDtcbiAgICB0aGlzLl9jb21wYXJlciA9IGNvbXBhcmVyO1xuICB9XG5cbiAgYXN5bmMgKltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgbGV0IG1hcCA9IFtdO1xuICAgIGZvciBhd2FpdCAobGV0IHNlY29uZEl0ZW0gb2YgdGhpcy5fc2Vjb25kKSB7XG4gICAgICBtYXAucHVzaChzZWNvbmRJdGVtKTtcbiAgICB9XG5cbiAgICBmb3IgYXdhaXQgKGxldCBmaXJzdEl0ZW0gb2YgdGhpcy5fZmlyc3QpIHtcbiAgICAgIGlmIChhd2FpdCBhcnJheVJlbW92ZShtYXAsIGZpcnN0SXRlbSwgdGhpcy5fY29tcGFyZXIpKSB7XG4gICAgICAgIHlpZWxkIGZpcnN0SXRlbTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGludGVyc2VjdDxUU291cmNlPihcbiAgICBmaXJzdDogQXN5bmNJdGVyYWJsZTxUU291cmNlPixcbiAgICBzZWNvbmQ6IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgY29tcGFyZXI6ICh4OiBUU291cmNlLCB5OiBUU291cmNlKSA9PiBib29sZWFuIHwgUHJvbWlzZTxib29sZWFuPiA9IGNvbXBhcmVyQXN5bmMpOiBBc3luY0l0ZXJhYmxlWDxUU291cmNlPiB7XG4gIHJldHVybiBuZXcgSW50ZXJzZWN0QXN5bmNJdGVyYWJsZTxUU291cmNlPihmaXJzdCwgc2Vjb25kLCBjb21wYXJlcik7XG59XG4iXX0=
