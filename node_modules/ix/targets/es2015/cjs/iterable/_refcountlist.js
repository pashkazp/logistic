Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @ignore
 */
class MaxRefCountList {
    constructor() {
        this._list = [];
    }
    clear() { this._list = []; }
    get count() { return this._list.length; }
    get(index) { return this._list[index]; }
    push(value) { this._list.push(value); }
    // tslint:disable-next-line:no-empty
    done() { }
}
exports.MaxRefCountList = MaxRefCountList;
/**
 * @ignore
 */
class RefCountList {
    constructor(readerCount) {
        this._count = 0;
        this._readerCount = readerCount;
        this._list = new Map();
    }
    clear() { this._list.clear(); }
    get count() { return this._count; }
    get readerCount() { return this._readerCount; }
    set readerCount(value) { this._readerCount = value; }
    done() { this._readerCount--; }
    get(index) {
        if (!this._list.has(index)) {
            throw new Error('Element no longer available in the buffer.');
        }
        const res = this._list.get(index);
        const val = res.value;
        if (--res.count === 0) {
            this._list.delete(index);
        }
        return val;
    }
    push(value) {
        this._list.set(this._count++, { value: value, count: this._readerCount });
    }
}
exports.RefCountList = RefCountList;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIml0ZXJhYmxlL19yZWZjb3VudGxpc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQW1CQTs7R0FFRztBQUNIO0lBQUE7UUFDVSxVQUFLLEdBQVEsRUFBRSxDQUFDO0lBUzFCLENBQUM7SUFQQyxLQUFLLEtBQUssSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzVCLElBQUksS0FBSyxLQUFLLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDekMsR0FBRyxDQUFDLEtBQWEsSUFBTyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbkQsSUFBSSxDQUFDLEtBQVEsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFMUMsb0NBQW9DO0lBQ3BDLElBQUksS0FBSyxDQUFDO0NBQ1g7QUFWRCwwQ0FVQztBQUVEOztHQUVHO0FBQ0g7SUFLRSxZQUFZLFdBQW1CO1FBRnZCLFdBQU0sR0FBVyxDQUFDLENBQUM7UUFHekIsSUFBSSxDQUFDLFlBQVksR0FBRyxXQUFXLENBQUM7UUFDaEMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLEdBQUcsRUFBdUIsQ0FBQztJQUM5QyxDQUFDO0lBRUQsS0FBSyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQy9CLElBQUksS0FBSyxLQUFLLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNuQyxJQUFJLFdBQVcsS0FBSyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7SUFDL0MsSUFBSSxXQUFXLENBQUMsS0FBYSxJQUFJLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUM3RCxJQUFJLEtBQUssSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUMsQ0FBQztJQUUvQixHQUFHLENBQUMsS0FBYTtRQUNmLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNCLE1BQU0sSUFBSSxLQUFLLENBQUMsNENBQTRDLENBQUMsQ0FBQztRQUNoRSxDQUFDO1FBQ0QsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFFLENBQUM7UUFDbkMsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztRQUN0QixFQUFFLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQixDQUFDO1FBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFFRCxJQUFJLENBQUMsS0FBUTtRQUNYLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDO0lBQzVFLENBQUM7Q0FDRjtBQS9CRCxvQ0ErQkMiLCJmaWxlIjoiaXRlcmFibGUvX3JlZmNvdW50bGlzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlZkNvdW50PFQ+IHtcbiAgdmFsdWU6IFQ7XG4gIGNvdW50OiBudW1iZXI7XG59XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIElSZWZDb3VudExpc3Q8VD4ge1xuICBjbGVhcigpOiB2b2lkO1xuICByZWFkb25seSBjb3VudDogbnVtYmVyO1xuICBnZXQoaW5kZXg6IG51bWJlcik6IFQ7XG4gIHB1c2godmFsdWU6IFQpOiB2b2lkO1xuICBkb25lKCk6IHZvaWQ7XG59XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgY2xhc3MgTWF4UmVmQ291bnRMaXN0PFQ+IGltcGxlbWVudHMgSVJlZkNvdW50TGlzdDxUPiB7XG4gIHByaXZhdGUgX2xpc3Q6IFRbXSA9IFtdO1xuXG4gIGNsZWFyKCkgeyB0aGlzLl9saXN0ID0gW107IH1cbiAgZ2V0IGNvdW50KCkgeyByZXR1cm4gdGhpcy5fbGlzdC5sZW5ndGg7IH1cbiAgZ2V0KGluZGV4OiBudW1iZXIpOiBUIHsgcmV0dXJuIHRoaXMuX2xpc3RbaW5kZXhdOyB9XG4gIHB1c2godmFsdWU6IFQpIHsgdGhpcy5fbGlzdC5wdXNoKHZhbHVlKTsgfVxuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1lbXB0eVxuICBkb25lKCkgeyB9XG59XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgY2xhc3MgUmVmQ291bnRMaXN0PFQ+IGltcGxlbWVudHMgSVJlZkNvdW50TGlzdDxUPiB7XG4gIHByaXZhdGUgX3JlYWRlckNvdW50OiBudW1iZXI7XG4gIHByaXZhdGUgX2xpc3Q6IE1hcDxudW1iZXIsIFJlZkNvdW50PFQ+PjtcbiAgcHJpdmF0ZSBfY291bnQ6IG51bWJlciA9IDA7XG5cbiAgY29uc3RydWN0b3IocmVhZGVyQ291bnQ6IG51bWJlcikge1xuICAgIHRoaXMuX3JlYWRlckNvdW50ID0gcmVhZGVyQ291bnQ7XG4gICAgdGhpcy5fbGlzdCA9IG5ldyBNYXA8bnVtYmVyLCBSZWZDb3VudDxUPj4oKTtcbiAgfVxuXG4gIGNsZWFyKCkgeyB0aGlzLl9saXN0LmNsZWFyKCk7IH1cbiAgZ2V0IGNvdW50KCkgeyByZXR1cm4gdGhpcy5fY291bnQ7IH1cbiAgZ2V0IHJlYWRlckNvdW50KCkgeyByZXR1cm4gdGhpcy5fcmVhZGVyQ291bnQ7IH1cbiAgc2V0IHJlYWRlckNvdW50KHZhbHVlOiBudW1iZXIpIHsgdGhpcy5fcmVhZGVyQ291bnQgPSB2YWx1ZTsgfVxuICBkb25lKCkgeyB0aGlzLl9yZWFkZXJDb3VudC0tOyB9XG5cbiAgZ2V0KGluZGV4OiBudW1iZXIpOiBUIHtcbiAgICBpZiAoIXRoaXMuX2xpc3QuaGFzKGluZGV4KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbGVtZW50IG5vIGxvbmdlciBhdmFpbGFibGUgaW4gdGhlIGJ1ZmZlci4nKTtcbiAgICB9XG4gICAgY29uc3QgcmVzID0gdGhpcy5fbGlzdC5nZXQoaW5kZXgpITtcbiAgICBjb25zdCB2YWwgPSByZXMudmFsdWU7XG4gICAgaWYgKC0tcmVzLmNvdW50ID09PSAwKSB7XG4gICAgICB0aGlzLl9saXN0LmRlbGV0ZShpbmRleCk7XG4gICAgfVxuICAgIHJldHVybiB2YWw7XG4gIH1cblxuICBwdXNoKHZhbHVlOiBUKSB7XG4gICAgdGhpcy5fbGlzdC5zZXQodGhpcy5fY291bnQrKywgeyB2YWx1ZTogdmFsdWUsIGNvdW50OiB0aGlzLl9yZWFkZXJDb3VudCB9KTtcbiAgfVxufVxuIl19
