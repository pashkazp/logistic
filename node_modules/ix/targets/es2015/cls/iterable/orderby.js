goog.module('targets.es2015.cls.iterable.orderby'); exports = {}; var module = {id: 'targets/es2015/cls/iterable/orderby.js'};/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

var iterable_1 = goog.require('targets.es2015.cls.iterable');
const tsickle_forward_declare_1 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.iterable");
var sorter_1 = goog.require('targets.es2015.cls.internal.sorter');
const tsickle_forward_declare_2 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.internal.sorter");
/**
 * @abstract
 * @template TSource
 */
class OrderedIterableBaseX extends iterable_1.IterableX {
    /**
     * @param {!Iterable<TSource>} source
     */
    constructor(source) {
        super();
        this._source = source;
    }
    /**
     * @return {!IterableIterator<TSource>}
     */
    *[Symbol.iterator]() {
        const /** @type {!Array<TSource>} */ array = Array.from(this._source);
        const /** @type {number} */ len = array.length;
        const /** @type {!Array<number>} */ indices = new Array(len);
        for (let /** @type {number} */ i = 0, /** @type {number} */ len = array.length; i < len; i++) {
            indices[i] = i;
        }
        indices.sort(this._getSorter(array));
        for (const /** @type {number} */ index of indices) {
            yield array[index];
        }
    }
    /**
     * @template TKey
     * @param {function(TSource): TKey} keySelector
     * @param {function(TKey, TKey): number=} comparer
     * @return {!OrderedIterableBaseX}
     */
    thenBy(keySelector, comparer = sorter_1.sorter) {
        /* tslint:disable-next-line: no-use-before-declare */
        return new OrderedIterableX(this._source, keySelector, comparer, false, this);
    }
    /**
     * @template TKey
     * @param {function(TSource): TKey} keySelector
     * @param {function(TKey, TKey): number=} comparer
     * @return {!OrderedIterableBaseX}
     */
    thenByDescending(keySelector, comparer = sorter_1.sorter) {
        /* tslint:disable-next-line: no-use-before-declare */
        return new OrderedIterableX(this._source, keySelector, comparer, true, this);
    }
}
exports.OrderedIterableBaseX = OrderedIterableBaseX;
function OrderedIterableBaseX_tsickle_Closure_declarations() {
    /** @type {!Iterable<TSource>} */
    OrderedIterableBaseX.prototype._source;
    /**
     * @abstract
     * @param {!Array<TSource>} elements
     * @param {function(number, number): number=} next
     * @return {function(number, number): number}
     */
    OrderedIterableBaseX.prototype._getSorter = function (elements, next) { };
}
/**
 * @template TKey, TSource
 */
class OrderedIterableX extends OrderedIterableBaseX {
    /**
     * @param {!Iterable<TSource>} source
     * @param {function(TSource): TKey} keySelector
     * @param {function(TKey, TKey): number} comparer
     * @param {boolean} descending
     * @param {!OrderedIterableBaseX<TSource>=} parent
     */
    constructor(source, keySelector, comparer, descending, parent) {
        super(source);
        this._keySelector = keySelector;
        this._comparer = comparer;
        this._descending = descending;
        this._parent = parent;
    }
    /**
     * @param {!Array<TSource>} elements
     * @param {function(number, number): number=} next
     * @return {function(number, number): number}
     */
    _getSorter(elements, next) {
        const /** @type {!Array<TKey>} */ keys = elements.map(this._keySelector);
        const /** @type {function(TKey, TKey): number} */ comparer = this._comparer;
        const /** @type {!OrderedIterableBaseX<TSource>} */ parent = this._parent;
        const /** @type {boolean} */ descending = this._descending;
        const /** @type {function(number, number): number} */ sorter = (x, y) => {
            const /** @type {number} */ result = comparer(keys[x], keys[y]);
            if (result === 0) {
                return next ? next(x, y) : x - y;
            }
            return descending ? -result : result;
        };
        return parent ? parent._getSorter(elements, sorter) : sorter;
    }
}
exports.OrderedIterableX = OrderedIterableX;
function OrderedIterableX_tsickle_Closure_declarations() {
    /** @type {function(TSource): TKey} */
    OrderedIterableX.prototype._keySelector;
    /** @type {function(TKey, TKey): number} */
    OrderedIterableX.prototype._comparer;
    /** @type {boolean} */
    OrderedIterableX.prototype._descending;
    /** @type {!OrderedIterableBaseX<TSource>} */
    OrderedIterableX.prototype._parent;
}
/**
 * @template TKey, TSource
 * @param {!Iterable<TSource>} source
 * @param {function(TSource): TKey} keySelector
 * @param {function(TKey, TKey): number=} comparer
 * @return {!OrderedIterableX<TKey, TSource>}
 */
function orderBy(source, keySelector, comparer = sorter_1.sorter) {
    return new OrderedIterableX(source, keySelector, comparer, false);
}
exports.orderBy = orderBy;
/**
 * @template TKey, TSource
 * @param {!Iterable<TSource>} source
 * @param {function(TSource): TKey} keySelector
 * @param {function(TKey, TKey): number=} comparer
 * @return {!OrderedIterableX<TKey, TSource>}
 */
function orderByDescending(source, keySelector, comparer = sorter_1.sorter) {
    return new OrderedIterableX(source, keySelector, comparer, true);
}
exports.orderByDescending = orderByDescending;
/**
 * @template TKey, TSource
 * @param {!OrderedIterableBaseX<TSource>} source
 * @param {function(TSource): TKey} keySelector
 * @param {function(TKey, TKey): number=} comparer
 * @return {!OrderedIterableX<TKey, TSource>}
 */
function thenBy(source, keySelector, comparer = sorter_1.sorter) {
    return new OrderedIterableX(source._source, keySelector, comparer, false, source);
}
exports.thenBy = thenBy;
/**
 * @template TKey, TSource
 * @param {!OrderedIterableBaseX<TSource>} source
 * @param {function(TSource): TKey} keySelector
 * @param {function(TKey, TKey): number=} comparer
 * @return {!OrderedIterableX<TKey, TSource>}
 */
function thenByDescending(source, keySelector, comparer = sorter_1.sorter) {
    return new OrderedIterableX(source._source, keySelector, comparer, true, source);
}
exports.thenByDescending = thenByDescending;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9pdGVyYWJsZS9vcmRlcmJ5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRzs7QUFFSCwwQ0FMa0I7QUFNbEIsTUFBTSx5QkFBeUIsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLHNDQUFzQyxDQUFDLENBTnJEO0FBT3hDLCtDQU5nQztBQU9oQyxNQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsNkNBQTZDLENBQUMsQ0FBQztBQUNyRzs7O0dBR0c7QUFUSCwwQkFBbUQsU0FBUSxvQkFBbUI7SUFZOUU7O09BRUc7SUFYRCxZQUFZLE1BQXlCO1FBYW5DLEtBWkssRUFBRSxDQUFDO1FBYVIsSUFaSSxDQUFDLE9BQU8sR0FBRSxNQUFPLENBQUM7SUFheEIsQ0FBQztJQUNIOztPQUVHO0lBYkQsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFlaEIsTUFBTSw4QkFkRCxDQUFBLEtBQU0sR0FBRSxLQUFNLENBQUMsSUFBSSxDQUFVLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQWVoRCxNQUFNLHFCQWRELENBQUEsR0FBSSxHQUFFLEtBQU0sQ0FBQyxNQUFNLENBQUM7UUFlekIsTUFBTSw2QkFkRCxDQUFBLE9BQVEsR0FBRSxJQUFJLEtBQU0sQ0FBUyxHQUFHLENBQUMsQ0FBQztRQWV2QyxHQUFHLENBQUMsQ0FkQyxJQUFBLHFCQUFHLENBQUEsQ0FBRSxHQUFFLENBQUUsRUFBQSxxQkFBQyxDQUFBLEdBQUksR0FBRSxLQUFNLENBQUMsTUFBTSxFQUFDLENBQUUsR0FBRSxHQUFJLEVBQUMsQ0FBRSxFQUFFLEVBQUMsQ0FBRTtZQWVqRCxPQWRPLENBQUMsQ0FBQyxDQUFDLEdBQUUsQ0FBRSxDQUFDO1FBZWpCLENBZEM7UUFnQkQsT0FkTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFlckMsR0FBRyxDQUFDLENBZEMsTUFBQSxxQkFB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Im9yZGVyYnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IGFkZGVkIGJ5IHRzaWNrbGVcbiAqIEBzdXBwcmVzcyB7Y2hlY2tUeXBlc30gY2hlY2tlZCBieSB0c2NcbiAqL1xuXG5pbXBvcnQgeyBJdGVyYWJsZVggfSBmcm9tICcuLi9pdGVyYWJsZSc7XG5jb25zdCB0c2lja2xlX2ZvcndhcmRfZGVjbGFyZV8xID0gZ29vZy5mb3J3YXJkRGVjbGFyZShcIl9Vc2Vycy5wdGF5bG9yLmRldi5peGpzLnNyYy5pdGVyYWJsZVwiKTtcbmltcG9ydCB7IHNvcnRlciBhcyBkZWZhdWx0U29ydGVyIH0gZnJvbSAnLi4vaW50ZXJuYWwvc29ydGVyJztcbmNvbnN0IHRzaWNrbGVfZm9yd2FyZF9kZWNsYXJlXzIgPSBnb29nLmZvcndhcmREZWNsYXJlKFwiX1VzZXJzLnB0YXlsb3IuZGV2Lml4anMuc3JjLmludGVybmFsLnNvcnRlclwiKTtcbi8qKlxuICogQGFic3RyYWN0XG4gKiBAdGVtcGxhdGUgVFNvdXJjZVxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgT3JkZXJlZEl0ZXJhYmxlQmFzZVg8VFNvdXJjZT4gZXh0ZW5kcyBJdGVyYWJsZVg8VFNvdXJjZT4ge1xuICBfc291cmNlOiBJdGVyYWJsZTxUU291cmNlPjtcbi8qKlxuICogQHBhcmFtIHshSXRlcmFibGU8VFNvdXJjZT59IHNvdXJjZVxuICovXG5jb25zdHJ1Y3Rvcihzb3VyY2U6IEl0ZXJhYmxlPFRTb3VyY2U+KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9zb3VyY2UgPSBzb3VyY2U7XG4gIH1cbi8qKlxuICogQHJldHVybiB7IUl0ZXJhYmxlSXRlcmF0b3I8VFNvdXJjZT59XG4gKi9cbipbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICBjb25zdCAvKiogQHR5cGUgeyFBcnJheTxUU291cmNlPn0gKi8gYXJyYXkgPSBBcnJheS5mcm9tPFRTb3VyY2U+KHRoaXMuX3NvdXJjZSk7XG4gICAgY29uc3QgLyoqIEB0eXBlIHtudW1iZXJ9ICovIGxlbiA9IGFycmF5Lmxlbmd0aDtcbiAgICBjb25zdCAvKiogQHR5cGUgeyFBcnJheTxudW1iZXI+fSAqLyBpbmRpY2VzID0gbmV3IEFycmF5PG51bWJlcj4obGVuKTtcbiAgICBmb3IgKGxldCAvKiogQHR5cGUge251bWJlcn0gKi8gaSA9IDAsIC8qKiBAdHlwZSB7bnVtYmVyfSAqLyBsZW4gPSBhcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgaW5kaWNlc1tpXSA9IGk7XG4gICAgfVxuXG4gICAgaW5kaWNlcy5zb3J0KHRoaXMuX2dldFNvcnRlcihhcnJheSkpO1xuICAgIGZvciAoY29uc3QgLyoqIEB0eXBlIHtudW1iZXJ9ICovIGluZGV4IG9mIGluZGljZXMpIHtcbiAgICAgIHlpZWxkIGFycmF5W2luZGV4XTtcbiAgICB9XG4gIH1cbi8qKlxuICogQHRlbXBsYXRlIFRLZXlcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oVFNvdXJjZSk6IFRLZXl9IGtleVNlbGVjdG9yXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFRLZXksIFRLZXkpOiBudW1iZXI9fSBjb21wYXJlclxuICogQHJldHVybiB7IU9yZGVyZWRJdGVyYWJsZUJhc2VYfVxuICovXG50aGVuQnk8VEtleT4oXG4gICAgICBrZXlTZWxlY3RvcjogKGl0ZW06IFRTb3VyY2UpID0+IFRLZXksXG4gICAgICBjb21wYXJlcjogKGZzdDogVEtleSwgc25kOiBUS2V5KSA9PiBudW1iZXIgPSBkZWZhdWx0U29ydGVyKTogT3JkZXJlZEl0ZXJhYmxlQmFzZVg8VFNvdXJjZT4ge1xuICAgIC8qIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tdXNlLWJlZm9yZS1kZWNsYXJlICovXG4gICAgcmV0dXJuIG5ldyBPcmRlcmVkSXRlcmFibGVYPFRLZXksIFRTb3VyY2U+KHRoaXMuX3NvdXJjZSwga2V5U2VsZWN0b3IsIGNvbXBhcmVyLCBmYWxzZSwgdGhpcyk7XG4gIH1cbi8qKlxuICogQHRlbXBsYXRlIFRLZXlcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oVFNvdXJjZSk6IFRLZXl9IGtleVNlbGVjdG9yXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFRLZXksIFRLZXkpOiBudW1iZXI9fSBjb21wYXJlclxuICogQHJldHVybiB7IU9yZGVyZWRJdGVyYWJsZUJhc2VYfVxuICovXG50aGVuQnlEZXNjZW5kaW5nPFRLZXk+KFxuICAgICAga2V5U2VsZWN0b3I6IChpdGVtOiBUU291cmNlKSA9PiBUS2V5LFxuICAgICAgY29tcGFyZXI6IChmc3Q6IFRLZXksIHNuZDogVEtleSkgPT4gbnVtYmVyID0gZGVmYXVsdFNvcnRlcik6IE9yZGVyZWRJdGVyYWJsZUJhc2VYPFRTb3VyY2U+IHtcbiAgICAvKiB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLXVzZS1iZWZvcmUtZGVjbGFyZSAqL1xuICAgIHJldHVybiBuZXcgT3JkZXJlZEl0ZXJhYmxlWDxUS2V5LCBUU291cmNlPih0aGlzLl9zb3VyY2UsIGtleVNlbGVjdG9yLCBjb21wYXJlciwgdHJ1ZSwgdGhpcyk7XG4gIH1cblxuICBhYnN0cmFjdCBfZ2V0U29ydGVyKFxuICAgIGVsZW1lbnRzOiBUU291cmNlW10sXG4gICAgbmV4dD86ICh4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gbnVtYmVyKTogKHg6IG51bWJlciwgeTogbnVtYmVyKSA9PiBudW1iZXI7XG59XG5cbmZ1bmN0aW9uIE9yZGVyZWRJdGVyYWJsZUJhc2VYX3RzaWNrbGVfQ2xvc3VyZV9kZWNsYXJhdGlvbnMoKSB7XG4vKiogQHR5cGUgeyFJdGVyYWJsZTxUU291cmNlPn0gKi9cbk9yZGVyZWRJdGVyYWJsZUJhc2VYLnByb3RvdHlwZS5fc291cmNlO1xuXG4vKipcbiAqIEBhYnN0cmFjdFxuICogQHBhcmFtIHshQXJyYXk8VFNvdXJjZT59IGVsZW1lbnRzXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKG51bWJlciwgbnVtYmVyKTogbnVtYmVyPX0gbmV4dFxuICogQHJldHVybiB7ZnVuY3Rpb24obnVtYmVyLCBudW1iZXIpOiBudW1iZXJ9XG4gKi9cbk9yZGVyZWRJdGVyYWJsZUJhc2VYLnByb3RvdHlwZS5fZ2V0U29ydGVyID0gZnVuY3Rpb24oZWxlbWVudHMsIG5leHQpIHt9O1xufVxuXG4vKipcbiAqIEB0ZW1wbGF0ZSBUS2V5LCBUU291cmNlXG4gKi9cbmV4cG9ydCBjbGFzcyBPcmRlcmVkSXRlcmFibGVYPFRLZXksIFRTb3VyY2U+IGV4dGVuZHMgT3JkZXJlZEl0ZXJhYmxlQmFzZVg8VFNvdXJjZT4ge1xucHJpdmF0ZSBfa2V5U2VsZWN0b3I6IChpdGVtOiBUU291cmNlKSA9PiBUS2V5O1xucHJpdmF0ZSBfY29tcGFyZXI6IChmc3Q6IFRLZXksIHNuZDogVEtleSkgPT4gbnVtYmVyO1xucHJpdmF0ZSBfZGVzY2VuZGluZzogYm9vbGVhbjtcbnByaXZhdGUgX3BhcmVudD86IE9yZGVyZWRJdGVyYWJsZUJhc2VYPFRTb3VyY2U+O1xuLyoqXG4gKiBAcGFyYW0geyFJdGVyYWJsZTxUU291cmNlPn0gc291cmNlXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFRTb3VyY2UpOiBUS2V5fSBrZXlTZWxlY3RvclxuICogQHBhcmFtIHtmdW5jdGlvbihUS2V5LCBUS2V5KTogbnVtYmVyfSBjb21wYXJlclxuICogQHBhcmFtIHtib29sZWFufSBkZXNjZW5kaW5nXG4gKiBAcGFyYW0geyFPcmRlcmVkSXRlcmFibGVCYXNlWDxUU291cmNlPj19IHBhcmVudFxuICovXG5jb25zdHJ1Y3RvcihcbiAgICAgIHNvdXJjZTogSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgICBrZXlTZWxlY3RvcjogKGl0ZW06IFRTb3VyY2UpID0+IFRLZXksXG4gICAgICBjb21wYXJlcjogKGZzdDogVEtleSwgc25kOiBUS2V5KSA9PiBudW1iZXIsXG4gICAgICBkZXNjZW5kaW5nOiBib29sZWFuLFxuICAgICAgcGFyZW50PzogT3JkZXJlZEl0ZXJhYmxlQmFzZVg8VFNvdXJjZT4pIHtcbiAgICBzdXBlcihzb3VyY2UpO1xuICAgIHRoaXMuX2tleVNlbGVjdG9yID0ga2V5U2VsZWN0b3I7XG4gICAgdGhpcy5fY29tcGFyZXIgPSBjb21wYXJlcjtcbiAgICB0aGlzLl9kZXNjZW5kaW5nID0gZGVzY2VuZGluZztcbiAgICB0aGlzLl9wYXJlbnQgPSBwYXJlbnQ7XG4gIH1cbi8qKlxuICogQHBhcmFtIHshQXJyYXk8VFNvdXJjZT59IGVsZW1lbnRzXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKG51bWJlciwgbnVtYmVyKTogbnVtYmVyPX0gbmV4dFxuICogQHJldHVybiB7ZnVuY3Rpb24obnVtYmVyLCBudW1iZXIpOiBudW1iZXJ9XG4gKi9cbl9nZXRTb3J0ZXIoXG4gICAgICBlbGVtZW50czogVFNvdXJjZVtdLFxuICAgICAgbmV4dD86ICh4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gbnVtYmVyKTogKHg6IG51bWJlciwgeTogbnVtYmVyKSA9PiBudW1iZXIge1xuICAgIGNvbnN0IC8qKiBAdHlwZSB7IUFycmF5PFRLZXk+fSAqLyBrZXlzID0gZWxlbWVudHMubWFwKHRoaXMuX2tleVNlbGVjdG9yKTtcbiAgICBjb25zdCAvKiogQHR5cGUge2Z1bmN0aW9uKFRLZXksIFRLZXkpOiBudW1iZXJ9ICovIGNvbXBhcmVyID0gdGhpcy5fY29tcGFyZXI7XG4gICAgY29uc3QgLyoqIEB0eXBlIHshT3JkZXJlZEl0ZXJhYmxlQmFzZVg8VFNvdXJjZT59ICovIHBhcmVudCA9IHRoaXMuX3BhcmVudDtcbiAgICBjb25zdCAvKiogQHR5cGUge2Jvb2xlYW59ICovIGRlc2NlbmRpbmcgPSB0aGlzLl9kZXNjZW5kaW5nO1xuICAgIGNvbnN0IC8qKiBAdHlwZSB7ZnVuY3Rpb24obnVtYmVyLCBudW1iZXIpOiBudW1iZXJ9ICovIHNvcnRlciA9ICh4OiBudW1iZXIsIHk6IG51bWJlcik6IG51bWJlciA9PiB7XG4gICAgICBjb25zdCAvKiogQHR5cGUge251bWJlcn0gKi8gcmVzdWx0ID0gY29tcGFyZXIoa2V5c1t4XSwga2V5c1t5XSk7XG4gICAgICBpZiAocmVzdWx0ID09PSAwKSB7XG4gICAgICAgIHJldHVybiBuZXh0ID8gbmV4dCh4LCB5KSA6IHggLSB5O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGVzY2VuZGluZyA/IC1yZXN1bHQgOiByZXN1bHQ7XG4gICAgfTtcblxuICAgIHJldHVybiBwYXJlbnQgPyBwYXJlbnQuX2dldFNvcnRlcihlbGVtZW50cywgc29ydGVyKSA6IHNvcnRlcjtcbiAgfVxufVxuXG5mdW5jdGlvbiBPcmRlcmVkSXRlcmFibGVYX3RzaWNrbGVfQ2xvc3VyZV9kZWNsYXJhdGlvbnMoKSB7XG4vKiogQHR5cGUge2Z1bmN0aW9uKFRTb3VyY2UpOiBUS2V5fSAqL1xuT3JkZXJlZEl0ZXJhYmxlWC5wcm90b3R5cGUuX2tleVNlbGVjdG9yO1xuLyoqIEB0eXBlIHtmdW5jdGlvbihUS2V5LCBUS2V5KTogbnVtYmVyfSAqL1xuT3JkZXJlZEl0ZXJhYmxlWC5wcm90b3R5cGUuX2NvbXBhcmVyO1xuLyoqIEB0eXBlIHtib29sZWFufSAqL1xuT3JkZXJlZEl0ZXJhYmxlWC5wcm90b3R5cGUuX2Rlc2NlbmRpbmc7XG4vKiogQHR5cGUgeyFPcmRlcmVkSXRlcmFibGVCYXNlWDxUU291cmNlPn0gKi9cbk9yZGVyZWRJdGVyYWJsZVgucHJvdG90eXBlLl9wYXJlbnQ7XG59XG5cbi8qKlxuICogQHRlbXBsYXRlIFRLZXksIFRTb3VyY2VcbiAqIEBwYXJhbSB7IUl0ZXJhYmxlPFRTb3VyY2U+fSBzb3VyY2VcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oVFNvdXJjZSk6IFRLZXl9IGtleVNlbGVjdG9yXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFRLZXksIFRLZXkpOiBudW1iZXI9fSBjb21wYXJlclxuICogQHJldHVybiB7IU9yZGVyZWRJdGVyYWJsZVg8VEtleSwgVFNvdXJjZT59XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBvcmRlckJ5PFRLZXksIFRTb3VyY2U+KFxuICAgICAgc291cmNlOiBJdGVyYWJsZTxUU291cmNlPixcbiAgICAgIGtleVNlbGVjdG9yOiAoaXRlbTogVFNvdXJjZSkgPT4gVEtleSxcbiAgICAgIGNvbXBhcmVyOiAoZnN0OiBUS2V5LCBzbmQ6IFRLZXkpID0+IG51bWJlciA9IGRlZmF1bHRTb3J0ZXIpOiBPcmRlcmVkSXRlcmFibGVYPFRLZXksIFRTb3VyY2U+IHtcbiAgcmV0dXJuIG5ldyBPcmRlcmVkSXRlcmFibGVYPFRLZXksIFRTb3VyY2U+KHNvdXJjZSwga2V5U2VsZWN0b3IsIGNvbXBhcmVyLCBmYWxzZSk7XG59XG4vKipcbiAqIEB0ZW1wbGF0ZSBUS2V5LCBUU291cmNlXG4gKiBAcGFyYW0geyFJdGVyYWJsZTxUU291cmNlPn0gc291cmNlXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFRTb3VyY2UpOiBUS2V5fSBrZXlTZWxlY3RvclxuICogQHBhcmFtIHtmdW5jdGlvbihUS2V5LCBUS2V5KTogbnVtYmVyPX0gY29tcGFyZXJcbiAqIEByZXR1cm4geyFPcmRlcmVkSXRlcmFibGVYPFRLZXksIFRTb3VyY2U+fVxuICovXG5leHBvcnQgZnVuY3Rpb24gb3JkZXJCeURlc2NlbmRpbmc8VEtleSwgVFNvdXJjZT4oXG4gICAgICBzb3VyY2U6IEl0ZXJhYmxlPFRTb3VyY2U+LFxuICAgICAga2V5U2VsZWN0b3I6IChpdGVtOiBUU291cmNlKSA9PiBUS2V5LFxuICAgICAgY29tcGFyZXI6IChmc3Q6IFRLZXksIHNuZDogVEtleSkgPT4gbnVtYmVyID0gZGVmYXVsdFNvcnRlcik6IE9yZGVyZWRJdGVyYWJsZVg8VEtleSwgVFNvdXJjZT4ge1xuICByZXR1cm4gbmV3IE9yZGVyZWRJdGVyYWJsZVg8VEtleSwgVFNvdXJjZT4oc291cmNlLCBrZXlTZWxlY3RvciwgY29tcGFyZXIsIHRydWUpO1xufVxuLyoqXG4gKiBAdGVtcGxhdGUgVEtleSwgVFNvdXJjZVxuICogQHBhcmFtIHshT3JkZXJlZEl0ZXJhYmxlQmFzZVg8VFNvdXJjZT59IHNvdXJjZVxuICogQHBhcmFtIHtmdW5jdGlvbihUU291cmNlKTogVEtleX0ga2V5U2VsZWN0b3JcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oVEtleSwgVEtleSk6IG51bWJlcj19IGNvbXBhcmVyXG4gKiBAcmV0dXJuIHshT3JkZXJlZEl0ZXJhYmxlWDxUS2V5LCBUU291cmNlPn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRoZW5CeTxUS2V5LCBUU291cmNlPihcbiAgICAgIHNvdXJjZTogT3JkZXJlZEl0ZXJhYmxlQmFzZVg8VFNvdXJjZT4sXG4gICAgICBrZXlTZWxlY3RvcjogKGl0ZW06IFRTb3VyY2UpID0+IFRLZXksXG4gICAgICBjb21wYXJlcjogKGZzdDogVEtleSwgc25kOiBUS2V5KSA9PiBudW1iZXIgPSBkZWZhdWx0U29ydGVyKTogT3JkZXJlZEl0ZXJhYmxlWDxUS2V5LCBUU291cmNlPiB7XG4gIHJldHVybiBuZXcgT3JkZXJlZEl0ZXJhYmxlWDxUS2V5LCBUU291cmNlPihzb3VyY2UuX3NvdXJjZSwga2V5U2VsZWN0b3IsIGNvbXBhcmVyLCBmYWxzZSwgc291cmNlKTtcbn1cbi8qKlxuICogQHRlbXBsYXRlIFRLZXksIFRTb3VyY2VcbiAqIEBwYXJhbSB7IU9yZGVyZWRJdGVyYWJsZUJhc2VYPFRTb3VyY2U+fSBzb3VyY2VcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oVFNvdXJjZSk6IFRLZXl9IGtleVNlbGVjdG9yXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFRLZXksIFRLZXkpOiBudW1iZXI9fSBjb21wYXJlclxuICogQHJldHVybiB7IU9yZGVyZWRJdGVyYWJsZVg8VEtleSwgVFNvdXJjZT59XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0aGVuQnlEZXNjZW5kaW5nPFRLZXksIFRTb3VyY2U+KFxuICAgICAgc291cmNlOiBPcmRlcmVkSXRlcmFibGVCYXNlWDxUU291cmNlPixcbiAgICAgIGtleVNlbGVjdG9yOiAoaXRlbTogVFNvdXJjZSkgPT4gVEtleSxcbiAgICAgIGNvbXBhcmVyOiAoZnN0OiBUS2V5LCBzbmQ6IFRLZXkpID0+IG51bWJlciA9IGRlZmF1bHRTb3J0ZXIpOiBPcmRlcmVkSXRlcmFibGVYPFRLZXksIFRTb3VyY2U+IHtcbiAgcmV0dXJuIG5ldyBPcmRlcmVkSXRlcmFibGVYPFRLZXksIFRTb3VyY2U+KHNvdXJjZS5fc291cmNlLCBrZXlTZWxlY3RvciwgY29tcGFyZXIsIHRydWUsIHNvdXJjZSk7XG59XG4iXX0=