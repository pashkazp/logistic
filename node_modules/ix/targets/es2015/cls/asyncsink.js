goog.module('targets.es2015.cls.asyncsink'); exports = {}; var module = {id: 'targets/es2015/cls/asyncsink.js'};/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

const /** @type {string} */ ARRAY_VALUE = 'value';
const /** @type {string} */ ARRAY_ERROR = 'error';
/**
 * @record
 * @template T
 */
function AsyncSinkItem() { }
function AsyncSinkItem_tsickle_Closure_declarations() {
    /** @type {string} */
    AsyncSinkItem.prototype.type;
    /** @type {T} */
    AsyncSinkItem.prototype.value;
    /** @type {?|undefined} */
    AsyncSinkItem.prototype.error;
}
/**
 * @record
 * @template T
 */
function AsyncResolver() { }
function AsyncResolver_tsickle_Closure_declarations() {
    /** @type {function((T|!PromiseLike<T>)): void} */
    AsyncResolver.prototype.resolve;
    /** @type {function(?): void} */
    AsyncResolver.prototype.reject;
}
/**
 * @template TSource
 * @implements {AsyncIterableIterator}
 */
class AsyncSink {
    constructor() {
        this._ended = false;
        this._values = [];
        this._resolvers = [];
    }
    /**
     * @return {AsyncSink}
     */
    [Symbol.asyncIterator]() {
        return this;
    }
    /**
     * @param {TSource} value
     * @return {void}
     */
    write(value) {
        this._push({ type: ARRAY_VALUE, value });
    }
    /**
     * @param {?} error
     * @return {void}
     */
    error(error) {
        this._push({ type: ARRAY_ERROR, error });
    }
    /**
     * @param {!AsyncSinkItem<TSource>} item
     * @return {void}
     */
    _push(item) {
        if (this._ended) {
            throw new Error('AsyncSink already ended');
        }
        if (this._resolvers.length > 0) {
            const { resolve, reject } = ((this._resolvers.shift()));
            if (item.type === ARRAY_ERROR) {
                reject(/** @type {?} */ ((item.error)));
            }
            else {
                resolve({ done: false, value: /** @type {TSource} */ ((item.value)) });
            }
        }
        else {
            this._values.push(item);
        }
    }
    /**
     * @return {!Promise<!IteratorResult<TSource>>}
     */
    next() {
        if (this._values.length > 0) {
            const { type, value, error } = ((this._values.shift()));
            if (type === ARRAY_ERROR) {
                return Promise.reject(error);
            }
            else {
                return Promise.resolve(/** @type {!IteratorResult<TSource>} */ ({ done: false, value }));
            }
        }
        if (this._ended) {
            return Promise.resolve(/** @type {!IteratorResult<TSource>} */ ({ done: true }));
        }
        return new Promise((resolve, reject) => {
            this._resolvers.push({ resolve, reject });
        });
    }
    /**
     * @return {void}
     */
    end() {
        while (this._resolvers.length > 0) {
            ((this._resolvers.shift())).resolve(/** @type {!IteratorResult<TSource>} */ ({ done: true }));
        }
        this._ended = true;
    }
}
exports.AsyncSink = AsyncSink;
function AsyncSink_tsickle_Closure_declarations() {
    /** @type {boolean} */
    AsyncSink.prototype._ended;
    /** @type {!Array<!AsyncSinkItem<TSource>>} */
    AsyncSink.prototype._values;
    /** @type {!Array<!AsyncResolver<!IteratorResult<TSource>>>} */
    AsyncSink.prototype._resolvers;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hc3luY3NpbmsudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHOztBQUhILE1BQUEscUJBQUssQ0FBQSxXQUFZLEdBQUUsT0FBUSxDQUFDO0FBTTVCLE1BQU0scUJBTEQsQ0FBQSxXQUFZLEdBQUUsT0FBUSxDQUFBO0FBTTNCOzs7R0FHRztBQUNILDJCQUEwQixDQUFDO0FBRzNCO0lBQ0EscUJBQXFCO0lBQ3JCLGFBQWEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDO0lBQzdCLGdCQUFnQjtJQUNoQixhQUFhLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQztJQUM5QiwwQkFBMEI7SUFDMUIsYUFBYSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7QUFDOUIsQ0FBQztBQVFEOzs7R0FHRztBQUNILDJCQUEwQixDQUFDO0FBRzNCO0lBQ0Esa0RBQWtEO0lBQ2xELGFBQWEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDO0lBQ2hDLGdDQUFnQztJQUNoQyxhQUFhLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQztBQUMvQixDQUFDO0FBT0Q7OztHQUdHO0FBckNIO0lBS0U7UUFzQ0UsSUFyQ0ksQ0FBQyxNQUFNLEdBQUUsS0FBTSxDQUFDO1FBc0NwQixJQXJDSSxDQUFDLE9BQU8sR0FBRSxFQUFHLENBQUM7UUFzQ2xCLElBckNJLENBQUMsVUFBVSxHQUFFLEVBQUcsQ0FBQztJQXNDdkIsQ0FBQztJQUNIOztPQUVHO0lBdENELENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQztRQXdDcEIsTUF2Q00sQ0FBQSxJQUFLLENBQUM7SUF3Q2QsQ0FBQztJQUNIOzs7T0FHRztJQXpDRCxLQUFLLENBQUMsS0FBYztRQTJDbEIsSUExQ0ksQ0FBQyxLQUFLLENBQUMsRUFBQyxJQUFLLEVBQUMsV0FBWSxFQUFDLEtBQU0sRUFBRSxDQUFDLENBQUM7SUEyQzNDLENBQUM7SUFDSDs7O09BR0c7SUE1Q0QsS0FBSyxDQUFDLEtBQVU7UUE4Q2QsSUE3Q0ks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LENBckRDO1FBc0RELElBckRJLENBQUMsTUFBTSxHQUFFLElBQUssQ0FBQztJQXNEckIsQ0FyREM7Q0FDSDtBQWpFQSw4QkFpRUE7QUF1REE7SUFDQSxzQkFBc0I7SUFDdEIsU0FBUyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7SUFDM0IsOENBQThDO0lBQzlDLFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDO0lBQzVCLCtEQUErRDtJQUMvRCxTQUFTLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQztBQUMvQixDQUFDIiwiZmlsZSI6ImFzeW5jc2luay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlb3ZlcnZpZXcgYWRkZWQgYnkgdHNpY2tsZVxuICogQHN1cHByZXNzIHtjaGVja1R5cGVzfSBjaGVja2VkIGJ5IHRzY1xuICovXG5cbmNvbnN0IC8qKiBAdHlwZSB7c3RyaW5nfSAqLyBBUlJBWV9WQUxVRSA9ICd2YWx1ZSc7XG5jb25zdCAvKiogQHR5cGUge3N0cmluZ30gKi8gQVJSQVlfRVJST1IgPSAnZXJyb3InO1xuLyoqXG4gKiBAcmVjb3JkXG4gKiBAdGVtcGxhdGUgVFxuICovXG5mdW5jdGlvbiBBc3luY1NpbmtJdGVtKCkge31cblxuXG5mdW5jdGlvbiBBc3luY1NpbmtJdGVtX3RzaWNrbGVfQ2xvc3VyZV9kZWNsYXJhdGlvbnMoKSB7XG4vKiogQHR5cGUge3N0cmluZ30gKi9cbkFzeW5jU2lua0l0ZW0ucHJvdG90eXBlLnR5cGU7XG4vKiogQHR5cGUge1R9ICovXG5Bc3luY1NpbmtJdGVtLnByb3RvdHlwZS52YWx1ZTtcbi8qKiBAdHlwZSB7P3x1bmRlZmluZWR9ICovXG5Bc3luY1NpbmtJdGVtLnByb3RvdHlwZS5lcnJvcjtcbn1cblxuXG5pbnRlcmZhY2UgQXN5bmNTaW5rSXRlbTxUPiB7XG4gIHR5cGU6IHN0cmluZztcbiAgdmFsdWU/OiBUO1xuICBlcnJvcj86IGFueTtcbn1cbi8qKlxuICogQHJlY29yZFxuICogQHRlbXBsYXRlIFRcbiAqL1xuZnVuY3Rpb24gQXN5bmNSZXNvbHZlcigpIHt9XG5cblxuZnVuY3Rpb24gQXN5bmNSZXNvbHZlcl90c2lja2xlX0Nsb3N1cmVfZGVjbGFyYXRpb25zKCkge1xuLyoqIEB0eXBlIHtmdW5jdGlvbigoVHwhUHJvbWlzZUxpa2U8VD4pKTogdm9pZH0gKi9cbkFzeW5jUmVzb2x2ZXIucHJvdG90eXBlLnJlc29sdmU7XG4vKiogQHR5cGUge2Z1bmN0aW9uKD8pOiB2b2lkfSAqL1xuQXN5bmNSZXNvbHZlci5wcm90b3R5cGUucmVqZWN0O1xufVxuXG5cbmludGVyZmFjZSBBc3luY1Jlc29sdmVyPFQ+IHtcbiAgcmVzb2x2ZTogKHZhbHVlPzogVCB8IFByb21pc2VMaWtlPFQ+IHwgdW5kZWZpbmVkKSA9PiB2b2lkO1xuICByZWplY3Q6IChyZWFzb24/OiBhbnkpID0+IHZvaWQ7XG59XG4vKipcbiAqIEB0ZW1wbGF0ZSBUU291cmNlXG4gKiBAaW1wbGVtZW50cyB7QXN5bmNJdGVyYWJsZUl0ZXJhdG9yfVxuICovXG5leHBvcnQgY2xhc3MgQXN5bmNTaW5rPFRTb3VyY2U+IGltcGxlbWVudHMgQXN5bmNJdGVyYWJsZUl0ZXJhdG9yPFRTb3VyY2U+IHtcbnByaXZhdGUgX2VuZGVkOiBib29sZWFuO1xucHJpdmF0ZSBfdmFsdWVzOiBBc3luY1NpbmtJdGVtPFRTb3VyY2U+W107XG5wcml2YXRlIF9yZXNvbHZlcnM6IEFzeW5jUmVzb2x2ZXI8SXRlcmF0b3JSZXN1bHQ8VFNvdXJjZT4+W107XG5jb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9lbmRlZCA9IGZhbHNlO1xuICAgIHRoaXMuX3ZhbHVlcyA9IFtdO1xuICAgIHRoaXMuX3Jlc29sdmVycyA9IFtdO1xuICB9XG4vKipcbiAqIEByZXR1cm4ge0FzeW5jU2lua31cbiAqL1xuW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuLyoqXG4gKiBAcGFyYW0ge1RTb3VyY2V9IHZhbHVlXG4gKiBAcmV0dXJuIHt2b2lkfVxuICovXG53cml0ZSh2YWx1ZTogVFNvdXJjZSkge1xuICAgIHRoaXMuX3B1c2goeyB0eXBlOiBBUlJBWV9WQUxVRSwgdmFsdWUgfSk7XG4gIH1cbi8qKlxuICogQHBhcmFtIHs/fSBlcnJvclxuICogQHJldHVybiB7dm9pZH1cbiAqL1xuZXJyb3IoZXJyb3I6IGFueSkge1xuICAgIHRoaXMuX3B1c2goeyB0eXBlOiBBUlJBWV9FUlJPUiwgZXJyb3IgfSk7XG4gIH1cbi8qKlxuICogQHBhcmFtIHshQXN5bmNTaW5rSXRlbTxUU291cmNlPn0gaXRlbVxuICogQHJldHVybiB7dm9pZH1cbiAqL1xuXG5wcml2YXRlIF9wdXNoKGl0ZW06IEFzeW5jU2lua0l0ZW08VFNvdXJjZT4pIHtcbiAgICBpZiAodGhpcy5fZW5kZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQXN5bmNTaW5rIGFscmVhZHkgZW5kZWQnKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fcmVzb2x2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHtyZXNvbHZlLCByZWplY3QgfSA9IC8qKiBAdHlwZSB7IUFzeW5jUmVzb2x2ZXI8IUl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+Pn0gKi8oKCB0aGlzLl9yZXNvbHZlcnMuc2hpZnQoKSkpO1xuICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gQVJSQVlfRVJST1IpIHtcbiAgICAgICAgcmVqZWN0KCAvKiogQHR5cGUgez99ICovKChpdGVtLmVycm9yKSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzb2x2ZSh7IGRvbmU6IGZhbHNlLCB2YWx1ZTogLyoqIEB0eXBlIHtUU291cmNlfSAqLygoIGl0ZW0udmFsdWUpKSB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fdmFsdWVzLnB1c2goaXRlbSk7XG4gICAgfVxuICB9XG4vKipcbiAqIEByZXR1cm4geyFQcm9taXNlPCFJdGVyYXRvclJlc3VsdDxUU291cmNlPj59XG4gKi9cbm5leHQoKSB7XG4gICAgaWYgKHRoaXMuX3ZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCB7IHR5cGUsIHZhbHVlLCBlcnJvciB9ID0gLyoqIEB0eXBlIHshQXN5bmNTaW5rSXRlbTxUU291cmNlPn0gKi8oKCB0aGlzLl92YWx1ZXMuc2hpZnQoKSkpO1xuICAgICAgaWYgKHR5cGUgPT09IEFSUkFZX0VSUk9SKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCAvKiogQHR5cGUgeyFJdGVyYXRvclJlc3VsdDxUU291cmNlPn0gKi8oKHsgZG9uZTogZmFsc2UsIHZhbHVlIH0gYXMgSXRlcmF0b3JSZXN1bHQ8VFNvdXJjZT4pKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX2VuZGVkKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCAvKiogQHR5cGUgeyFJdGVyYXRvclJlc3VsdDxUU291cmNlPn0gKi8oKHsgZG9uZTogdHJ1ZSB9IGFzIEl0ZXJhdG9yUmVzdWx0PFRTb3VyY2U+KSkpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgUHJvbWlzZTxJdGVyYXRvclJlc3VsdDxUU291cmNlPj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5fcmVzb2x2ZXJzLnB1c2goeyByZXNvbHZlLCByZWplY3QgfSk7XG4gICAgfSk7XG4gIH1cbi8qKlxuICogQHJldHVybiB7dm9pZH1cbiAqL1xuZW5kKCkge1xuICAgIHdoaWxlICh0aGlzLl9yZXNvbHZlcnMubGVuZ3RoID4gMCkgeyAvKiogQHR5cGUgeyFBc3luY1Jlc29sdmVyPCFJdGVyYXRvclJlc3VsdDxUU291cmNlPj59ICovKChcbiAgICAgIHRoaXMuX3Jlc29sdmVycy5zaGlmdCgpKSkucmVzb2x2ZSggLyoqIEB0eXBlIHshSXRlcmF0b3JSZXN1bHQ8VFNvdXJjZT59ICovKCh7IGRvbmU6IHRydWUgfSBhcyBJdGVyYXRvclJlc3VsdDxUU291cmNlPikpKTtcbiAgICB9XG4gICAgdGhpcy5fZW5kZWQgPSB0cnVlO1xuICB9XG59XG5cbmZ1bmN0aW9uIEFzeW5jU2lua190c2lja2xlX0Nsb3N1cmVfZGVjbGFyYXRpb25zKCkge1xuLyoqIEB0eXBlIHtib29sZWFufSAqL1xuQXN5bmNTaW5rLnByb3RvdHlwZS5fZW5kZWQ7XG4vKiogQHR5cGUgeyFBcnJheTwhQXN5bmNTaW5rSXRlbTxUU291cmNlPj59ICovXG5Bc3luY1NpbmsucHJvdG90eXBlLl92YWx1ZXM7XG4vKiogQHR5cGUgeyFBcnJheTwhQXN5bmNSZXNvbHZlcjwhSXRlcmF0b3JSZXN1bHQ8VFNvdXJjZT4+Pn0gKi9cbkFzeW5jU2luay5wcm90b3R5cGUuX3Jlc29sdmVycztcbn1cblxuIl19