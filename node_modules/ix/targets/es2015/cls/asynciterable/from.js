goog.module('targets.es2015.cls.asynciterable.from'); exports = {}; var module = {id: 'targets/es2015/cls/asynciterable/from.js'};/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

var asynciterable_1 = goog.require('targets.es2015.cls.asynciterable');
const tsickle_forward_declare_1 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.asynciterable");
var bindcallback_1 = goog.require('targets.es2015.cls.internal.bindcallback');
const tsickle_forward_declare_2 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.internal.bindcallback");
var identity_1 = goog.require('targets.es2015.cls.internal.identity');
const tsickle_forward_declare_3 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.internal.identity");
var tolength_1 = goog.require('targets.es2015.cls.internal.tolength');
const tsickle_forward_declare_4 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.internal.tolength");
var isiterable_1 = goog.require('targets.es2015.cls.internal.isiterable');
const tsickle_forward_declare_5 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.internal.isiterable");
const tsickle_forward_declare_6 = goog.forwardDeclare("_Users.ptaylor.dev.ixjs.src.observer");
goog.require("_Users.ptaylor.dev.ixjs.src.observer"); // force type-only module to be loaded
/**
 * @template TSource, TResult
 */
class FromArrayIterable extends asynciterable_1.AsyncIterableX {
    /**
     * @param {!ArrayLike<TSource>} source
     * @param {function(TSource, number): (TResult|!Promise<TResult>)} selector
     */
    constructor(source, selector) {
        super();
        this._source = source;
        this._selector = selector;
    }
    /**
     * @return {!AsyncIterableIterator<TResult>}
     */
    [Symbol.asyncIterator]() {
        return __asyncGenerator(this, arguments, function* _a() {
            let /** @type {number} */ i = 0;
            const /** @type {number} */ length = tolength_1.toLength(((this._source)).length);
            while (i < length) {
                yield yield __await(this._selector(this._source[i], i++));
            }
        });
    }
}
function FromArrayIterable_tsickle_Closure_declarations() {
    /** @type {!ArrayLike<TSource>} */
    FromArrayIterable.prototype._source;
    /** @type {function(TSource, number): (TResult|!Promise<TResult>)} */
    FromArrayIterable.prototype._selector;
}
/**
 * @template TSource, TResult
 */
class FromAsyncIterable extends asynciterable_1.AsyncIterableX {
    /**
     * @param {(!Iterable<(TSource|!PromiseLike<TSource>)>|!AsyncIterable<TSource>)} source
     * @param {function(TSource, number): (TResult|!Promise<TResult>)} selector
     */
    constructor(source, selector) {
        super();
        this._source = source;
        this._selector = selector;
    }
    /**
     * @return {!AsyncIterableIterator<TResult>}
     */
    [Symbol.asyncIterator]() {
        return __asyncGenerator(this, arguments, function* _a() {
            let /** @type {number} */ i = 0;
            try {
                for (var /** @type {!AsyncIterable<TSource>} */ _a = __asyncValues(/** @type {!AsyncIterable<TSource>} */ (this._source)), _b; _b = yield __await(_a.next()), !_b.done;) {
                    let /** @type {TSource} */ item = yield __await(_b.value);
                    yield yield __await(this._selector(item, i++));
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_b && !_b.done && (_c = _a.return)) yield __await(_c.call(_a));
                }
                finally { if (e_1) throw e_1.error; }
            }
            var e_1, _c;
        });
    }
}
function FromAsyncIterable_tsickle_Closure_declarations() {
    /** @type {(!Iterable<(TSource|!PromiseLike<TSource>)>|!AsyncIterable<TSource>)} */
    FromAsyncIterable.prototype._source;
    /** @type {function(TSource, number): (TResult|!Promise<TResult>)} */
    FromAsyncIterable.prototype._selector;
}
/**
 * @template TSource, TResult
 */
class FromPromiseIterable extends asynciterable_1.AsyncIterableX {
    /**
     * @param {!PromiseLike<TSource>} source
     * @param {function(TSource, number): (TResult|!Promise<TResult>)} selector
     */
    constructor(source, selector) {
        super();
        this._source = source;
        this._selector = selector;
    }
    /**
     * @return {!AsyncIterableIterator<TResult>}
     */
    [Symbol.asyncIterator]() {
        return __asyncGenerator(this, arguments, function* _a() {
            const /** @type {TSource} */ item = yield __await(this._source);
            yield yield __await(this._selector(item, 0));
        });
    }
}
function FromPromiseIterable_tsickle_Closure_declarations() {
    /** @type {!PromiseLike<TSource>} */
    FromPromiseIterable.prototype._source;
    /** @type {function(TSource, number): (TResult|!Promise<TResult>)} */
    FromPromiseIterable.prototype._selector;
}
/**
 * @template TSource
 */
class AsyncObserver {
    constructor() {
        this.values = [];
        this.hasCompleted = false;
        this.hasError = false;
        this.errorValue = null;
        this.closed = false;
    }
    /**
     * @param {TSource} value
     * @return {void}
     */
    next(value) {
        if (!this.closed) {
            this.values.push(value);
        }
    }
    /**
     * @param {?} err
     * @return {void}
     */
    error(err) {
        if (!this.closed) {
            this.closed = true;
            this.hasError = true;
            this.errorValue = err;
        }
    }
    /**
     * @return {void}
     */
    complete() {
        if (!this.closed) {
            this.closed = true;
        }
    }
}
function AsyncObserver_tsickle_Closure_declarations() {
    /** @type {!Array<TSource>} */
    AsyncObserver.prototype.values;
    /** @type {boolean} */
    AsyncObserver.prototype.hasError;
    /** @type {boolean} */
    AsyncObserver.prototype.hasCompleted;
    /** @type {?} */
    AsyncObserver.prototype.errorValue;
    /** @type {boolean} */
    AsyncObserver.prototype.closed;
}
/**
 * @template TSource, TResult
 */
class FromObservableAsyncIterable extends asynciterable_1.AsyncIterableX {
    /**
     * @param {!tsickle_forward_declare_6.Observable<TSource>} observable
     * @param {function(TSource, number): (TResult|!Promise<TResult>)} selector
     */
    constructor(observable, selector) {
        super();
        this._observable = observable;
        this._selector = selector;
    }
    /**
     * @return {!AsyncIterableIterator<TResult>}
     */
    [Symbol.asyncIterator]() {
        return __asyncGenerator(this, arguments, function* _a() {
            const /** @type {!AsyncObserver<TSource>} */ observer = new AsyncObserver();
            const /** @type {!Subscription} */ subscription = this._observable.subscribe(observer);
            let /** @type {number} */ i = 0;
            while (1) {
                if (observer.values.length > 0) {
                    yield yield __await(this._selector(observer.values.shift(), i++));
                }
                else if (observer.closed) {
                    subscription.unsubscribe();
                    if (observer.hasError) {
                        throw observer.errorValue;
                    }
                    else {
                        break;
                    }
                }
            }
        });
    }
}
function FromObservableAsyncIterable_tsickle_Closure_declarations() {
    /** @type {!tsickle_forward_declare_6.Observable<TSource>} */
    FromObservableAsyncIterable.prototype._observable;
    /** @type {function(TSource, number): (TResult|!Promise<TResult>)} */
    FromObservableAsyncIterable.prototype._selector;
}
/** @typedef {(!PromiseLike<TSource>|!Iterable<(TSource|!PromiseLike<TSource>)>|!AsyncIterable<TSource>|!ArrayLike<TSource>|!tsickle_forward_declare_6.Observable<TSource>)} */
exports.AsyncIterableInput;
/**
 * @param {?} x
 * @return {boolean}
 */
function isPromise(x) {
    return x != null && Object(x) === x && typeof x['then'] === 'function';
}
/**
 * @param {?} x
 * @return {boolean}
 */
function isObservable(x) {
    return x != null && Object(x) === x && typeof x['subscribe'] === 'function';
}
/**
 * @param {?} x
 * @return {boolean}
 */
function isArrayLike(x) {
    return x != null && Object(x) === x && typeof x['length'] === 'number';
}
/**
 * @template TSource, TResult
 * @param {(!PromiseLike<TSource>|!Iterable<(TSource|!PromiseLike<TSource>)>|!AsyncIterable<TSource>|!ArrayLike<TSource>|!tsickle_forward_declare_6.Observable<TSource>)} source
 * @param {function(TSource, number): (TResult|!Promise<TResult>)=} selector
 * @param {?=} thisArg
 * @return {!tsickle_forward_declare_1.AsyncIterableX<TResult>}
 */
function from(source, selector = identity_1.identityAsync, thisArg) {
    const /** @type {?} */ fn = bindcallback_1.bindCallback(selector, thisArg, 2);
    if (isiterable_1.isIterable(source) || isiterable_1.isAsyncIterable(source)) {
        return new FromAsyncIterable(source, fn);
    }
    if (isPromise(source)) {
        return new FromPromiseIterable(source, fn);
    }
    if (isObservable(source)) {
        return new FromObservableAsyncIterable(source, fn);
    }
    if (isArrayLike(source)) {
        return new FromArrayIterable(source, fn);
    }
    throw new TypeError('Input type not supported');
}
exports.from = from;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hc3luY2l0ZXJhYmxlL2Zyb20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHOztBQUVILG9EQUx1QjtBQU12QixNQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsMkNBQTJDLENBQUMsQ0FOaEQ7QUFPbEQsMkRBTnFCO0FBT3JCLE1BQU0seUJBQXlCLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxtREFBbUQsQ0FBQyxDQVBsRDtBQVF4RCxtREFQc0I7QUFRdEIsTUFBTSx5QkFBeUIsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLCtDQUErQyxDQUFDLENBUmpEO0FBU3JELG1EQVJpQjtBQVNqQixNQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsK0NBQStDLENBQUMsQ0FUdEQ7QUFVaEQsdURBVG9DO0FBVXBDLE1BQU0seUJBQXlCLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxpREFBaUQsQ0FBQyxDQVZuQztBQVlyRSxNQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsc0NBQXNDLENBQUMsQ0FBQztBQUM5RixJQUFJLENBQUMsT0FBTyxDQUFDLHNDQUFzQyxDQUFDLENBQUMsQ0FBQyxzQ0FBc0M7QUFDNUY7O0dBRUc7QUFiSCx1QkFBbUQsU0FBUSw4QkFBd0I7SUFpQm5GOzs7T0FHRztJQWhCRCxZQWtCSSxNQWpCMEIsRUFrQjFCLFFBakJ1RTtRQWtCekUsS0FqQkssRUFBRSxDQUFDO1FBa0JSLElBakJJLENBQUMsT0FBTyxHQUFFLE1BQU8sQ0FBQztRQWtCdEIsSUFqQkksQ0FBQyxTQUFTLEdBQUUsUUFBUyxDQUFDO0lBa0I1QixDQUFDO0lBQ0g7O09BRUc7SUFsQk0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDOztZQW9CM0IsSUFBSSxxQkFuQkQsQ0FBQSxDQUFFLEdBQUUsQ0FBRSxDQUFDO1lBb0JWLE1BQU0scUJBbkJELENBQUEsTUFBTyxHQUFFLG1C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QUMsQ0FBQztJQWtIL0QsQ0FqSEM7SUFrSEQsRUFBRSxDQUFDLENBakhDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFBLENBQUU7UUFrSHpCLE1BakhNLENBQUEsSUFBSSwyQkFBNEIsQ0FBbUIsTUFBTSxFQUFDLEVBQUcsQ0FBQyxDQUFDO0lBa0h2RSxDQWpIQztJQWtIRCxFQUFFLENBQUMsQ0FqSEMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUEsQ0FBRTtRQWtIeEIsTUFqSE0sQ0FBQSxJQUFJLGlCQUFrQixDQUFtQixNQUFNLEVBQUMsRUFBRyxDQUFDLENBQUM7SUFrSDdELENBakhDO0lBbUhELE1BakhLLElBQUksU0FBVSxDQUFDLDBCQUEwQixDQUFDLENBQUM7QUFrSGxELENBakhDO0FBbkJELG9CQW1CQyIsImZpbGUiOiJmcm9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGVvdmVydmlldyBhZGRlZCBieSB0c2lja2xlXG4gKiBAc3VwcHJlc3Mge2NoZWNrVHlwZXN9IGNoZWNrZWQgYnkgdHNjXG4gKi9cblxuaW1wb3J0IHsgQXN5bmNJdGVyYWJsZVggfSBmcm9tICcuLi9hc3luY2l0ZXJhYmxlJztcbmNvbnN0IHRzaWNrbGVfZm9yd2FyZF9kZWNsYXJlXzEgPSBnb29nLmZvcndhcmREZWNsYXJlKFwiX1VzZXJzLnB0YXlsb3IuZGV2Lml4anMuc3JjLmFzeW5jaXRlcmFibGVcIik7XG5pbXBvcnQgeyBiaW5kQ2FsbGJhY2sgfSBmcm9tICcuLi9pbnRlcm5hbC9iaW5kY2FsbGJhY2snO1xuY29uc3QgdHNpY2tsZV9mb3J3YXJkX2RlY2xhcmVfMiA9IGdvb2cuZm9yd2FyZERlY2xhcmUoXCJfVXNlcnMucHRheWxvci5kZXYuaXhqcy5zcmMuaW50ZXJuYWwuYmluZGNhbGxiYWNrXCIpO1xuaW1wb3J0IHsgaWRlbnRpdHlBc3luYyB9IGZyb20gJy4uL2ludGVybmFsL2lkZW50aXR5JztcbmNvbnN0IHRzaWNrbGVfZm9yd2FyZF9kZWNsYXJlXzMgPSBnb29nLmZvcndhcmREZWNsYXJlKFwiX1VzZXJzLnB0YXlsb3IuZGV2Lml4anMuc3JjLmludGVybmFsLmlkZW50aXR5XCIpO1xuaW1wb3J0IHsgdG9MZW5ndGggfSBmcm9tICcuLi9pbnRlcm5hbC90b2xlbmd0aCc7XG5jb25zdCB0c2lja2xlX2ZvcndhcmRfZGVjbGFyZV80ID0gZ29vZy5mb3J3YXJkRGVjbGFyZShcIl9Vc2Vycy5wdGF5bG9yLmRldi5peGpzLnNyYy5pbnRlcm5hbC50b2xlbmd0aFwiKTtcbmltcG9ydCB7IGlzSXRlcmFibGUsIGlzQXN5bmNJdGVyYWJsZSB9IGZyb20gJy4uL2ludGVybmFsL2lzaXRlcmFibGUnO1xuY29uc3QgdHNpY2tsZV9mb3J3YXJkX2RlY2xhcmVfNSA9IGdvb2cuZm9yd2FyZERlY2xhcmUoXCJfVXNlcnMucHRheWxvci5kZXYuaXhqcy5zcmMuaW50ZXJuYWwuaXNpdGVyYWJsZVwiKTtcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICcuLi9vYnNlcnZlcic7XG5jb25zdCB0c2lja2xlX2ZvcndhcmRfZGVjbGFyZV82ID0gZ29vZy5mb3J3YXJkRGVjbGFyZShcIl9Vc2Vycy5wdGF5bG9yLmRldi5peGpzLnNyYy5vYnNlcnZlclwiKTtcbmdvb2cucmVxdWlyZShcIl9Vc2Vycy5wdGF5bG9yLmRldi5peGpzLnNyYy5vYnNlcnZlclwiKTsgLy8gZm9yY2UgdHlwZS1vbmx5IG1vZHVsZSB0byBiZSBsb2FkZWRcbi8qKlxuICogQHRlbXBsYXRlIFRTb3VyY2UsIFRSZXN1bHRcbiAqL1xuY2xhc3MgRnJvbUFycmF5SXRlcmFibGU8VFNvdXJjZSwgVFJlc3VsdCA9IFRTb3VyY2U+IGV4dGVuZHMgQXN5bmNJdGVyYWJsZVg8VFJlc3VsdD4ge1xucHJpdmF0ZSBfc291cmNlOiBBcnJheUxpa2U8VFNvdXJjZT47XG5wcml2YXRlIF9zZWxlY3RvcjogKHZhbHVlOiBUU291cmNlLCBpbmRleDogbnVtYmVyKSA9PiBUUmVzdWx0IHwgUHJvbWlzZTxUUmVzdWx0Pjtcbi8qKlxuICogQHBhcmFtIHshQXJyYXlMaWtlPFRTb3VyY2U+fSBzb3VyY2VcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oVFNvdXJjZSwgbnVtYmVyKTogKFRSZXN1bHR8IVByb21pc2U8VFJlc3VsdD4pfSBzZWxlY3RvclxuICovXG5jb25zdHJ1Y3RvcihcbiAgICAgIHNvdXJjZTogQXJyYXlMaWtlPFRTb3VyY2U+LFxuICAgICAgc2VsZWN0b3I6ICh2YWx1ZTogVFNvdXJjZSwgaW5kZXg6IG51bWJlcikgPT4gVFJlc3VsdCB8IFByb21pc2U8VFJlc3VsdD4pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3NvdXJjZSA9IHNvdXJjZTtcbiAgICB0aGlzLl9zZWxlY3RvciA9IHNlbGVjdG9yO1xuICB9XG4vKipcbiAqIEByZXR1cm4geyFBc3luY0l0ZXJhYmxlSXRlcmF0b3I8VFJlc3VsdD59XG4gKi9cbmFzeW5jICpbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgIGxldCAvKiogQHR5cGUge251bWJlcn0gKi8gaSA9IDA7XG4gICAgY29uc3QgLyoqIEB0eXBlIHtudW1iZXJ9ICovIGxlbmd0aCA9IHRvTGVuZ3RoKCggLyoqIEB0eXBlIHshQXJyYXlMaWtlPFRTb3VyY2U+fSAqLygoPEFycmF5TGlrZTxUU291cmNlPj50aGlzLl9zb3VyY2UpKSkubGVuZ3RoKTtcbiAgICB3aGlsZSAoaSA8IGxlbmd0aCkge1xuICAgICAgeWllbGQgYXdhaXQgdGhpcy5fc2VsZWN0b3IodGhpcy5fc291cmNlW2ldLCBpKyspO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBGcm9tQXJyYXlJdGVyYWJsZV90c2lja2xlX0Nsb3N1cmVfZGVjbGFyYXRpb25zKCkge1xuLyoqIEB0eXBlIHshQXJyYXlMaWtlPFRTb3VyY2U+fSAqL1xuRnJvbUFycmF5SXRlcmFibGUucHJvdG90eXBlLl9zb3VyY2U7XG4vKiogQHR5cGUge2Z1bmN0aW9uKFRTb3VyY2UsIG51bWJlcik6IChUUmVzdWx0fCFQcm9taXNlPFRSZXN1bHQ+KX0gKi9cbkZyb21BcnJheUl0ZXJhYmxlLnByb3RvdHlwZS5fc2VsZWN0b3I7XG59XG5cbi8qKlxuICogQHRlbXBsYXRlIFRTb3VyY2UsIFRSZXN1bHRcbiAqL1xuY2xhc3MgRnJvbUFzeW5jSXRlcmFibGU8VFNvdXJjZSwgVFJlc3VsdCA9IFRTb3VyY2U+IGV4dGVuZHMgQXN5bmNJdGVyYWJsZVg8VFJlc3VsdD4ge1xucHJpdmF0ZSBfc291cmNlOiBJdGVyYWJsZTxUU291cmNlIHwgUHJvbWlzZUxpa2U8VFNvdXJjZT4+IHwgQXN5bmNJdGVyYWJsZTxUU291cmNlPjtcbnByaXZhdGUgX3NlbGVjdG9yOiAodmFsdWU6IFRTb3VyY2UsIGluZGV4OiBudW1iZXIpID0+IFRSZXN1bHQgfCBQcm9taXNlPFRSZXN1bHQ+O1xuLyoqXG4gKiBAcGFyYW0geyghSXRlcmFibGU8KFRTb3VyY2V8IVByb21pc2VMaWtlPFRTb3VyY2U+KT58IUFzeW5jSXRlcmFibGU8VFNvdXJjZT4pfSBzb3VyY2VcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oVFNvdXJjZSwgbnVtYmVyKTogKFRSZXN1bHR8IVByb21pc2U8VFJlc3VsdD4pfSBzZWxlY3RvclxuICovXG5jb25zdHJ1Y3RvcihcbiAgICAgIHNvdXJjZTogSXRlcmFibGU8VFNvdXJjZSB8IFByb21pc2VMaWtlPFRTb3VyY2U+PiB8IEFzeW5jSXRlcmFibGU8VFNvdXJjZT4sXG4gICAgICBzZWxlY3RvcjogKHZhbHVlOiBUU291cmNlLCBpbmRleDogbnVtYmVyKSA9PiBUUmVzdWx0IHwgUHJvbWlzZTxUUmVzdWx0Pikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fc291cmNlID0gc291cmNlO1xuICAgIHRoaXMuX3NlbGVjdG9yID0gc2VsZWN0b3I7XG4gIH1cbi8qKlxuICogQHJldHVybiB7IUFzeW5jSXRlcmFibGVJdGVyYXRvcjxUUmVzdWx0Pn1cbiAqL1xuYXN5bmMgKltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgbGV0IC8qKiBAdHlwZSB7bnVtYmVyfSAqLyBpID0gMDtcbiAgICBmb3IgYXdhaXQgKGxldCAvKiogQHR5cGUge1RTb3VyY2V9ICovIGl0ZW0gb2YgLyoqIEB0eXBlIHshQXN5bmNJdGVyYWJsZTxUU291cmNlPn0gKi8oKCA8QXN5bmNJdGVyYWJsZTxUU291cmNlPj50aGlzLl9zb3VyY2UpKSkge1xuICAgICAgeWllbGQgYXdhaXQgdGhpcy5fc2VsZWN0b3IoaXRlbSwgaSsrKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gRnJvbUFzeW5jSXRlcmFibGVfdHNpY2tsZV9DbG9zdXJlX2RlY2xhcmF0aW9ucygpIHtcbi8qKiBAdHlwZSB7KCFJdGVyYWJsZTwoVFNvdXJjZXwhUHJvbWlzZUxpa2U8VFNvdXJjZT4pPnwhQXN5bmNJdGVyYWJsZTxUU291cmNlPil9ICovXG5Gcm9tQXN5bmNJdGVyYWJsZS5wcm90b3R5cGUuX3NvdXJjZTtcbi8qKiBAdHlwZSB7ZnVuY3Rpb24oVFNvdXJjZSwgbnVtYmVyKTogKFRSZXN1bHR8IVByb21pc2U8VFJlc3VsdD4pfSAqL1xuRnJvbUFzeW5jSXRlcmFibGUucHJvdG90eXBlLl9zZWxlY3Rvcjtcbn1cblxuLyoqXG4gKiBAdGVtcGxhdGUgVFNvdXJjZSwgVFJlc3VsdFxuICovXG5jbGFzcyBGcm9tUHJvbWlzZUl0ZXJhYmxlPFRTb3VyY2UsIFRSZXN1bHQgPSBUU291cmNlPiBleHRlbmRzIEFzeW5jSXRlcmFibGVYPFRSZXN1bHQ+IHtcbnByaXZhdGUgX3NvdXJjZTogUHJvbWlzZUxpa2U8VFNvdXJjZT47XG5wcml2YXRlIF9zZWxlY3RvcjogKHZhbHVlOiBUU291cmNlLCBpbmRleDogbnVtYmVyKSA9PiBUUmVzdWx0IHwgUHJvbWlzZTxUUmVzdWx0Pjtcbi8qKlxuICogQHBhcmFtIHshUHJvbWlzZUxpa2U8VFNvdXJjZT59IHNvdXJjZVxuICogQHBhcmFtIHtmdW5jdGlvbihUU291cmNlLCBudW1iZXIpOiAoVFJlc3VsdHwhUHJvbWlzZTxUUmVzdWx0Pil9IHNlbGVjdG9yXG4gKi9cbmNvbnN0cnVjdG9yKFxuICAgICAgc291cmNlOiBQcm9taXNlTGlrZTxUU291cmNlPixcbiAgICAgIHNlbGVjdG9yOiAodmFsdWU6IFRTb3VyY2UsIGluZGV4OiBudW1iZXIpID0+IFRSZXN1bHQgfCBQcm9taXNlPFRSZXN1bHQ+KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9zb3VyY2UgPSBzb3VyY2U7XG4gICAgdGhpcy5fc2VsZWN0b3IgPSBzZWxlY3RvcjtcbiAgfVxuLyoqXG4gKiBAcmV0dXJuIHshQXN5bmNJdGVyYWJsZUl0ZXJhdG9yPFRSZXN1bHQ+fVxuICovXG5hc3luYyAqW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICBjb25zdCAvKiogQHR5cGUge1RTb3VyY2V9ICovIGl0ZW0gPSBhd2FpdCB0aGlzLl9zb3VyY2U7XG4gICAgeWllbGQgYXdhaXQgdGhpcy5fc2VsZWN0b3IoaXRlbSwgMCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gRnJvbVByb21pc2VJdGVyYWJsZV90c2lja2xlX0Nsb3N1cmVfZGVjbGFyYXRpb25zKCkge1xuLyoqIEB0eXBlIHshUHJvbWlzZUxpa2U8VFNvdXJjZT59ICovXG5Gcm9tUHJvbWlzZUl0ZXJhYmxlLnByb3RvdHlwZS5fc291cmNlO1xuLyoqIEB0eXBlIHtmdW5jdGlvbihUU291cmNlLCBudW1iZXIpOiAoVFJlc3VsdHwhUHJvbWlzZTxUUmVzdWx0Pil9ICovXG5Gcm9tUHJvbWlzZUl0ZXJhYmxlLnByb3RvdHlwZS5fc2VsZWN0b3I7XG59XG5cbi8qKlxuICogQHRlbXBsYXRlIFRTb3VyY2VcbiAqL1xuY2xhc3MgQXN5bmNPYnNlcnZlcjxUU291cmNlPiB7XG5wdWJsaWMgdmFsdWVzOiBUU291cmNlW107XG5wdWJsaWMgaGFzRXJyb3I6IGJvb2xlYW47XG5wdWJsaWMgaGFzQ29tcGxldGVkOiBib29sZWFuO1xucHVibGljIGVycm9yVmFsdWU6IGFueTtcbnB1YmxpYyBjbG9zZWQ6IGJvb2xlYW47XG5jb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnZhbHVlcyA9IFtdO1xuICAgIHRoaXMuaGFzQ29tcGxldGVkID0gZmFsc2U7XG4gICAgdGhpcy5oYXNFcnJvciA9IGZhbHNlO1xuICAgIHRoaXMuZXJyb3JWYWx1ZSA9IG51bGw7XG4gICAgdGhpcy5jbG9zZWQgPSBmYWxzZTtcbiAgfVxuLyoqXG4gKiBAcGFyYW0ge1RTb3VyY2V9IHZhbHVlXG4gKiBAcmV0dXJuIHt2b2lkfVxuICovXG5uZXh0KHZhbHVlOiBUU291cmNlKSB7XG4gICAgaWYgKCF0aGlzLmNsb3NlZCkge1xuICAgICAgdGhpcy52YWx1ZXMucHVzaCh2YWx1ZSk7XG4gICAgfVxuICB9XG4vKipcbiAqIEBwYXJhbSB7P30gZXJyXG4gKiBAcmV0dXJuIHt2b2lkfVxuICovXG5lcnJvcihlcnI6IGFueSkge1xuICAgIGlmICghdGhpcy5jbG9zZWQpIHtcbiAgICAgIHRoaXMuY2xvc2VkID0gdHJ1ZTtcbiAgICAgIHRoaXMuaGFzRXJyb3IgPSB0cnVlO1xuICAgICAgdGhpcy5lcnJvclZhbHVlID0gZXJyO1xuICAgIH1cbiAgfVxuLyoqXG4gKiBAcmV0dXJuIHt2b2lkfVxuICovXG5jb21wbGV0ZSgpIHtcbiAgICBpZiAoIXRoaXMuY2xvc2VkKSB7XG4gICAgICB0aGlzLmNsb3NlZCA9IHRydWU7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIEFzeW5jT2JzZXJ2ZXJfdHNpY2tsZV9DbG9zdXJlX2RlY2xhcmF0aW9ucygpIHtcbi8qKiBAdHlwZSB7IUFycmF5PFRTb3VyY2U+fSAqL1xuQXN5bmNPYnNlcnZlci5wcm90b3R5cGUudmFsdWVzO1xuLyoqIEB0eXBlIHtib29sZWFufSAqL1xuQXN5bmNPYnNlcnZlci5wcm90b3R5cGUuaGFzRXJyb3I7XG4vKiogQHR5cGUge2Jvb2xlYW59ICovXG5Bc3luY09ic2VydmVyLnByb3RvdHlwZS5oYXNDb21wbGV0ZWQ7XG4vKiogQHR5cGUgez99ICovXG5Bc3luY09ic2VydmVyLnByb3RvdHlwZS5lcnJvclZhbHVlO1xuLyoqIEB0eXBlIHtib29sZWFufSAqL1xuQXN5bmNPYnNlcnZlci5wcm90b3R5cGUuY2xvc2VkO1xufVxuXG4vKipcbiAqIEB0ZW1wbGF0ZSBUU291cmNlLCBUUmVzdWx0XG4gKi9cbmNsYXNzIEZyb21PYnNlcnZhYmxlQXN5bmNJdGVyYWJsZTxUU291cmNlLCBUUmVzdWx0ID0gVFNvdXJjZT4gZXh0ZW5kcyBBc3luY0l0ZXJhYmxlWDxUUmVzdWx0PiB7XG5wcml2YXRlIF9vYnNlcnZhYmxlOiBPYnNlcnZhYmxlPFRTb3VyY2U+O1xucHJpdmF0ZSBfc2VsZWN0b3I6ICh2YWx1ZTogVFNvdXJjZSwgaW5kZXg6IG51bWJlcikgPT4gVFJlc3VsdCB8IFByb21pc2U8VFJlc3VsdD47XG4vKipcbiAqIEBwYXJhbSB7IXRzaWNrbGVfZm9yd2FyZF9kZWNsYXJlXzYuT2JzZXJ2YWJsZTxUU291cmNlPn0gb2JzZXJ2YWJsZVxuICogQHBhcmFtIHtmdW5jdGlvbihUU291cmNlLCBudW1iZXIpOiAoVFJlc3VsdHwhUHJvbWlzZTxUUmVzdWx0Pil9IHNlbGVjdG9yXG4gKi9cbmNvbnN0cnVjdG9yKFxuICAgICAgb2JzZXJ2YWJsZTogT2JzZXJ2YWJsZTxUU291cmNlPixcbiAgICAgIHNlbGVjdG9yOiAodmFsdWU6IFRTb3VyY2UsIGluZGV4OiBudW1iZXIpID0+IFRSZXN1bHQgfCBQcm9taXNlPFRSZXN1bHQ+KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9vYnNlcnZhYmxlID0gb2JzZXJ2YWJsZTtcbiAgICB0aGlzLl9zZWxlY3RvciA9IHNlbGVjdG9yO1xuICB9XG4vKipcbiAqIEByZXR1cm4geyFBc3luY0l0ZXJhYmxlSXRlcmF0b3I8VFJlc3VsdD59XG4gKi9cbmFzeW5jICpbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgIGNvbnN0IC8qKiBAdHlwZSB7IUFzeW5jT2JzZXJ2ZXI8VFNvdXJjZT59ICovIG9ic2VydmVyID0gbmV3IEFzeW5jT2JzZXJ2ZXI8VFNvdXJjZT4oKTtcbiAgICBjb25zdCAvKiogQHR5cGUgeyFTdWJzY3JpcHRpb259ICovIHN1YnNjcmlwdGlvbiA9IHRoaXMuX29ic2VydmFibGUuc3Vic2NyaWJlKG9ic2VydmVyKTtcblxuICAgIGxldCAvKiogQHR5cGUge251bWJlcn0gKi8gaSA9IDA7XG4gICAgd2hpbGUgKDEpIHtcbiAgICAgIGlmIChvYnNlcnZlci52YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICB5aWVsZCBhd2FpdCB0aGlzLl9zZWxlY3RvcihvYnNlcnZlci52YWx1ZXMuc2hpZnQoKSwgaSsrKTtcbiAgICAgIH0gZWxzZSBpZiAob2JzZXJ2ZXIuY2xvc2VkKSB7XG4gICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICBpZiAob2JzZXJ2ZXIuaGFzRXJyb3IpIHtcbiAgICAgICAgICB0aHJvdyBvYnNlcnZlci5lcnJvclZhbHVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIEZyb21PYnNlcnZhYmxlQXN5bmNJdGVyYWJsZV90c2lja2xlX0Nsb3N1cmVfZGVjbGFyYXRpb25zKCkge1xuLyoqIEB0eXBlIHshdHNpY2tsZV9mb3J3YXJkX2RlY2xhcmVfNi5PYnNlcnZhYmxlPFRTb3VyY2U+fSAqL1xuRnJvbU9ic2VydmFibGVBc3luY0l0ZXJhYmxlLnByb3RvdHlwZS5fb2JzZXJ2YWJsZTtcbi8qKiBAdHlwZSB7ZnVuY3Rpb24oVFNvdXJjZSwgbnVtYmVyKTogKFRSZXN1bHR8IVByb21pc2U8VFJlc3VsdD4pfSAqL1xuRnJvbU9ic2VydmFibGVBc3luY0l0ZXJhYmxlLnByb3RvdHlwZS5fc2VsZWN0b3I7XG59XG5cblxuZXhwb3J0IHR5cGUgQXN5bmNJdGVyYWJsZUlucHV0PFRTb3VyY2U+ID1cbiAgSXRlcmFibGU8VFNvdXJjZSB8IFByb21pc2VMaWtlPFRTb3VyY2U+PiB8XG4gIEFzeW5jSXRlcmFibGU8VFNvdXJjZT4gfFxuICBBcnJheUxpa2U8VFNvdXJjZT4gfFxuICBQcm9taXNlTGlrZTxUU291cmNlPiB8XG4gIE9ic2VydmFibGU8VFNvdXJjZT47XG4vKiogQHR5cGVkZWYgeyghUHJvbWlzZUxpa2U8VFNvdXJjZT58IUl0ZXJhYmxlPChUU291cmNlfCFQcm9taXNlTGlrZTxUU291cmNlPik+fCFBc3luY0l0ZXJhYmxlPFRTb3VyY2U+fCFBcnJheUxpa2U8VFNvdXJjZT58IXRzaWNrbGVfZm9yd2FyZF9kZWNsYXJlXzYuT2JzZXJ2YWJsZTxUU291cmNlPil9ICovXG5leHBvcnRzLkFzeW5jSXRlcmFibGVJbnB1dDtcblxuLyoqXG4gKiBAcGFyYW0gez99IHhcbiAqIEByZXR1cm4ge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGlzUHJvbWlzZSh4OiBhbnkpOiB4IGlzIFByb21pc2VMaWtlPGFueT4ge1xuICByZXR1cm4geCAhPSBudWxsICYmIE9iamVjdCh4KSA9PT0geCAmJiB0eXBlb2YgeFsndGhlbiddID09PSAnZnVuY3Rpb24nO1xufVxuLyoqXG4gKiBAcGFyYW0gez99IHhcbiAqIEByZXR1cm4ge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGlzT2JzZXJ2YWJsZSh4OiBhbnkpOiB4IGlzIE9ic2VydmFibGU8YW55PiB7XG4gIHJldHVybiB4ICE9IG51bGwgJiYgT2JqZWN0KHgpID09PSB4ICYmIHR5cGVvZiB4WydzdWJzY3JpYmUnXSA9PT0gJ2Z1bmN0aW9uJztcbn1cbi8qKlxuICogQHBhcmFtIHs/fSB4XG4gKiBAcmV0dXJuIHtib29sZWFufVxuICovXG5mdW5jdGlvbiBpc0FycmF5TGlrZSh4OiBhbnkpOiB4IGlzIEFycmF5TGlrZTxhbnk+IHtcbiAgcmV0dXJuIHggIT0gbnVsbCAmJiBPYmplY3QoeCkgPT09IHggJiYgdHlwZW9mIHhbJ2xlbmd0aCddID09PSAnbnVtYmVyJztcbn1cbi8qKlxuICogQHRlbXBsYXRlIFRTb3VyY2UsIFRSZXN1bHRcbiAqIEBwYXJhbSB7KCFQcm9taXNlTGlrZTxUU291cmNlPnwhSXRlcmFibGU8KFRTb3VyY2V8IVByb21pc2VMaWtlPFRTb3VyY2U+KT58IUFzeW5jSXRlcmFibGU8VFNvdXJjZT58IUFycmF5TGlrZTxUU291cmNlPnwhdHNpY2tsZV9mb3J3YXJkX2RlY2xhcmVfNi5PYnNlcnZhYmxlPFRTb3VyY2U+KX0gc291cmNlXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFRTb3VyY2UsIG51bWJlcik6IChUUmVzdWx0fCFQcm9taXNlPFRSZXN1bHQ+KT19IHNlbGVjdG9yXG4gKiBAcGFyYW0gez89fSB0aGlzQXJnXG4gKiBAcmV0dXJuIHshdHNpY2tsZV9mb3J3YXJkX2RlY2xhcmVfMS5Bc3luY0l0ZXJhYmxlWDxUUmVzdWx0Pn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZyb208VFNvdXJjZSwgVFJlc3VsdCA9IFRTb3VyY2U+KFxuICAgIHNvdXJjZTogQXN5bmNJdGVyYWJsZUlucHV0PFRTb3VyY2U+LFxuICAgIHNlbGVjdG9yOiAodmFsdWU6IFRTb3VyY2UsIGluZGV4OiBudW1iZXIpID0+IFRSZXN1bHQgfCBQcm9taXNlPFRSZXN1bHQ+ID0gaWRlbnRpdHlBc3luYyxcbiAgICB0aGlzQXJnPzogYW55KTogQXN5bmNJdGVyYWJsZVg8VFJlc3VsdD4ge1xuICBjb25zdCAvKiogQHR5cGUgez99ICovIGZuID0gYmluZENhbGxiYWNrKHNlbGVjdG9yLCB0aGlzQXJnLCAyKTtcbiAgaWYgKGlzSXRlcmFibGUoc291cmNlKSB8fCBpc0FzeW5jSXRlcmFibGUoc291cmNlKSkge1xuICAgIHJldHVybiBuZXcgRnJvbUFzeW5jSXRlcmFibGU8VFNvdXJjZSwgVFJlc3VsdD4oc291cmNlLCBmbik7XG4gIH1cbiAgaWYgKGlzUHJvbWlzZShzb3VyY2UpKSB7XG4gICAgcmV0dXJuIG5ldyBGcm9tUHJvbWlzZUl0ZXJhYmxlPFRTb3VyY2UsIFRSZXN1bHQ+KHNvdXJjZSwgZm4pO1xuICB9XG4gIGlmIChpc09ic2VydmFibGUoc291cmNlKSkge1xuICAgIHJldHVybiBuZXcgRnJvbU9ic2VydmFibGVBc3luY0l0ZXJhYmxlPFRTb3VyY2UsIFRSZXN1bHQ+KHNvdXJjZSwgZm4pO1xuICB9XG4gIGlmIChpc0FycmF5TGlrZShzb3VyY2UpKSB7XG4gICAgcmV0dXJuIG5ldyBGcm9tQXJyYXlJdGVyYWJsZTxUU291cmNlLCBUUmVzdWx0Pihzb3VyY2UsIGZuKTtcbiAgfVxuXG4gIHRocm93IG5ldyBUeXBlRXJyb3IoJ0lucHV0IHR5cGUgbm90IHN1cHBvcnRlZCcpO1xufVxuIl19